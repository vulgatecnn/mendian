{
  "timestamp": "2025-11-04T12:42:40.227Z",
  "eslint": {
    "status": "completed",
    "totalFiles": 194,
    "filesWithIssues": 72,
    "totalErrors": 94,
    "totalWarnings": 50,
    "issues": [
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\App.tsx",
        "messages": [
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'useState' is defined but never used.",
            "line": 1,
            "column": 17,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 1,
            "endColumn": 25
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'useEffect' is defined but never used.",
            "line": 1,
            "column": 27,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 1,
            "endColumn": 36
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'useLocation' is defined but never used.",
            "line": 2,
            "column": 10,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 2,
            "endColumn": 21
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'useNavigate' is defined but never used.",
            "line": 2,
            "column": 23,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 2,
            "endColumn": 34
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'Layout' is defined but never used.",
            "line": 3,
            "column": 10,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 3,
            "endColumn": 16
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'Dropdown' is defined but never used.",
            "line": 3,
            "column": 18,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 3,
            "endColumn": 26
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'Menu' is defined but never used.",
            "line": 3,
            "column": 28,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 3,
            "endColumn": 32
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'Avatar' is defined but never used.",
            "line": 3,
            "column": 34,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 3,
            "endColumn": 40
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'Space' is defined but never used.",
            "line": 3,
            "column": 42,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 3,
            "endColumn": 47
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'Badge' is defined but never used.",
            "line": 3,
            "column": 49,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 3,
            "endColumn": 54
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'IconUser' is defined but never used.",
            "line": 4,
            "column": 10,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 4,
            "endColumn": 18
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'IconPoweroff' is defined but never used.",
            "line": 4,
            "column": 20,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 4,
            "endColumn": 32
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'IconSettings' is defined but never used.",
            "line": 4,
            "column": 34,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 4,
            "endColumn": 46
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'IconNotification' is defined but never used.",
            "line": 4,
            "column": 48,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 4,
            "endColumn": 64
          }
        ],
        "suppressedMessages": [],
        "errorCount": 14,
        "fatalErrorCount": 0,
        "warningCount": 0,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "import React, { useState, useEffect } from 'react'\r\nimport { useLocation, useNavigate } from 'react-router-dom'\r\nimport { Layout, Dropdown, Menu, Avatar, Space, Badge } from '@arco-design/web-react'\r\nimport { IconUser, IconPoweroff, IconSettings, IconNotification } from '@arco-design/web-react/icon'\r\nimport { AuthProvider, PermissionProvider, StorePlanProvider } from './contexts'\r\nimport AppRoutes from './routes/index.tsx'\r\nimport './App.css'\r\n\r\n// App 组件现在只负责提供全局 Context，路由由 AppRoutes 统一管理\r\n\r\nconst App: React.FC = () => {\r\n  return (\r\n    <AuthProvider>\r\n      <PermissionProvider>\r\n        <StorePlanProvider>\r\n          <AppRoutes />\r\n        </StorePlanProvider>\r\n      </PermissionProvider>\r\n    </AuthProvider>\r\n  )\r\n}\r\n\r\nexport default App\r\n",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\api\\mockAnalyticsData.ts",
        "messages": [
          {
            "ruleId": "prefer-const",
            "severity": 2,
            "message": "'filteredData' is never reassigned. Use 'const' instead.",
            "line": 267,
            "column": 7,
            "nodeType": "Identifier",
            "messageId": "useConst",
            "endLine": 267,
            "endColumn": 19,
            "fix": {
              "range": [
                5870,
                5900
              ],
              "text": "const filteredData = { ...data }"
            }
          }
        ],
        "suppressedMessages": [],
        "errorCount": 1,
        "fatalErrorCount": 0,
        "warningCount": 0,
        "fixableErrorCount": 1,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 模拟数据分析数据\r\n */\r\nimport type { \r\n  DashboardOverviewData, \r\n  StoreMapData, \r\n  FunnelData, \r\n  PlanProgressData,\r\n  DataFilters \r\n} from './analyticsService'\r\n\r\n// 模拟门店地图数据\r\nexport const mockStoreMapData: StoreMapData = {\r\n  stores: [\r\n    {\r\n      id: '1',\r\n      name: '北京朝阳店',\r\n      coordinates: [116.4074, 39.9042],\r\n      status: 'opened',\r\n      region: '华北区',\r\n      storeType: '直营店',\r\n      address: '北京市朝阳区建国路88号',\r\n      openDate: '2024-01-15',\r\n      progress: 100\r\n    },\r\n    {\r\n      id: '2',\r\n      name: '上海浦东店',\r\n      coordinates: [121.4737, 31.2304],\r\n      status: 'preparing',\r\n      region: '华东区',\r\n      storeType: '加盟店',\r\n      address: '上海市浦东新区陆家嘴环路1000号',\r\n      progress: 75\r\n    },\r\n    {\r\n      id: '3',\r\n      name: '广州天河店',\r\n      coordinates: [113.2644, 23.1291],\r\n      status: 'expanding',\r\n      region: '华南区',\r\n      storeType: '直营店',\r\n      address: '广州市天河区天河路123号',\r\n      progress: 45\r\n    },\r\n    {\r\n      id: '4',\r\n      name: '深圳南山店',\r\n      coordinates: [113.9308, 22.5329],\r\n      status: 'planned',\r\n      region: '华南区',\r\n      storeType: '合作店',\r\n      address: '深圳市南山区科技园南区',\r\n      progress: 20\r\n    },\r\n    {\r\n      id: '5',\r\n      name: '成都锦江店',\r\n      coordinates: [104.0668, 30.5728],\r\n      status: 'opened',\r\n      region: '西南区',\r\n      storeType: '加盟店',\r\n      address: '成都市锦江区春熙路168号',\r\n      openDate: '2024-02-20',\r\n      progress: 100\r\n    },\r\n    {\r\n      id: '6',\r\n      name: '杭州西湖店',\r\n      coordinates: [120.1551, 30.2741],\r\n      status: 'preparing',\r\n      region: '华东区',\r\n      storeType: '直营店',\r\n      address: '杭州市西湖区文三路259号',\r\n      progress: 60\r\n    }\r\n  ],\r\n  regions: [\r\n    {\r\n      regionId: '1',\r\n      regionName: '华北区',\r\n      totalStores: 1,\r\n      statusCounts: { planned: 0, expanding: 0, preparing: 0, opened: 1 }\r\n    },\r\n    {\r\n      regionId: '2',\r\n      regionName: '华东区',\r\n      totalStores: 2,\r\n      statusCounts: { planned: 0, expanding: 0, preparing: 2, opened: 0 }\r\n    },\r\n    {\r\n      regionId: '3',\r\n      regionName: '华南区',\r\n      totalStores: 2,\r\n      statusCounts: { planned: 1, expanding: 1, preparing: 0, opened: 0 }\r\n    },\r\n    {\r\n      regionId: '4',\r\n      regionName: '西南区',\r\n      totalStores: 1,\r\n      statusCounts: { planned: 0, expanding: 0, preparing: 0, opened: 1 }\r\n    }\r\n  ],\r\n  mapCenter: [113.2644, 35.8617], // 中国中心位置\r\n  zoomLevel: 5,\r\n  lastUpdated: new Date().toISOString()\r\n}\r\n\r\n// 模拟跟进漏斗数据\r\nexport const mockFunnelData: FunnelData = {\r\n  stages: [\r\n    {\r\n      name: '调研',\r\n      count: 150,\r\n      percentage: 100,\r\n      isWarning: false,\r\n      details: { avgDuration: 7, successRate: 85 }\r\n    },\r\n    {\r\n      name: '谈判',\r\n      count: 120,\r\n      percentage: 80,\r\n      isWarning: false,\r\n      details: { avgDuration: 14, successRate: 75 }\r\n    },\r\n    {\r\n      name: '测算',\r\n      count: 90,\r\n      percentage: 60,\r\n      isWarning: false,\r\n      details: { avgDuration: 10, successRate: 70 }\r\n    },\r\n    {\r\n      name: '报店',\r\n      count: 63,\r\n      percentage: 42,\r\n      isWarning: true,\r\n      details: { avgDuration: 21, successRate: 60 }\r\n    },\r\n    {\r\n      name: '签约',\r\n      count: 45,\r\n      percentage: 30,\r\n      isWarning: false,\r\n      details: { avgDuration: 15, successRate: 85 }\r\n    }\r\n  ],\r\n  conversionRates: [80, 75, 70, 71.4], // 各阶段转化率\r\n  totalCount: 150,\r\n  timeRange: {\r\n    startDate: '2024-01-01',\r\n    endDate: '2024-12-31'\r\n  },\r\n  lastUpdated: new Date().toISOString()\r\n}\r\n\r\n// 模拟计划进度数据\r\nexport const mockPlanProgressData: PlanProgressData = {\r\n  plans: [\r\n    {\r\n      planId: 1,\r\n      planName: '2024年华北区扩张计划',\r\n      contributionType: 'high',\r\n      targetCount: 50,\r\n      completedCount: 42,\r\n      progressRate: 84,\r\n      status: 'on_track'\r\n    },\r\n    {\r\n      planId: 2,\r\n      planName: '2024年华东区发展计划',\r\n      contributionType: 'high',\r\n      targetCount: 80,\r\n      completedCount: 55,\r\n      progressRate: 68.75,\r\n      status: 'at_risk'\r\n    },\r\n    {\r\n      planId: 3,\r\n      planName: '2024年华南区布局计划',\r\n      contributionType: 'medium',\r\n      targetCount: 60,\r\n      completedCount: 35,\r\n      progressRate: 58.33,\r\n      status: 'delayed'\r\n    },\r\n    {\r\n      planId: 4,\r\n      planName: '2024年西南区试点计划',\r\n      contributionType: 'strategic',\r\n      targetCount: 20,\r\n      completedCount: 18,\r\n      progressRate: 90,\r\n      status: 'on_track'\r\n    },\r\n    {\r\n      planId: 5,\r\n      planName: '2024年西北区开拓计划',\r\n      contributionType: 'low',\r\n      targetCount: 30,\r\n      completedCount: 12,\r\n      progressRate: 40,\r\n      status: 'delayed'\r\n    }\r\n  ],\r\n  summary: {\r\n    totalTarget: 240,\r\n    totalCompleted: 162,\r\n    overallProgress: 67.5\r\n  },\r\n  byContributionType: [\r\n    {\r\n      type: 'high',\r\n      typeName: '高贡献率',\r\n      totalTarget: 130,\r\n      totalCompleted: 97,\r\n      progressRate: 74.6,\r\n      planCount: 2\r\n    },\r\n    {\r\n      type: 'medium',\r\n      typeName: '中贡献率',\r\n      totalTarget: 60,\r\n      totalCompleted: 35,\r\n      progressRate: 58.3,\r\n      planCount: 1\r\n    },\r\n    {\r\n      type: 'strategic',\r\n      typeName: '战略性',\r\n      totalTarget: 20,\r\n      totalCompleted: 18,\r\n      progressRate: 90,\r\n      planCount: 1\r\n    },\r\n    {\r\n      type: 'low',\r\n      typeName: '低贡献率',\r\n      totalTarget: 30,\r\n      totalCompleted: 12,\r\n      progressRate: 40,\r\n      planCount: 1\r\n    }\r\n  ],\r\n  lastUpdated: new Date().toISOString()\r\n}\r\n\r\n// 模拟完整的仪表板数据\r\nexport const mockDashboardOverviewData: DashboardOverviewData = {\r\n  storeMap: mockStoreMapData,\r\n  followUpFunnel: mockFunnelData,\r\n  planProgress: mockPlanProgressData,\r\n  lastUpdated: new Date().toISOString()\r\n}\r\n\r\n/**\r\n * 模拟API延迟\r\n */\r\nexport const simulateApiDelay = (ms: number = 1000) => {\r\n  return new Promise(resolve => setTimeout(resolve, ms))\r\n}\r\n\r\n/**\r\n * 根据筛选条件过滤数据\r\n */\r\nexport const filterMockData = (data: DashboardOverviewData, filters: DataFilters): DashboardOverviewData => {\r\n  let filteredData = { ...data }\r\n\r\n  // 如果有区域筛选\r\n  if (filters.regionIds && filters.regionIds.length > 0) {\r\n    const regionNames = filters.regionIds.map(id => {\r\n      const regionMap: Record<number, string> = {\r\n        1: '华北区',\r\n        2: '华东区',\r\n        3: '华南区',\r\n        4: '华中区',\r\n        5: '西南区',\r\n        6: '西北区'\r\n      }\r\n      return regionMap[id]\r\n    }).filter(Boolean)\r\n\r\n    // 过滤门店数据\r\n    filteredData.storeMap = {\r\n      ...filteredData.storeMap,\r\n      stores: filteredData.storeMap.stores.filter(store => \r\n        regionNames.includes(store.region)\r\n      ),\r\n      regions: filteredData.storeMap.regions.filter(region => \r\n        regionNames.includes(region.regionName)\r\n      )\r\n    }\r\n  }\r\n\r\n  // 如果有门店类型筛选\r\n  if (filters.storeTypes && filters.storeTypes.length > 0) {\r\n    filteredData.storeMap = {\r\n      ...filteredData.storeMap,\r\n      stores: filteredData.storeMap.stores.filter(store => \r\n        filters.storeTypes!.includes(store.storeType)\r\n      )\r\n    }\r\n  }\r\n\r\n  // 如果有贡献率类型筛选\r\n  if (filters.contributionTypes && filters.contributionTypes.length > 0) {\r\n    filteredData.planProgress = {\r\n      ...filteredData.planProgress,\r\n      plans: filteredData.planProgress.plans.filter(plan => \r\n        filters.contributionTypes!.includes(plan.contributionType)\r\n      ),\r\n      byContributionType: filteredData.planProgress.byContributionType.filter(type => \r\n        filters.contributionTypes!.includes(type.type)\r\n      )\r\n    }\r\n\r\n    // 重新计算汇总数据\r\n    const filteredPlans = filteredData.planProgress.plans\r\n    const totalTarget = filteredPlans.reduce((sum, plan) => sum + plan.targetCount, 0)\r\n    const totalCompleted = filteredPlans.reduce((sum, plan) => sum + plan.completedCount, 0)\r\n    \r\n    filteredData.planProgress.summary = {\r\n      totalTarget,\r\n      totalCompleted,\r\n      overallProgress: totalTarget > 0 ? (totalCompleted / totalTarget) * 100 : 0\r\n    }\r\n  }\r\n\r\n  return filteredData\r\n}",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\api\\uploadService.ts",
        "messages": [
          {
            "ruleId": "prefer-const",
            "severity": 2,
            "message": "'filename' is never reassigned. Use 'const' instead.",
            "line": 206,
            "column": 9,
            "nodeType": "Identifier",
            "messageId": "useConst",
            "endLine": 206,
            "endColumn": 17,
            "fix": {
              "range": [
                4855,
                4879
              ],
              "text": "const filename = file.name"
            }
          }
        ],
        "suppressedMessages": [],
        "errorCount": 1,
        "fatalErrorCount": 0,
        "warningCount": 0,
        "fixableErrorCount": 1,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 文件上传服务\r\n * \r\n * 功能特性：\r\n * - 图片上传（支持压缩和预览）\r\n * - 文档上传（支持多种格式）\r\n * - 上传进度跟踪\r\n * - 文件大小和类型验证\r\n * - 批量上传支持\r\n */\r\nimport axios, { AxiosProgressEvent } from 'axios'\r\nimport { Message } from '@arco-design/web-react'\r\n\r\n// 上传配置\r\nexport interface UploadConfig {\r\n  maxSize?: number // 最大文件大小（字节），默认 10MB\r\n  allowedTypes?: string[] // 允许的文件类型\r\n  compress?: boolean // 是否压缩图片\r\n  compressQuality?: number // 压缩质量（0-1）\r\n  onProgress?: (percent: number) => void // 上传进度回调\r\n}\r\n\r\n// 上传响应\r\nexport interface UploadResponse {\r\n  url: string\r\n  filename: string\r\n  size: number\r\n  mime_type: string\r\n}\r\n\r\n// 默认配置\r\nconst DEFAULT_CONFIG: UploadConfig = {\r\n  maxSize: 10 * 1024 * 1024, // 10MB\r\n  compress: false,\r\n  compressQuality: 0.8,\r\n}\r\n\r\n// 图片类型\r\nconst IMAGE_TYPES = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp']\r\n\r\n// 文档类型\r\nconst DOCUMENT_TYPES = [\r\n  'application/pdf',\r\n  'application/msword',\r\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\r\n  'application/vnd.ms-excel',\r\n  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\r\n  'application/vnd.ms-powerpoint',\r\n  'application/vnd.openxmlformats-officedocument.presentationml.presentation',\r\n  'text/plain',\r\n]\r\n\r\n/**\r\n * 验证文件\r\n */\r\nfunction validateFile(file: File, config: UploadConfig): boolean {\r\n  // 检查文件大小\r\n  if (config.maxSize && file.size > config.maxSize) {\r\n    const maxSizeMB = (config.maxSize / (1024 * 1024)).toFixed(2)\r\n    Message.error(`文件大小不能超过 ${maxSizeMB}MB`)\r\n    return false\r\n  }\r\n  \r\n  // 检查文件类型\r\n  if (config.allowedTypes && config.allowedTypes.length > 0) {\r\n    if (!config.allowedTypes.includes(file.type)) {\r\n      Message.error('不支持的文件类型')\r\n      return false\r\n    }\r\n  }\r\n  \r\n  return true\r\n}\r\n\r\n/**\r\n * 压缩图片\r\n */\r\nfunction compressImage(file: File, quality: number = 0.8): Promise<Blob> {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader()\r\n    \r\n    reader.onload = (e) => {\r\n      const img = new Image()\r\n      \r\n      img.onload = () => {\r\n        const canvas = document.createElement('canvas')\r\n        const ctx = canvas.getContext('2d')\r\n        \r\n        if (!ctx) {\r\n          reject(new Error('无法创建 canvas 上下文'))\r\n          return\r\n        }\r\n        \r\n        // 计算压缩后的尺寸（最大宽度/高度 1920px）\r\n        const maxSize = 1920\r\n        let width = img.width\r\n        let height = img.height\r\n        \r\n        if (width > maxSize || height > maxSize) {\r\n          if (width > height) {\r\n            height = (height * maxSize) / width\r\n            width = maxSize\r\n          } else {\r\n            width = (width * maxSize) / height\r\n            height = maxSize\r\n          }\r\n        }\r\n        \r\n        canvas.width = width\r\n        canvas.height = height\r\n        \r\n        // 绘制图片\r\n        ctx.drawImage(img, 0, 0, width, height)\r\n        \r\n        // 转换为 Blob\r\n        canvas.toBlob(\r\n          (blob) => {\r\n            if (blob) {\r\n              resolve(blob)\r\n            } else {\r\n              reject(new Error('图片压缩失败'))\r\n            }\r\n          },\r\n          file.type,\r\n          quality\r\n        )\r\n      }\r\n      \r\n      img.onerror = () => {\r\n        reject(new Error('图片加载失败'))\r\n      }\r\n      \r\n      img.src = e.target?.result as string\r\n    }\r\n    \r\n    reader.onerror = () => {\r\n      reject(new Error('文件读取失败'))\r\n    }\r\n    \r\n    reader.readAsDataURL(file)\r\n  })\r\n}\r\n\r\n/**\r\n * 上传文件到服务器\r\n */\r\nasync function uploadToServer(\r\n  file: File | Blob,\r\n  filename: string,\r\n  endpoint: string,\r\n  onProgress?: (percent: number) => void\r\n): Promise<UploadResponse> {\r\n  const formData = new FormData()\r\n  formData.append('file', file, filename)\r\n  \r\n  const token = localStorage.getItem('access_token')\r\n  \r\n  try {\r\n    const response = await axios.post(endpoint, formData, {\r\n      headers: {\r\n        'Content-Type': 'multipart/form-data',\r\n        Authorization: token ? `Bearer ${token}` : '',\r\n      },\r\n      onUploadProgress: (progressEvent: AxiosProgressEvent) => {\r\n        if (progressEvent.total && onProgress) {\r\n          const percent = Math.round((progressEvent.loaded * 100) / progressEvent.total)\r\n          onProgress(percent)\r\n        }\r\n      },\r\n    })\r\n    \r\n    return response.data\r\n  } catch (error: any) {\r\n    if (error.response?.data?.message) {\r\n      Message.error(error.response.data.message)\r\n    } else {\r\n      Message.error('文件上传失败')\r\n    }\r\n    throw error\r\n  }\r\n}\r\n\r\n/**\r\n * 文件上传服务类\r\n */\r\nexport class UploadService {\r\n  /**\r\n   * 上传图片\r\n   */\r\n  static async uploadImage(\r\n    file: File,\r\n    config: UploadConfig = {}\r\n  ): Promise<UploadResponse> {\r\n    const finalConfig = {\r\n      ...DEFAULT_CONFIG,\r\n      allowedTypes: IMAGE_TYPES,\r\n      ...config,\r\n    }\r\n    \r\n    // 验证文件\r\n    if (!validateFile(file, finalConfig)) {\r\n      throw new Error('文件验证失败')\r\n    }\r\n    \r\n    let uploadFile: File | Blob = file\r\n    let filename = file.name\r\n    \r\n    // 压缩图片\r\n    if (finalConfig.compress && IMAGE_TYPES.includes(file.type)) {\r\n      try {\r\n        const compressedBlob = await compressImage(file, finalConfig.compressQuality)\r\n        uploadFile = compressedBlob\r\n        Message.success('图片压缩完成')\r\n      } catch (error) {\r\n        console.error('图片压缩失败:', error)\r\n        Message.warning('图片压缩失败，将上传原图')\r\n      }\r\n    }\r\n    \r\n    // 上传到服务器\r\n    return uploadToServer(\r\n      uploadFile,\r\n      filename,\r\n      '/api/upload/image/',\r\n      finalConfig.onProgress\r\n    )\r\n  }\r\n  \r\n  /**\r\n   * 上传文档\r\n   */\r\n  static async uploadDocument(\r\n    file: File,\r\n    config: UploadConfig = {}\r\n  ): Promise<UploadResponse> {\r\n    const finalConfig = {\r\n      ...DEFAULT_CONFIG,\r\n      maxSize: 50 * 1024 * 1024, // 文档最大 50MB\r\n      allowedTypes: DOCUMENT_TYPES,\r\n      ...config,\r\n    }\r\n    \r\n    // 验证文件\r\n    if (!validateFile(file, finalConfig)) {\r\n      throw new Error('文件验证失败')\r\n    }\r\n    \r\n    // 上传到服务器\r\n    return uploadToServer(\r\n      file,\r\n      file.name,\r\n      '/api/upload/document/',\r\n      finalConfig.onProgress\r\n    )\r\n  }\r\n  \r\n  /**\r\n   * 批量上传文件\r\n   */\r\n  static async uploadMultiple(\r\n    files: File[],\r\n    uploadFn: (file: File, config?: UploadConfig) => Promise<UploadResponse>,\r\n    config: UploadConfig = {}\r\n  ): Promise<UploadResponse[]> {\r\n    const results: UploadResponse[] = []\r\n    const errors: Error[] = []\r\n    \r\n    for (let i = 0; i < files.length; i++) {\r\n      try {\r\n        const result = await uploadFn(files[i], {\r\n          ...config,\r\n          onProgress: (percent) => {\r\n            if (config.onProgress) {\r\n              // 计算总体进度\r\n              const totalPercent = Math.round(\r\n                ((i + percent / 100) / files.length) * 100\r\n              )\r\n              config.onProgress(totalPercent)\r\n            }\r\n          },\r\n        })\r\n        results.push(result)\r\n      } catch (error) {\r\n        errors.push(error as Error)\r\n      }\r\n    }\r\n    \r\n    if (errors.length > 0) {\r\n      Message.warning(`${files.length - errors.length}/${files.length} 个文件上传成功`)\r\n    } else {\r\n      Message.success('所有文件上传成功')\r\n    }\r\n    \r\n    return results\r\n  }\r\n  \r\n  /**\r\n   * 批量上传图片\r\n   */\r\n  static async uploadImages(\r\n    files: File[],\r\n    config: UploadConfig = {}\r\n  ): Promise<UploadResponse[]> {\r\n    return this.uploadMultiple(files, this.uploadImage.bind(this), config)\r\n  }\r\n  \r\n  /**\r\n   * 批量上传文档\r\n   */\r\n  static async uploadDocuments(\r\n    files: File[],\r\n    config: UploadConfig = {}\r\n  ): Promise<UploadResponse[]> {\r\n    return this.uploadMultiple(files, this.uploadDocument.bind(this), config)\r\n  }\r\n  \r\n  /**\r\n   * 通用文件上传（自动判断类型）\r\n   */\r\n  static async upload(\r\n    file: File,\r\n    config: UploadConfig = {}\r\n  ): Promise<UploadResponse> {\r\n    if (IMAGE_TYPES.includes(file.type)) {\r\n      return this.uploadImage(file, config)\r\n    } else if (DOCUMENT_TYPES.includes(file.type)) {\r\n      return this.uploadDocument(file, config)\r\n    } else {\r\n      Message.error('不支持的文件类型')\r\n      throw new Error('不支持的文件类型')\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * 获取文件预览 URL（用于本地预览）\r\n   */\r\n  static getPreviewUrl(file: File): string {\r\n    return URL.createObjectURL(file)\r\n  }\r\n  \r\n  /**\r\n   * 释放预览 URL\r\n   */\r\n  static revokePreviewUrl(url: string): void {\r\n    URL.revokeObjectURL(url)\r\n  }\r\n}\r\n\r\nexport default UploadService\r\n",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\api\\utils.ts",
        "messages": [
          {
            "ruleId": "@typescript-eslint/no-this-alias",
            "severity": 2,
            "message": "Unexpected aliasing of 'this' to local variable.",
            "line": 87,
            "column": 11,
            "nodeType": "Identifier",
            "messageId": "thisAssignment",
            "endLine": 87,
            "endColumn": 18
          },
          {
            "ruleId": "@typescript-eslint/no-this-alias",
            "severity": 2,
            "message": "Unexpected aliasing of 'this' to local variable.",
            "line": 110,
            "column": 11,
            "nodeType": "Identifier",
            "messageId": "thisAssignment",
            "endLine": 110,
            "endColumn": 18
          },
          {
            "ruleId": "no-prototype-builtins",
            "severity": 2,
            "message": "Do not access Object.prototype method 'hasOwnProperty' from target object.",
            "line": 150,
            "column": 15,
            "nodeType": "CallExpression",
            "messageId": "prototypeBuildIn",
            "endLine": 150,
            "endColumn": 29,
            "suggestions": [
              {
                "messageId": "callObjectPrototype",
                "data": {
                  "prop": "hasOwnProperty"
                },
                "fix": {
                  "range": [
                    3535,
                    3554
                  ],
                  "text": "Object.prototype.hasOwnProperty.call(obj, "
                },
                "desc": "Call Object.prototype.hasOwnProperty explicitly."
              }
            ]
          }
        ],
        "suppressedMessages": [],
        "errorCount": 3,
        "fatalErrorCount": 0,
        "warningCount": 0,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * API 工具函数\r\n */\r\n\r\n/**\r\n * 构建查询参数字符串\r\n */\r\nexport function buildQueryString(params: Record<string, any>): string {\r\n  const searchParams = new URLSearchParams()\r\n  \r\n  Object.entries(params).forEach(([key, value]) => {\r\n    if (value !== undefined && value !== null && value !== '') {\r\n      if (Array.isArray(value)) {\r\n        value.forEach(item => searchParams.append(key, String(item)))\r\n      } else {\r\n        searchParams.append(key, String(value))\r\n      }\r\n    }\r\n  })\r\n  \r\n  return searchParams.toString()\r\n}\r\n\r\n/**\r\n * 下载文件\r\n */\r\nexport function downloadFile(blob: Blob, filename: string): void {\r\n  const url = window.URL.createObjectURL(blob)\r\n  const link = document.createElement('a')\r\n  link.href = url\r\n  link.download = filename\r\n  document.body.appendChild(link)\r\n  link.click()\r\n  document.body.removeChild(link)\r\n  window.URL.revokeObjectURL(url)\r\n}\r\n\r\n/**\r\n * 格式化文件大小\r\n */\r\nexport function formatFileSize(bytes: number): string {\r\n  if (bytes === 0) return '0 B'\r\n  \r\n  const k = 1024\r\n  const sizes = ['B', 'KB', 'MB', 'GB', 'TB']\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\r\n  \r\n  return `${(bytes / Math.pow(k, i)).toFixed(2)} ${sizes[i]}`\r\n}\r\n\r\n/**\r\n * 获取文件扩展名\r\n */\r\nexport function getFileExtension(filename: string): string {\r\n  const parts = filename.split('.')\r\n  return parts.length > 1 ? parts[parts.length - 1].toLowerCase() : ''\r\n}\r\n\r\n/**\r\n * 判断是否为图片文件\r\n */\r\nexport function isImageFile(filename: string): boolean {\r\n  const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg']\r\n  const ext = getFileExtension(filename)\r\n  return imageExtensions.includes(ext)\r\n}\r\n\r\n/**\r\n * 判断是否为文档文件\r\n */\r\nexport function isDocumentFile(filename: string): boolean {\r\n  const docExtensions = ['pdf', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx', 'txt']\r\n  const ext = getFileExtension(filename)\r\n  return docExtensions.includes(ext)\r\n}\r\n\r\n/**\r\n * 防抖函数\r\n */\r\nexport function debounce<T extends (...args: any[]) => any>(\r\n  func: T,\r\n  wait: number\r\n): (...args: Parameters<T>) => void {\r\n  let timeout: ReturnType<typeof setTimeout> | null = null\r\n  \r\n  return function (this: any, ...args: Parameters<T>) {\r\n    const context = this\r\n    \r\n    if (timeout) {\r\n      clearTimeout(timeout)\r\n    }\r\n    \r\n    timeout = setTimeout(() => {\r\n      func.apply(context, args)\r\n    }, wait)\r\n  }\r\n}\r\n\r\n/**\r\n * 节流函数\r\n */\r\nexport function throttle<T extends (...args: any[]) => any>(\r\n  func: T,\r\n  wait: number\r\n): (...args: Parameters<T>) => void {\r\n  let timeout: ReturnType<typeof setTimeout> | null = null\r\n  let previous = 0\r\n  \r\n  return function (this: any, ...args: Parameters<T>) {\r\n    const context = this\r\n    const now = Date.now()\r\n    const remaining = wait - (now - previous)\r\n    \r\n    if (remaining <= 0 || remaining > wait) {\r\n      if (timeout) {\r\n        clearTimeout(timeout)\r\n        timeout = null\r\n      }\r\n      previous = now\r\n      func.apply(context, args)\r\n    } else if (!timeout) {\r\n      timeout = setTimeout(() => {\r\n        previous = Date.now()\r\n        timeout = null\r\n        func.apply(context, args)\r\n      }, remaining)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 深度克隆对象\r\n */\r\nexport function deepClone<T>(obj: T): T {\r\n  if (obj === null || typeof obj !== 'object') {\r\n    return obj\r\n  }\r\n  \r\n  if (obj instanceof Date) {\r\n    return new Date(obj.getTime()) as any\r\n  }\r\n  \r\n  if (obj instanceof Array) {\r\n    return obj.map(item => deepClone(item)) as any\r\n  }\r\n  \r\n  if (obj instanceof Object) {\r\n    const clonedObj = {} as T\r\n    for (const key in obj) {\r\n      if (obj.hasOwnProperty(key)) {\r\n        clonedObj[key] = deepClone(obj[key])\r\n      }\r\n    }\r\n    return clonedObj\r\n  }\r\n  \r\n  return obj\r\n}\r\n\r\n/**\r\n * 合并对象（深度合并）\r\n */\r\nexport function deepMerge<T extends object>(target: T, ...sources: Partial<T>[]): T {\r\n  if (!sources.length) return target\r\n  \r\n  const source = sources.shift()\r\n  \r\n  if (source === undefined) return target\r\n  \r\n  if (isObject(target) && isObject(source)) {\r\n    Object.keys(source).forEach(key => {\r\n      const targetValue = (target as any)[key]\r\n      const sourceValue = (source as any)[key]\r\n      \r\n      if (isObject(sourceValue)) {\r\n        if (!targetValue || !isObject(targetValue)) {\r\n          (target as any)[key] = {}\r\n        }\r\n        deepMerge((target as any)[key], sourceValue)\r\n      } else {\r\n        (target as any)[key] = sourceValue\r\n      }\r\n    })\r\n  }\r\n  \r\n  return deepMerge(target, ...sources)\r\n}\r\n\r\n/**\r\n * 判断是否为对象\r\n */\r\nfunction isObject(item: any): boolean {\r\n  return item && typeof item === 'object' && !Array.isArray(item)\r\n}\r\n\r\n/**\r\n * 生成唯一 ID\r\n */\r\nexport function generateUniqueId(): string {\r\n  return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\r\n}\r\n\r\n/**\r\n * 格式化日期\r\n */\r\nexport function formatDate(date: Date | string, format: string = 'YYYY-MM-DD HH:mm:ss'): string {\r\n  const d = typeof date === 'string' ? new Date(date) : date\r\n  \r\n  const year = d.getFullYear()\r\n  const month = String(d.getMonth() + 1).padStart(2, '0')\r\n  const day = String(d.getDate()).padStart(2, '0')\r\n  const hours = String(d.getHours()).padStart(2, '0')\r\n  const minutes = String(d.getMinutes()).padStart(2, '0')\r\n  const seconds = String(d.getSeconds()).padStart(2, '0')\r\n  \r\n  return format\r\n    .replace('YYYY', String(year))\r\n    .replace('MM', month)\r\n    .replace('DD', day)\r\n    .replace('HH', hours)\r\n    .replace('mm', minutes)\r\n    .replace('ss', seconds)\r\n}\r\n\r\n/**\r\n * 解析错误消息\r\n */\r\nexport function parseErrorMessage(error: any): string {\r\n  if (typeof error === 'string') {\r\n    return error\r\n  }\r\n  \r\n  if (error?.response?.data?.message) {\r\n    return error.response.data.message\r\n  }\r\n  \r\n  if (error?.response?.data?.detail) {\r\n    return error.response.data.detail\r\n  }\r\n  \r\n  if (error?.message) {\r\n    return error.message\r\n  }\r\n  \r\n  return '未知错误'\r\n}\r\n\r\n/**\r\n * 重试函数\r\n */\r\nexport async function retry<T>(\r\n  fn: () => Promise<T>,\r\n  maxRetries: number = 3,\r\n  delay: number = 1000\r\n): Promise<T> {\r\n  let lastError: any\r\n  \r\n  for (let i = 0; i < maxRetries; i++) {\r\n    try {\r\n      return await fn()\r\n    } catch (error) {\r\n      lastError = error\r\n      \r\n      if (i < maxRetries - 1) {\r\n        await new Promise(resolve => setTimeout(resolve, delay * (i + 1)))\r\n      }\r\n    }\r\n  }\r\n  \r\n  throw lastError\r\n}\r\n\r\n/**\r\n * 批量执行异步任务（并发控制）\r\n */\r\nexport async function batchExecute<T, R>(\r\n  items: T[],\r\n  executor: (item: T) => Promise<R>,\r\n  concurrency: number = 5\r\n): Promise<R[]> {\r\n  const results: R[] = []\r\n  const executing: Promise<void>[] = []\r\n  \r\n  for (const item of items) {\r\n    const promise = executor(item).then(result => {\r\n      results.push(result)\r\n    })\r\n    \r\n    executing.push(promise)\r\n    \r\n    if (executing.length >= concurrency) {\r\n      await Promise.race(executing)\r\n      executing.splice(\r\n        executing.findIndex(p => p === promise),\r\n        1\r\n      )\r\n    }\r\n  }\r\n  \r\n  await Promise.all(executing)\r\n  return results\r\n}\r\n",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\LazyLoad.tsx",
        "messages": [
          {
            "ruleId": "react-refresh/only-export-components",
            "severity": 1,
            "message": "Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.",
            "line": 101,
            "column": 17,
            "nodeType": "Identifier",
            "messageId": "namedExport",
            "endLine": 101,
            "endColumn": 36
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'props' is defined but never used.",
            "line": 107,
            "column": 11,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 107,
            "endColumn": 41
          },
          {
            "ruleId": "react-refresh/only-export-components",
            "severity": 1,
            "message": "Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.",
            "line": 115,
            "column": 17,
            "nodeType": "Identifier",
            "messageId": "namedExport",
            "endLine": 115,
            "endColumn": 33
          }
        ],
        "suppressedMessages": [],
        "errorCount": 1,
        "fatalErrorCount": 0,
        "warningCount": 2,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 懒加载组件\r\n * 用于实现组件的按需加载和代码分割\r\n */\r\n\r\nimport React, { Suspense, ComponentType, LazyExoticComponent } from 'react';\r\nimport { Spin } from '@arco-design/web-react';\r\nimport './LazyLoad.css';\r\n\r\ninterface LazyLoadProps {\r\n  // 懒加载的组件\r\n  component: LazyExoticComponent<ComponentType<any>>;\r\n  // 加载时的占位组件\r\n  fallback?: React.ReactNode;\r\n  // 错误边界\r\n  errorFallback?: React.ReactNode;\r\n  // 传递给组件的props\r\n  [key: string]: any;\r\n}\r\n\r\ninterface ErrorBoundaryState {\r\n  hasError: boolean;\r\n  error?: Error;\r\n}\r\n\r\n/**\r\n * 错误边界组件\r\n */\r\nclass ErrorBoundary extends React.Component<\r\n  { children: React.ReactNode; fallback?: React.ReactNode },\r\n  ErrorBoundaryState\r\n> {\r\n  constructor(props: any) {\r\n    super(props);\r\n    this.state = { hasError: false };\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\r\n    return { hasError: true, error };\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n    console.error('LazyLoad Error:', error, errorInfo);\r\n  }\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      return (\r\n        this.props.fallback || (\r\n          <div className=\"lazy-load-error\">\r\n            <div className=\"error-content\">\r\n              <div className=\"error-icon\">⚠️</div>\r\n              <div className=\"error-message\">组件加载失败</div>\r\n              <div className=\"error-detail\">\r\n                {this.state.error?.message || '未知错误'}\r\n              </div>\r\n              <button\r\n                className=\"error-retry\"\r\n                onClick={() => window.location.reload()}\r\n              >\r\n                重新加载\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\n/**\r\n * 默认加载占位组件\r\n */\r\nconst DefaultFallback: React.FC = () => (\r\n  <div className=\"lazy-load-fallback\">\r\n    <Spin size={32} />\r\n    <div className=\"loading-text\">加载中...</div>\r\n  </div>\r\n);\r\n\r\n/**\r\n * 懒加载组件\r\n */\r\nconst LazyLoad: React.FC<LazyLoadProps> = (props) => {\r\n  const { component: Component, fallback, errorFallback, ...restProps } = props;\r\n  \r\n  return (\r\n    <ErrorBoundary fallback={errorFallback}>\r\n      <Suspense fallback={fallback || <DefaultFallback />}>\r\n        <Component {...restProps} />\r\n      </Suspense>\r\n    </ErrorBoundary>\r\n  );\r\n};\r\n\r\n/**\r\n * 创建懒加载组件的工厂函数\r\n */\r\nexport function createLazyComponent<T extends ComponentType<any>>(\r\n  importFunc: () => Promise<{ default: T }>,\r\n  fallback?: React.ReactNode\r\n): React.FC<React.ComponentProps<T>> {\r\n  const LazyComponent = React.lazy(importFunc);\r\n\r\n  return (props: React.ComponentProps<T>) => (\r\n    <LazyLoad component={LazyComponent} fallback={fallback} />\r\n  );\r\n}\r\n\r\n/**\r\n * 预加载组件\r\n */\r\nexport function preloadComponent(\r\n  importFunc: () => Promise<{ default: ComponentType<any> }>\r\n): void {\r\n  // 触发组件的预加载\r\n  importFunc().catch((error) => {\r\n    console.error('Preload component error:', error);\r\n  });\r\n}\r\n\r\nexport default LazyLoad;\r\n",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\PermissionConfigModal.tsx",
        "messages": [
          {
            "ruleId": "react-hooks/exhaustive-deps",
            "severity": 1,
            "message": "React Hook useEffect has a missing dependency: 'loadPermissions'. Either include it or remove the dependency array.",
            "line": 183,
            "column": 6,
            "nodeType": "ArrayExpression",
            "endLine": 183,
            "endColumn": 15,
            "suggestions": [
              {
                "desc": "Update the dependencies array to be: [loadPermissions, visible]",
                "fix": {
                  "range": [
                    4629,
                    4638
                  ],
                  "text": "[loadPermissions, visible]"
                }
              }
            ]
          },
          {
            "ruleId": "react-hooks/exhaustive-deps",
            "severity": 1,
            "message": "React Hook useEffect has a missing dependency: 'setRolePermissions'. Either include it or remove the dependency array.",
            "line": 190,
            "column": 6,
            "nodeType": "ArrayExpression",
            "endLine": 190,
            "endColumn": 34,
            "suggestions": [
              {
                "desc": "Update the dependencies array to be: [visible, role, permissions, setRolePermissions]",
                "fix": {
                  "range": [
                    4777,
                    4805
                  ],
                  "text": "[visible, role, permissions, setRolePermissions]"
                }
              }
            ]
          }
        ],
        "suppressedMessages": [],
        "errorCount": 0,
        "fatalErrorCount": 0,
        "warningCount": 2,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 权限配置弹窗组件\r\n */\r\nimport React, { useState, useEffect } from 'react'\r\nimport {\r\n  Modal,\r\n  Tree,\r\n  Message,\r\n  Button,\r\n  Spin,\r\n  Empty,\r\n  Typography\r\n} from '@arco-design/web-react'\r\n// TreeNodeData 类型定义\r\nimport { Role, Permission } from '../types'\r\nimport RoleService from '../api/roleService'\r\n\r\nconst { Title } = Typography\r\n\r\ninterface PermissionConfigModalProps {\r\n  visible: boolean\r\n  role: Role | null\r\n  onCancel: () => void\r\n  onSuccess: () => void\r\n}\r\n\r\ninterface PermissionTreeNode {\r\n  key: string\r\n  title: string\r\n  children?: PermissionTreeNode[]\r\n  isModule?: boolean\r\n  permissionId?: number\r\n}\r\n\r\nconst PermissionConfigModal: React.FC<PermissionConfigModalProps> = ({\r\n  visible,\r\n  role,\r\n  onCancel,\r\n  onSuccess\r\n}) => {\r\n  const [loading, setLoading] = useState(false)\r\n  const [saveLoading, setSaveLoading] = useState(false)\r\n  const [permissions, setPermissions] = useState<Permission[]>([])\r\n  const [treeData, setTreeData] = useState<PermissionTreeNode[]>([])\r\n  const [checkedKeys, setCheckedKeys] = useState<string[]>([])\r\n  const [expandedKeys, setExpandedKeys] = useState<string[]>([])\r\n\r\n  // 加载权限列表\r\n  const loadPermissions = async () => {\r\n    try {\r\n      setLoading(true)\r\n      const result = await RoleService.getPermissions()\r\n      \r\n      if (result.code === 0) {\r\n        setPermissions(result.data)\r\n        buildTreeData(result.data)\r\n      } else {\r\n        Message.error(result.message || '获取权限列表失败')\r\n      }\r\n    } catch (error: any) {\r\n      const errorMessage = error?.response?.data?.message || '获取权限列表失败'\r\n      Message.error(errorMessage)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  // 构建权限树数据\r\n  const buildTreeData = (permissionList: Permission[]) => {\r\n    // 按模块分组\r\n    const moduleMap = new Map<string, Permission[]>()\r\n    \r\n    permissionList.forEach(permission => {\r\n      const module = permission.module\r\n      if (!moduleMap.has(module)) {\r\n        moduleMap.set(module, [])\r\n      }\r\n      moduleMap.get(module)!.push(permission)\r\n    })\r\n\r\n    // 构建树形结构\r\n    const treeNodes: PermissionTreeNode[] = []\r\n    const expandedModules: string[] = []\r\n\r\n    moduleMap.forEach((modulePermissions, moduleName) => {\r\n      const moduleKey = `module_${moduleName}`\r\n      expandedModules.push(moduleKey)\r\n      \r\n      const moduleNode: PermissionTreeNode = {\r\n        key: moduleKey,\r\n        title: getModuleDisplayName(moduleName),\r\n        isModule: true,\r\n        children: modulePermissions.map(permission => ({\r\n          key: `permission_${permission.id}`,\r\n          title: permission.name,\r\n          isModule: false,\r\n          permissionId: permission.id\r\n        }))\r\n      }\r\n      \r\n      treeNodes.push(moduleNode)\r\n    })\r\n\r\n    setTreeData(treeNodes)\r\n    setExpandedKeys(expandedModules)\r\n  }\r\n\r\n  // 获取模块显示名称\r\n  const getModuleDisplayName = (module: string): string => {\r\n    const moduleNames: Record<string, string> = {\r\n      'system': '系统管理',\r\n      'department': '部门管理',\r\n      'user': '用户管理',\r\n      'role': '角色管理',\r\n      'audit': '审计日志',\r\n      'store': '门店管理',\r\n      'plan': '计划管理',\r\n      'expansion': '拓店管理',\r\n      'construction': '筹备管理',\r\n      'operation': '运营管理',\r\n      'approval': '审批中心',\r\n      'report': '数据报表'\r\n    }\r\n    return moduleNames[module] || module\r\n  }\r\n\r\n  // 设置角色已有权限\r\n  const setRolePermissions = () => {\r\n    if (role && role.permission_list) {\r\n      const rolePermissionIds = role.permission_list.map(p => `permission_${p.id}`)\r\n      setCheckedKeys(rolePermissionIds)\r\n    } else {\r\n      setCheckedKeys([])\r\n    }\r\n  }\r\n\r\n  // 处理权限选择变化\r\n  const handleCheck = (checkedKeys: string[]) => {\r\n    setCheckedKeys(checkedKeys)\r\n  }\r\n\r\n  // 保存权限配置\r\n  const handleSave = async () => {\r\n    if (!role) return\r\n\r\n    try {\r\n      setSaveLoading(true)\r\n      \r\n      // 提取权限ID\r\n      const permissionIds = checkedKeys\r\n        .filter(key => key.startsWith('permission_'))\r\n        .map(key => parseInt(key.replace('permission_', '')))\r\n\r\n      const result = await RoleService.assignPermissions(role.id, {\r\n        permission_ids: permissionIds\r\n      })\r\n\r\n      if (result.code === 0) {\r\n        Message.success('权限配置保存成功')\r\n        onSuccess()\r\n      } else {\r\n        Message.error(result.message || '保存失败')\r\n      }\r\n    } catch (error: any) {\r\n      const errorMessage = error?.response?.data?.message || '保存失败'\r\n      Message.error(errorMessage)\r\n    } finally {\r\n      setSaveLoading(false)\r\n    }\r\n  }\r\n\r\n  // 取消操作\r\n  const handleCancel = () => {\r\n    setCheckedKeys([])\r\n    onCancel()\r\n  }\r\n\r\n  // 当弹窗打开时加载数据\r\n  useEffect(() => {\r\n    if (visible) {\r\n      loadPermissions()\r\n    }\r\n  }, [visible])\r\n\r\n  // 当角色数据变化时设置权限\r\n  useEffect(() => {\r\n    if (visible && role && permissions.length > 0) {\r\n      setRolePermissions()\r\n    }\r\n  }, [visible, role, permissions])\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div>\r\n          <Title heading={5} style={{ margin: 0 }}>\r\n            配置权限 - {role?.name}\r\n          </Title>\r\n        </div>\r\n      }\r\n      visible={visible}\r\n      onCancel={handleCancel}\r\n      footer={[\r\n        <Button key=\"cancel\" onClick={handleCancel}>\r\n          取消\r\n        </Button>,\r\n        <Button\r\n          key=\"save\"\r\n          type=\"primary\"\r\n          loading={saveLoading}\r\n          onClick={handleSave}\r\n        >\r\n          保存\r\n        </Button>\r\n      ]}\r\n      maskClosable={false}\r\n      style={{ maxHeight: '80vh', width: '600px' }}\r\n    >\r\n      <div style={{ maxHeight: '60vh', overflow: 'auto' }}>\r\n        <Spin loading={loading}>\r\n          {treeData.length > 0 ? (\r\n            <Tree\r\n              treeData={treeData}\r\n              checkable\r\n              checkedKeys={checkedKeys}\r\n              expandedKeys={expandedKeys}\r\n              onCheck={handleCheck}\r\n              onExpand={setExpandedKeys}\r\n              blockNode\r\n              size=\"small\"\r\n              style={{ \r\n                backgroundColor: '#fafafa',\r\n                padding: '12px',\r\n                borderRadius: '6px',\r\n                border: '1px solid #e5e6eb'\r\n              }}\r\n            />\r\n          ) : (\r\n            !loading && (\r\n              <Empty\r\n                description=\"暂无权限数据\"\r\n                style={{ padding: '40px 0' }}\r\n              />\r\n            )\r\n          )}\r\n        </Spin>\r\n      </div>\r\n      \r\n      {checkedKeys.length > 0 && (\r\n        <div style={{ \r\n          marginTop: '16px', \r\n          padding: '12px', \r\n          backgroundColor: '#f2f3f5', \r\n          borderRadius: '6px',\r\n          fontSize: '12px',\r\n          color: '#86909c'\r\n        }}>\r\n          已选择 {checkedKeys.filter(key => key.startsWith('permission_')).length} 个权限\r\n        </div>\r\n      )}\r\n    </Modal>\r\n  )\r\n}\r\n\r\nexport default PermissionConfigModal",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\RoleAssignModal.tsx",
        "messages": [
          {
            "ruleId": "react-hooks/exhaustive-deps",
            "severity": 1,
            "message": "React Hook useEffect has a missing dependency: 'initUserRoles'. Either include it or remove the dependency array.",
            "line": 89,
            "column": 6,
            "nodeType": "ArrayExpression",
            "endLine": 89,
            "endColumn": 21,
            "suggestions": [
              {
                "desc": "Update the dependencies array to be: [visible, user, initUserRoles]",
                "fix": {
                  "range": [
                    2162,
                    2177
                  ],
                  "text": "[visible, user, initUserRoles]"
                }
              }
            ]
          }
        ],
        "suppressedMessages": [],
        "errorCount": 0,
        "fatalErrorCount": 0,
        "warningCount": 1,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 角色分配弹窗组件\r\n */\r\nimport React, { useState, useEffect } from 'react'\r\nimport {\r\n  Modal,\r\n  Transfer,\r\n  Message,\r\n  Spin\r\n} from '@arco-design/web-react'\r\nimport { User, Role } from '../types'\r\nimport RoleService from '../api/roleService'\r\nimport UserService from '../api/userService'\r\n\r\ninterface RoleAssignModalProps {\r\n  visible: boolean\r\n  user: User | null\r\n  onCancel: () => void\r\n  onSuccess: () => void\r\n}\r\n\r\nconst RoleAssignModal: React.FC<RoleAssignModalProps> = ({\r\n  visible,\r\n  user,\r\n  onCancel,\r\n  onSuccess\r\n}) => {\r\n  const [loading, setLoading] = useState(false)\r\n  const [submitting, setSubmitting] = useState(false)\r\n  const [allRoles, setAllRoles] = useState<Role[]>([])\r\n  const [selectedRoleIds, setSelectedRoleIds] = useState<string[]>([])\r\n\r\n  // 加载所有角色\r\n  const loadRoles = async () => {\r\n    try {\r\n      setLoading(true)\r\n      const roles = await RoleService.getActiveRoles()\r\n      setAllRoles(roles)\r\n    } catch (error: any) {\r\n      Message.error('获取角色列表失败')\r\n      console.error('获取角色列表失败:', error)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  // 初始化用户已有角色\r\n  const initUserRoles = () => {\r\n    if (user && user.role_list) {\r\n      const roleIds = user.role_list.map(role => role.id.toString())\r\n      setSelectedRoleIds(roleIds)\r\n    } else {\r\n      setSelectedRoleIds([])\r\n    }\r\n  }\r\n\r\n  // 提交角色分配\r\n  const handleSubmit = async () => {\r\n    if (!user) return\r\n\r\n    try {\r\n      setSubmitting(true)\r\n      const roleIds = selectedRoleIds.map(id => parseInt(id))\r\n      await UserService.assignRoles(user.id, { role_ids: roleIds })\r\n      Message.success('角色分配成功')\r\n      onSuccess()\r\n    } catch (error: any) {\r\n      const errorMessage = error?.response?.data?.message || '角色分配失败'\r\n      Message.error(errorMessage)\r\n    } finally {\r\n      setSubmitting(false)\r\n    }\r\n  }\r\n\r\n  // 转换角色数据为 Transfer 组件需要的格式\r\n  const transferData = allRoles.map(role => ({\r\n    key: role.id.toString(),\r\n    value: role.id.toString(),\r\n    title: role.name,\r\n    description: role.description || '暂无描述'\r\n  }))\r\n\r\n  // 监听弹窗显示状态\r\n  useEffect(() => {\r\n    if (visible) {\r\n      loadRoles()\r\n      initUserRoles()\r\n    }\r\n  }, [visible, user])\r\n\r\n  return (\r\n    <Modal\r\n      title={`为用户 \"${user?.full_name}\" 分配角色`}\r\n      visible={visible}\r\n      onCancel={onCancel}\r\n      onOk={handleSubmit}\r\n      confirmLoading={submitting}\r\n      style={{ width: '600px' }}\r\n      maskClosable={false}\r\n    >\r\n      <Spin loading={loading}>\r\n        <div style={{ minHeight: '300px' }}>\r\n          <Transfer\r\n            dataSource={transferData}\r\n            targetKeys={selectedRoleIds}\r\n            onChange={setSelectedRoleIds}\r\n            showSearch\r\n            searchPlaceholder=\"搜索角色\"\r\n            listStyle={{\r\n              width: '250px',\r\n              height: '300px'\r\n            }}\r\n          />\r\n        </div>\r\n      </Spin>\r\n    </Modal>\r\n  )\r\n}\r\n\r\nexport default RoleAssignModal",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\RoleMembersModal.tsx",
        "messages": [
          {
            "ruleId": "react-hooks/exhaustive-deps",
            "severity": 1,
            "message": "React Hook useEffect has a missing dependency: 'loadMembers'. Either include it or remove the dependency array.",
            "line": 200,
            "column": 6,
            "nodeType": "ArrayExpression",
            "endLine": 200,
            "endColumn": 21,
            "suggestions": [
              {
                "desc": "Update the dependencies array to be: [visible, role, loadMembers]",
                "fix": {
                  "range": [
                    5195,
                    5210
                  ],
                  "text": "[visible, role, loadMembers]"
                }
              }
            ]
          },
          {
            "ruleId": "react-hooks/exhaustive-deps",
            "severity": 1,
            "message": "React Hook useEffect has missing dependencies: 'allUsers.length' and 'loadAllUsers'. Either include them or remove the dependency array.",
            "line": 207,
            "column": 6,
            "nodeType": "ArrayExpression",
            "endLine": 207,
            "endColumn": 26,
            "suggestions": [
              {
                "desc": "Update the dependencies array to be: [visible, activeTab, allUsers.length, loadAllUsers]",
                "fix": {
                  "range": [
                    5363,
                    5383
                  ],
                  "text": "[visible, activeTab, allUsers.length, loadAllUsers]"
                }
              }
            ]
          }
        ],
        "suppressedMessages": [],
        "errorCount": 0,
        "fatalErrorCount": 0,
        "warningCount": 2,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 角色成员管理弹窗组件\r\n */\r\nimport React, { useState, useEffect } from 'react'\r\nimport {\r\n  Modal,\r\n  Table,\r\n  Button,\r\n  Message,\r\n  Space,\r\n  Typography,\r\n  Input,\r\n  Tag,\r\n  Transfer,\r\n  Tabs,\r\n  Empty,\r\n  Spin\r\n} from '@arco-design/web-react'\r\nimport {\r\n  IconSearch,\r\n\r\n  IconRefresh\r\n} from '@arco-design/web-react/icon'\r\nimport { ColumnProps } from '@arco-design/web-react/es/Table'\r\nimport { Role, User } from '../types'\r\nimport RoleService from '../api/roleService'\r\nimport UserService from '../api/userService'\r\n\r\nconst { Title } = Typography\r\nconst { TabPane } = Tabs\r\n\r\ninterface RoleMembersModalProps {\r\n  visible: boolean\r\n  role: Role | null\r\n  onCancel: () => void\r\n  onSuccess: () => void\r\n}\r\n\r\nconst RoleMembersModal: React.FC<RoleMembersModalProps> = ({\r\n  visible,\r\n  role,\r\n  onCancel,\r\n  onSuccess\r\n}) => {\r\n  const [loading, setLoading] = useState(false)\r\n  const [saveLoading, setSaveLoading] = useState(false)\r\n  const [activeTab, setActiveTab] = useState('members')\r\n  \r\n  // 成员列表相关状态\r\n  const [members, setMembers] = useState<User[]>([])\r\n  const [memberSearch, setMemberSearch] = useState('')\r\n  \r\n  // 添加成员相关状态\r\n  const [allUsers, setAllUsers] = useState<User[]>([])\r\n  const [transferTargetKeys, setTransferTargetKeys] = useState<string[]>([])\r\n  const [transferDataSource, setTransferDataSource] = useState<any[]>([])\r\n\r\n  // 加载角色成员列表\r\n  const loadMembers = async () => {\r\n    if (!role) return\r\n\r\n    try {\r\n      setLoading(true)\r\n      const result = await RoleService.getRoleMembers(role.id)\r\n      \r\n      if (result.code === 0) {\r\n        setMembers(result.data)\r\n      } else {\r\n        Message.error(result.message || '获取成员列表失败')\r\n      }\r\n    } catch (error: any) {\r\n      const errorMessage = error?.response?.data?.message || '获取成员列表失败'\r\n      Message.error(errorMessage)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  // 加载所有用户（用于添加成员）\r\n  const loadAllUsers = async () => {\r\n    try {\r\n      const response = await UserService.getUsers({ \r\n        is_active: true, \r\n        page_size: 1000 \r\n      })\r\n      setAllUsers(response.results)\r\n      \r\n      // 构建穿梭框数据源\r\n      const dataSource = response.results.map(user => ({\r\n        key: user.id.toString(),\r\n        title: `${user.full_name} (${user.username})`,\r\n        description: user.department_name || '未分配部门',\r\n        disabled: false\r\n      }))\r\n      setTransferDataSource(dataSource)\r\n      \r\n      // 设置已选中的用户\r\n      if (role) {\r\n        const currentMemberIds = members.map(member => member.id.toString())\r\n        setTransferTargetKeys(currentMemberIds)\r\n      }\r\n    } catch (error: any) {\r\n      const errorMessage = error?.response?.data?.message || '获取用户列表失败'\r\n      Message.error(errorMessage)\r\n    }\r\n  }\r\n\r\n  // 添加成员\r\n  const handleAddMembers = async () => {\r\n    if (!role) return\r\n\r\n    try {\r\n      setSaveLoading(true)\r\n      \r\n      // 获取新增的用户ID\r\n      const currentMemberIds = members.map(member => member.id.toString())\r\n      const newMemberIds = transferTargetKeys.filter(key => !currentMemberIds.includes(key))\r\n      \r\n      if (newMemberIds.length === 0) {\r\n        Message.info('没有新增的成员')\r\n        return\r\n      }\r\n\r\n      const result = await RoleService.addRoleMembers(role.id, {\r\n        user_ids: newMemberIds.map(id => parseInt(id))\r\n      })\r\n\r\n      if (result.code === 0) {\r\n        Message.success(`成功添加 ${newMemberIds.length} 个成员`)\r\n        await loadMembers() // 重新加载成员列表\r\n        onSuccess() // 通知父组件更新\r\n      } else {\r\n        Message.error(result.message || '添加成员失败')\r\n      }\r\n    } catch (error: any) {\r\n      const errorMessage = error?.response?.data?.message || '添加成员失败'\r\n      Message.error(errorMessage)\r\n    } finally {\r\n      setSaveLoading(false)\r\n    }\r\n  }\r\n\r\n  // 筛选成员\r\n  const filteredMembers = members.filter(member => {\r\n    if (!memberSearch) return true\r\n    return (\r\n      member.full_name.toLowerCase().includes(memberSearch.toLowerCase()) ||\r\n      member.username.toLowerCase().includes(memberSearch.toLowerCase()) ||\r\n      (member.department_name && member.department_name.toLowerCase().includes(memberSearch.toLowerCase()))\r\n    )\r\n  })\r\n\r\n  // 成员列表表格列定义\r\n  const memberColumns: ColumnProps<User>[] = [\r\n    {\r\n      title: '用户名',\r\n      dataIndex: 'username',\r\n      width: 120,\r\n      render: (username: string, record: User) => (\r\n        <div>\r\n          <div>{username}</div>\r\n          <div style={{ fontSize: '12px', color: '#86909c' }}>{record.full_name}</div>\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      title: '手机号',\r\n      dataIndex: 'phone',\r\n      width: 120\r\n    },\r\n    {\r\n      title: '部门',\r\n      dataIndex: 'department_name',\r\n      width: 150,\r\n      render: (departmentName: string) => departmentName || '-'\r\n    },\r\n    {\r\n      title: '职位',\r\n      dataIndex: 'position',\r\n      width: 120,\r\n      render: (position: string) => position || '-'\r\n    },\r\n    {\r\n      title: '状态',\r\n      dataIndex: 'is_active',\r\n      width: 80,\r\n      render: (isActive: boolean) => (\r\n        <Tag color={isActive ? 'green' : 'red'}>\r\n          {isActive ? '启用' : '停用'}\r\n        </Tag>\r\n      )\r\n    }\r\n  ]\r\n\r\n  // 当弹窗打开时加载数据\r\n  useEffect(() => {\r\n    if (visible && role) {\r\n      loadMembers()\r\n    }\r\n  }, [visible, role])\r\n\r\n  // 当切换到添加成员标签页时加载用户数据\r\n  useEffect(() => {\r\n    if (visible && activeTab === 'add' && allUsers.length === 0) {\r\n      loadAllUsers()\r\n    }\r\n  }, [visible, activeTab])\r\n\r\n  // 当成员数据变化时更新穿梭框选中状态\r\n  useEffect(() => {\r\n    if (members.length > 0 && transferDataSource.length > 0) {\r\n      const currentMemberIds = members.map(member => member.id.toString())\r\n      setTransferTargetKeys(currentMemberIds)\r\n    }\r\n  }, [members, transferDataSource])\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div>\r\n          <Title heading={5} style={{ margin: 0 }}>\r\n            管理成员 - {role?.name}\r\n          </Title>\r\n        </div>\r\n      }\r\n      visible={visible}\r\n      onCancel={onCancel}\r\n      footer={\r\n        activeTab === 'add' ? [\r\n          <Button key=\"cancel\" onClick={onCancel}>\r\n            取消\r\n          </Button>,\r\n          <Button\r\n            key=\"save\"\r\n            type=\"primary\"\r\n            loading={saveLoading}\r\n            onClick={handleAddMembers}\r\n          >\r\n            添加成员\r\n          </Button>\r\n        ] : [\r\n          <Button key=\"close\" type=\"primary\" onClick={onCancel}>\r\n            关闭\r\n          </Button>\r\n        ]\r\n      }\r\n      maskClosable={false}\r\n      style={{ maxHeight: '80vh', width: '800px' }}\r\n    >\r\n      <Tabs activeTab={activeTab} onChange={setActiveTab}>\r\n        <TabPane key=\"members\" title={`当前成员 (${members.length})`}>\r\n          <div style={{ marginBottom: '16px' }}>\r\n            <Space>\r\n              <Input\r\n                placeholder=\"搜索成员\"\r\n                value={memberSearch}\r\n                onChange={setMemberSearch}\r\n                prefix={<IconSearch />}\r\n                style={{ width: 200 }}\r\n                allowClear\r\n              />\r\n              <Button\r\n                icon={<IconRefresh />}\r\n                onClick={loadMembers}\r\n                loading={loading}\r\n              >\r\n                刷新\r\n              </Button>\r\n            </Space>\r\n          </div>\r\n\r\n          <div style={{ maxHeight: '50vh', overflow: 'auto' }}>\r\n            {filteredMembers.length > 0 ? (\r\n              <Table\r\n                columns={memberColumns}\r\n                data={filteredMembers}\r\n                loading={loading}\r\n                rowKey=\"id\"\r\n                size=\"small\"\r\n                pagination={false}\r\n                scroll={{ x: 600 }}\r\n              />\r\n            ) : (\r\n              <Empty\r\n                description={memberSearch ? '没有找到匹配的成员' : '暂无成员'}\r\n                style={{ padding: '40px 0' }}\r\n              />\r\n            )}\r\n          </div>\r\n        </TabPane>\r\n\r\n        <TabPane key=\"add\" title=\"添加成员\">\r\n          <div style={{ maxHeight: '50vh', overflow: 'auto' }}>\r\n            {transferDataSource.length > 0 ? (\r\n              <Transfer\r\n                dataSource={transferDataSource}\r\n                targetKeys={transferTargetKeys}\r\n                onChange={setTransferTargetKeys}\r\n                showSearch\r\n                searchPlaceholder=\"搜索用户\"\r\n\r\n                listStyle={{\r\n                  width: 300,\r\n                  height: 400\r\n                }}\r\n              />\r\n            ) : (\r\n              <div style={{ textAlign: 'center', padding: '40px 0' }}>\r\n                <Spin />\r\n                <div style={{ marginTop: '8px', color: '#86909c' }}>\r\n                  加载用户数据中...\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </TabPane>\r\n      </Tabs>\r\n    </Modal>\r\n  )\r\n}\r\n\r\nexport default RoleMembersModal",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\SystemMonitoring\\SystemHealthDashboard.tsx",
        "messages": [
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'useEffect' is defined but never used.",
            "line": 1,
            "column": 27,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 1,
            "endColumn": 36
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'Tooltip' is defined but never used.",
            "line": 16,
            "column": 3,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 16,
            "endColumn": 10
          }
        ],
        "suppressedMessages": [],
        "errorCount": 2,
        "fatalErrorCount": 0,
        "warningCount": 0,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "import React, { useState, useEffect } from 'react';\r\nimport {\r\n  Card,\r\n  Grid,\r\n  Typography,\r\n  Badge,\r\n  Progress,\r\n  Alert,\r\n  Button,\r\n  Space,\r\n  Statistic,\r\n  Table,\r\n  Tag,\r\n  Modal,\r\n  Spin,\r\n  Tooltip,\r\n  Row,\r\n  Col\r\n} from '@arco-design/web-react';\r\nimport {\r\n  IconRefresh,\r\n  IconExclamationCircleFill,\r\n  IconCheckCircleFill,\r\n  IconCloseCircleFill,\r\n  IconInfoCircleFill,\r\n  IconSettings,\r\n  IconEye\r\n} from '@arco-design/web-react/icon';\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { systemMonitoringApi } from '../../api/systemMonitoring';\r\n\r\nconst { Row: GridRow, Col: GridCol } = Grid;\r\n\r\ninterface SystemHealthData {\r\n  overall_status: 'healthy' | 'warning' | 'critical' | 'error';\r\n  timestamp: string;\r\n  components: {\r\n    [key: string]: {\r\n      status: string;\r\n      last_check: string;\r\n      [key: string]: any;\r\n    };\r\n  };\r\n  alerts: Array<{\r\n    type: string;\r\n    level: 'info' | 'warning' | 'critical';\r\n    message: string;\r\n    timestamp: string;\r\n  }>;\r\n  metrics: {\r\n    [key: string]: any;\r\n  };\r\n}\r\n\r\nconst SystemHealthDashboard: React.FC = () => {\r\n  const [selectedComponent, setSelectedComponent] = useState<string | null>(null);\r\n  const [alertsModalVisible, setAlertsModalVisible] = useState(false);\r\n  const queryClient = useQueryClient();\r\n\r\n  // 获取系统健康状态\r\n  const {\r\n    data: healthData,\r\n    isLoading,\r\n    error,\r\n    refetch\r\n  } = useQuery<SystemHealthData>({\r\n    queryKey: ['systemHealth'],\r\n    queryFn: systemMonitoringApi.getSystemHealth,\r\n    refetchInterval: 30000, // 30秒自动刷新\r\n    retry: 3\r\n  });\r\n\r\n  // 手动健康检查\r\n  const manualHealthCheckMutation = useMutation({\r\n    mutationFn: systemMonitoringApi.manualHealthCheck,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['systemHealth'] });\r\n    }\r\n  });\r\n\r\n  // 性能优化\r\n  const performanceOptimizationMutation = useMutation({\r\n    mutationFn: (params: { type: string; dry_run: boolean }) =>\r\n      systemMonitoringApi.optimizePerformance(params),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['systemHealth'] });\r\n    }\r\n  });\r\n\r\n  // 获取状态颜色和图标\r\n  const getStatusDisplay = (status: string) => {\r\n    switch (status) {\r\n      case 'healthy':\r\n        return {\r\n          color: 'green',\r\n          icon: <IconCheckCircleFill style={{ color: '#00b42a' }} />,\r\n          text: '正常'\r\n        };\r\n      case 'warning':\r\n        return {\r\n          color: 'orange',\r\n          icon: <IconExclamationCircleFill style={{ color: '#ff7d00' }} />,\r\n          text: '警告'\r\n        };\r\n      case 'critical':\r\n        return {\r\n          color: 'red',\r\n          icon: <IconCloseCircleFill style={{ color: '#f53f3f' }} />,\r\n          text: '严重'\r\n        };\r\n      case 'error':\r\n        return {\r\n          color: 'red',\r\n          icon: <IconCloseCircleFill style={{ color: '#f53f3f' }} />,\r\n          text: '错误'\r\n        };\r\n      default:\r\n        return {\r\n          color: 'gray',\r\n          icon: <IconInfoCircleFill style={{ color: '#86909c' }} />,\r\n          text: '未知'\r\n        };\r\n    }\r\n  };\r\n\r\n  // 组件状态卡片\r\n  const ComponentStatusCard: React.FC<{\r\n    name: string;\r\n    data: any;\r\n    onClick: () => void;\r\n  }> = ({ name, data, onClick }) => {\r\n    const statusDisplay = getStatusDisplay(data.status);\r\n    \r\n    return (\r\n      <Card\r\n        hoverable\r\n        onClick={onClick}\r\n        style={{ cursor: 'pointer' }}\r\n        title={\r\n          <Space>\r\n            {statusDisplay.icon}\r\n            <span>{getComponentDisplayName(name)}</span>\r\n            <Badge\r\n              status={statusDisplay.color as any}\r\n              text={statusDisplay.text}\r\n            />\r\n          </Space>\r\n        }\r\n      >\r\n        <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n          {renderComponentMetrics(name, data)}\r\n          <Typography.Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            最后检查: {new Date(data.last_check).toLocaleString()}\r\n          </Typography.Text>\r\n        </Space>\r\n      </Card>\r\n    );\r\n  };\r\n\r\n  // 获取组件显示名称\r\n  const getComponentDisplayName = (name: string) => {\r\n    const nameMap: { [key: string]: string } = {\r\n      database: '数据库',\r\n      cache: '缓存系统',\r\n      system: '系统资源',\r\n      data_tasks: '数据任务',\r\n      reports: '报表生成'\r\n    };\r\n    return nameMap[name] || name;\r\n  };\r\n\r\n  // 渲染组件指标\r\n  const renderComponentMetrics = (name: string, data: any) => {\r\n    switch (name) {\r\n      case 'database':\r\n        return (\r\n          <Row gutter={16}>\r\n            <Col span={12}>\r\n              <Statistic\r\n                title=\"响应时间\"\r\n                value={data.response_time}\r\n                suffix=\"s\"\r\n                precision={3}\r\n              />\r\n            </Col>\r\n            <Col span={12}>\r\n              <Statistic\r\n                title=\"活跃连接\"\r\n                value={data.active_connections}\r\n              />\r\n            </Col>\r\n          </Row>\r\n        );\r\n      \r\n      case 'cache':\r\n        return (\r\n          <Row gutter={16}>\r\n            <Col span={12}>\r\n              <Statistic\r\n                title=\"命中率\"\r\n                value={data.hit_rate}\r\n                suffix=\"%\"\r\n                precision={1}\r\n              />\r\n            </Col>\r\n            <Col span={12}>\r\n              <Statistic\r\n                title=\"缓存键数\"\r\n                value={data.total_keys}\r\n              />\r\n            </Col>\r\n          </Row>\r\n        );\r\n      \r\n      case 'system':\r\n        return (\r\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n            <div>\r\n              <Typography.Text>CPU使用率</Typography.Text>\r\n              <Progress\r\n                percent={data.cpu_percent}\r\n                status={data.cpu_percent > 80 ? 'danger' : 'normal'}\r\n                showText\r\n              />\r\n            </div>\r\n            <div>\r\n              <Typography.Text>内存使用率</Typography.Text>\r\n              <Progress\r\n                percent={data.memory_percent}\r\n                status={data.memory_percent > 80 ? 'danger' : 'normal'}\r\n                showText\r\n              />\r\n            </div>\r\n          </Space>\r\n        );\r\n      \r\n      case 'data_tasks':\r\n        return (\r\n          <Row gutter={16}>\r\n            <Col span={12}>\r\n              <Statistic\r\n                title=\"成功率\"\r\n                value={data.success_rate}\r\n                suffix=\"%\"\r\n                precision={1}\r\n              />\r\n            </Col>\r\n            <Col span={12}>\r\n              <Statistic\r\n                title=\"1小时任务数\"\r\n                value={data.total_tasks_1h}\r\n              />\r\n            </Col>\r\n          </Row>\r\n        );\r\n      \r\n      case 'reports':\r\n        return (\r\n          <Row gutter={16}>\r\n            <Col span={12}>\r\n              <Statistic\r\n                title=\"成功率\"\r\n                value={data.success_rate}\r\n                suffix=\"%\"\r\n                precision={1}\r\n              />\r\n            </Col>\r\n            <Col span={12}>\r\n              <Statistic\r\n                title=\"处理中\"\r\n                value={data.processing_tasks}\r\n              />\r\n            </Col>\r\n          </Row>\r\n        );\r\n      \r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  // 告警表格列配置\r\n  const alertColumns = [\r\n    {\r\n      title: '级别',\r\n      dataIndex: 'level',\r\n      key: 'level',\r\n      width: 80,\r\n      render: (level: string) => {\r\n        const colorMap = {\r\n          info: 'blue',\r\n          warning: 'orange',\r\n          critical: 'red'\r\n        };\r\n        return <Tag color={colorMap[level as keyof typeof colorMap]}>{level}</Tag>;\r\n      }\r\n    },\r\n    {\r\n      title: '类型',\r\n      dataIndex: 'type',\r\n      key: 'type',\r\n      width: 120\r\n    },\r\n    {\r\n      title: '消息',\r\n      dataIndex: 'message',\r\n      key: 'message',\r\n      ellipsis: true\r\n    },\r\n    {\r\n      title: '时间',\r\n      dataIndex: 'timestamp',\r\n      key: 'timestamp',\r\n      width: 160,\r\n      render: (timestamp: string) => new Date(timestamp).toLocaleString()\r\n    }\r\n  ];\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div style={{ textAlign: 'center', padding: '50px' }}>\r\n        <Spin size={40} />\r\n        <Typography.Text style={{ display: 'block', marginTop: '16px' }}>\r\n          正在加载系统健康状态...\r\n        </Typography.Text>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <Alert\r\n        type=\"error\"\r\n        title=\"加载失败\"\r\n        content=\"无法获取系统健康状态，请检查网络连接或联系管理员\"\r\n        action={\r\n          <Button size=\"small\" onClick={() => refetch()}>\r\n            重试\r\n          </Button>\r\n        }\r\n      />\r\n    );\r\n  }\r\n\r\n  const overallStatusDisplay = getStatusDisplay(healthData?.overall_status || 'unknown');\r\n\r\n  return (\r\n    <div style={{ padding: '24px' }}>\r\n      {/* 页面标题和操作 */}\r\n      <div style={{ marginBottom: '24px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n        <div>\r\n          <Typography.Title heading={4} style={{ margin: 0 }}>\r\n            系统监控大屏\r\n          </Typography.Title>\r\n          <Typography.Text type=\"secondary\">\r\n            最后更新: {healthData?.timestamp ? new Date(healthData.timestamp).toLocaleString() : '未知'}\r\n          </Typography.Text>\r\n        </div>\r\n        <Space>\r\n          <Button\r\n            icon={<IconRefresh />}\r\n            onClick={() => refetch()}\r\n            loading={isLoading}\r\n          >\r\n            刷新\r\n          </Button>\r\n          <Button\r\n            icon={<IconSettings />}\r\n            onClick={() => manualHealthCheckMutation.mutate()}\r\n            loading={manualHealthCheckMutation.isPending}\r\n          >\r\n            手动检查\r\n          </Button>\r\n          <Button\r\n            type=\"primary\"\r\n            onClick={() => performanceOptimizationMutation.mutate({ type: 'all', dry_run: false })}\r\n            loading={performanceOptimizationMutation.isPending}\r\n          >\r\n            性能优化\r\n          </Button>\r\n        </Space>\r\n      </div>\r\n\r\n      {/* 整体状态卡片 */}\r\n      <Card style={{ marginBottom: '24px' }}>\r\n        <Row gutter={24} align=\"center\">\r\n          <Col>\r\n            <Space size=\"large\">\r\n              {overallStatusDisplay.icon}\r\n              <div>\r\n                <Typography.Title heading={5} style={{ margin: 0 }}>\r\n                  系统整体状态: {overallStatusDisplay.text}\r\n                </Typography.Title>\r\n                <Typography.Text type=\"secondary\">\r\n                  {healthData?.alerts?.length || 0} 个告警\r\n                </Typography.Text>\r\n              </div>\r\n            </Space>\r\n          </Col>\r\n          <Col flex={1}>\r\n            {healthData?.alerts && healthData.alerts.length > 0 && (\r\n              <Button\r\n                type=\"text\"\r\n                icon={<IconEye />}\r\n                onClick={() => setAlertsModalVisible(true)}\r\n              >\r\n                查看告警详情\r\n              </Button>\r\n            )}\r\n          </Col>\r\n        </Row>\r\n      </Card>\r\n\r\n      {/* 组件状态网格 */}\r\n      <GridRow gutter={[16, 16]} style={{ marginBottom: '24px' }}>\r\n        {healthData?.components && Object.entries(healthData.components).map(([name, data]) => (\r\n          <GridCol span={8} key={name}>\r\n            <ComponentStatusCard\r\n              name={name}\r\n              data={data}\r\n              onClick={() => setSelectedComponent(name)}\r\n            />\r\n          </GridCol>\r\n        ))}\r\n      </GridRow>\r\n\r\n      {/* 性能指标概览 */}\r\n      {healthData?.metrics && (\r\n        <Card title=\"性能指标概览\" style={{ marginBottom: '24px' }}>\r\n          <Row gutter={[24, 16]}>\r\n            {/* 数据库指标 */}\r\n            {healthData.metrics.database && (\r\n              <Col span={6}>\r\n                <Card size=\"small\" title=\"数据库\">\r\n                  <Statistic\r\n                    title=\"表操作数\"\r\n                    value={healthData.metrics.database.table_stats?.[0]?.total_operations || 0}\r\n                  />\r\n                </Card>\r\n              </Col>\r\n            )}\r\n            \r\n            {/* API指标 */}\r\n            {healthData.metrics.api && (\r\n              <Col span={6}>\r\n                <Card size=\"small\" title=\"API性能\">\r\n                  <Space direction=\"vertical\">\r\n                    <Statistic\r\n                      title=\"平均响应时间\"\r\n                      value={healthData.metrics.api.avg_response_time}\r\n                      suffix=\"s\"\r\n                      precision={3}\r\n                    />\r\n                    <Statistic\r\n                      title=\"错误率\"\r\n                      value={healthData.metrics.api.error_rate}\r\n                      suffix=\"%\"\r\n                      precision={1}\r\n                    />\r\n                  </Space>\r\n                </Card>\r\n              </Col>\r\n            )}\r\n            \r\n            {/* 数据量指标 */}\r\n            {healthData.metrics.data_volume && (\r\n              <Col span={6}>\r\n                <Card size=\"small\" title=\"数据量\">\r\n                  <Space direction=\"vertical\">\r\n                    <Statistic\r\n                      title=\"门店总数\"\r\n                      value={healthData.metrics.data_volume.stores_total}\r\n                    />\r\n                    <Statistic\r\n                      title=\"运营门店\"\r\n                      value={healthData.metrics.data_volume.stores_operating}\r\n                    />\r\n                  </Space>\r\n                </Card>\r\n              </Col>\r\n            )}\r\n            \r\n            {/* 缓存指标 */}\r\n            {healthData.metrics.cache && (\r\n              <Col span={6}>\r\n                <Card size=\"small\" title=\"缓存\">\r\n                  <Space direction=\"vertical\">\r\n                    <Statistic\r\n                      title=\"命中率\"\r\n                      value={healthData.metrics.cache.hit_rate}\r\n                      suffix=\"%\"\r\n                      precision={1}\r\n                    />\r\n                    <Statistic\r\n                      title=\"缓存键数\"\r\n                      value={healthData.metrics.cache.total_keys}\r\n                    />\r\n                  </Space>\r\n                </Card>\r\n              </Col>\r\n            )}\r\n          </Row>\r\n        </Card>\r\n      )}\r\n\r\n      {/* 告警详情模态框 */}\r\n      <Modal\r\n        title=\"系统告警详情\"\r\n        visible={alertsModalVisible}\r\n        onCancel={() => setAlertsModalVisible(false)}\r\n        footer={null}\r\n        width={800}\r\n      >\r\n        <Table\r\n          columns={alertColumns}\r\n          data={healthData?.alerts || []}\r\n          pagination={false}\r\n          size=\"small\"\r\n        />\r\n      </Modal>\r\n\r\n      {/* 组件详情模态框 */}\r\n      <Modal\r\n        title={`${getComponentDisplayName(selectedComponent || '')} 详细信息`}\r\n        visible={!!selectedComponent}\r\n        onCancel={() => setSelectedComponent(null)}\r\n        footer={null}\r\n        width={600}\r\n      >\r\n        {selectedComponent && healthData?.components[selectedComponent] && (\r\n          <div>\r\n            <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n              <div>\r\n                <Typography.Text strong>状态: </Typography.Text>\r\n                <Badge\r\n                  status={getStatusDisplay(healthData.components[selectedComponent].status).color as any}\r\n                  text={getStatusDisplay(healthData.components[selectedComponent].status).text}\r\n                />\r\n              </div>\r\n              <div>\r\n                <Typography.Text strong>最后检查: </Typography.Text>\r\n                <Typography.Text>\r\n                  {new Date(healthData.components[selectedComponent].last_check).toLocaleString()}\r\n                </Typography.Text>\r\n              </div>\r\n              \r\n              {/* 详细指标 */}\r\n              <div style={{ marginTop: '16px' }}>\r\n                <Typography.Title heading={6}>详细指标</Typography.Title>\r\n                {Object.entries(healthData.components[selectedComponent])\r\n                  .filter(([key]) => !['status', 'last_check'].includes(key))\r\n                  .map(([key, value]) => (\r\n                    <div key={key} style={{ marginBottom: '8px' }}>\r\n                      <Typography.Text strong>{key}: </Typography.Text>\r\n                      <Typography.Text>{String(value)}</Typography.Text>\r\n                    </div>\r\n                  ))}\r\n              </div>\r\n            </Space>\r\n          </div>\r\n        )}\r\n      </Modal>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SystemHealthDashboard;",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\__tests__\\MainNavigation.test.tsx",
        "messages": [
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'screen' is defined but never used.",
            "line": 6,
            "column": 18,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 6,
            "endColumn": 24
          }
        ],
        "suppressedMessages": [],
        "errorCount": 1,
        "fatalErrorCount": 0,
        "warningCount": 0,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * MainNavigation 组件渲染测试\r\n * 验证组件能够成功挂载而不抛出图标导入错误\r\n */\r\nimport React from 'react'\r\nimport { render, screen } from '@testing-library/react'\r\nimport { describe, it, expect, vi } from 'vitest'\r\nimport { BrowserRouter } from 'react-router-dom'\r\nimport { MainNavigation } from '../MainNavigation'\r\n\r\n// Mock hooks\r\nvi.mock('../../hooks/usePermission', () => ({\r\n  usePermission: () => ({\r\n    hasModuleAccess: vi.fn(() => true),\r\n    hasPermission: vi.fn(() => true)\r\n  })\r\n}))\r\n\r\n// Mock PermissionGuard\r\nvi.mock('../PermissionGuard', () => ({\r\n  PermissionGuard: ({ children }: any) => <>{children}</>\r\n}))\r\n\r\ndescribe('MainNavigation 组件', () => {\r\n  const renderWithRouter = (component: React.ReactElement) => {\r\n    return render(\r\n      <BrowserRouter>\r\n        {component}\r\n      </BrowserRouter>\r\n    )\r\n  }\r\n\r\n  it('应该能够渲染而不抛出图标导入错误', () => {\r\n    renderWithRouter(<MainNavigation />)\r\n    \r\n    // 验证组件成功挂载 - 检查菜单容器存在\r\n    const menuElement = document.querySelector('.arco-menu')\r\n    expect(menuElement).toBeTruthy()\r\n  })\r\n\r\n  it('应该在垂直模式下渲染', () => {\r\n    renderWithRouter(<MainNavigation mode=\"vertical\" />)\r\n    \r\n    const menuElement = document.querySelector('.arco-menu-vertical')\r\n    expect(menuElement).toBeTruthy()\r\n  })\r\n\r\n  it('应该在水平模式下渲染', () => {\r\n    renderWithRouter(<MainNavigation mode=\"horizontal\" />)\r\n    \r\n    const menuElement = document.querySelector('.arco-menu-horizontal')\r\n    expect(menuElement).toBeTruthy()\r\n  })\r\n\r\n  it('应该显示所有图标元素', () => {\r\n    renderWithRouter(<MainNavigation />)\r\n    \r\n    // 验证菜单项存在（图标会作为菜单项的一部分渲染）\r\n    const menuItems = document.querySelectorAll('.arco-menu-item')\r\n    expect(menuItems.length).toBeGreaterThan(0)\r\n  })\r\n})\r\n",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\analytics\\MobileDashboard.tsx",
        "messages": [
          {
            "ruleId": "react-hooks/exhaustive-deps",
            "severity": 1,
            "message": "The 'refresh' function makes the dependencies of useEffect Hook (at line 212) change on every render. To fix this, wrap the definition of 'refresh' in its own useCallback() Hook.",
            "line": 178,
            "column": 9,
            "nodeType": "VariableDeclarator",
            "endLine": 184,
            "endColumn": 4,
            "suggestions": [
              {
                "desc": "Wrap the definition of 'refresh' in its own useCallback() Hook.",
                "fix": {
                  "range": [
                    4426,
                    4561
                  ],
                  "text": "useCallback(async () => {\r\n    if (isOnline) {\r\n      return await fetchFromNetwork()\r\n    } else {\r\n      return await loadFromCache()\r\n    }\r\n  })"
                }
              }
            ]
          },
          {
            "ruleId": "react-hooks/exhaustive-deps",
            "severity": 1,
            "message": "React Hook useEffect has a missing dependency: 'fetchFromNetwork'. Either include it or remove the dependency array.",
            "line": 197,
            "column": 6,
            "nodeType": "ArrayExpression",
            "endLine": 197,
            "endColumn": 16,
            "suggestions": [
              {
                "desc": "Update the dependencies array to be: [fetchFromNetwork, isOnline]",
                "fix": {
                  "range": [
                    4807,
                    4817
                  ],
                  "text": "[fetchFromNetwork, isOnline]"
                }
              }
            ]
          }
        ],
        "suppressedMessages": [],
        "errorCount": 0,
        "fatalErrorCount": 0,
        "warningCount": 2,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 移动端经营大屏组件\r\n * 专为移动设备优化的数据可视化界面\r\n */\r\nimport React, { useState, useEffect, useRef } from 'react'\r\nimport {\r\n  Card,\r\n  Grid,\r\n  Statistic,\r\n  Button,\r\n  Space,\r\n  Typography,\r\n  Alert,\r\n  Spin,\r\n  Empty,\r\n  Tabs,\r\n  Badge,\r\n  Drawer,\r\n  Message\r\n} from '@arco-design/web-react'\r\nimport {\r\n  IconRefresh,\r\n  IconFullscreen,\r\n  IconFilter,\r\n  IconHome,\r\n  IconLocation\r\n} from '@arco-design/web-react/icon'\r\nimport { useNetworkStatus } from '../../hooks/useNetworkStatus'\r\nimport { useMobileNotification } from '../../hooks/useMobileNotification'\r\nimport { offlineCache, CACHE_STORES, CACHE_EXPIRY } from '../../utils/offlineCache'\r\nimport MobileStoreMap from './MobileStoreMap'\r\nimport MobileFunnelChart from './MobileFunnelChart'\r\nimport MobilePlanProgress from './MobilePlanProgress'\r\nimport './MobileDashboard.css'\r\n\r\nconst { Row, Col } = Grid\r\nconst { Title, Text } = Typography\r\nconst TabPane = Tabs.TabPane\r\n\r\n/**\r\n * 数据筛选条件接口\r\n */\r\ninterface DataFilters {\r\n  region?: number\r\n  timeRange?: [string, string]\r\n  storeType?: string\r\n}\r\n\r\n/**\r\n * 大屏数据接口\r\n */\r\ninterface DashboardData {\r\n  store_map: any\r\n  follow_up_funnel: any\r\n  plan_progress: any\r\n  key_metrics: {\r\n    total_stores: number\r\n    operating_stores: number\r\n    follow_up_count: number\r\n    construction_count: number\r\n    new_stores_this_month: number\r\n  }\r\n  last_updated: string\r\n}\r\n\r\n/**\r\n * 组件属性接口\r\n */\r\ninterface MobileDashboardProps {\r\n  refreshInterval?: number // 自动刷新间隔（毫秒）\r\n  enableNotifications?: boolean // 是否启用通知\r\n}\r\n\r\n/**\r\n * 移动端经营大屏组件\r\n */\r\nconst MobileDashboard: React.FC<MobileDashboardProps> = ({\r\n  refreshInterval = 300000, // 默认5分钟\r\n  enableNotifications = true\r\n}) => {\r\n  const [activeTab, setActiveTab] = useState('overview')\r\n  const [filters] = useState<DataFilters>({})\r\n  const [showFilters, setShowFilters] = useState(false)\r\n  const [dashboardData, setDashboardData] = useState<DashboardData | null>(null)\r\n  const [loading, setLoading] = useState(false)\r\n  const [fromCache, setFromCache] = useState(false)\r\n  const [lastUpdated, setLastUpdated] = useState<string>('')\r\n  const refreshTimerRef = useRef<ReturnType<typeof setInterval>>()\r\n  \r\n  // 网络状态\r\n  const { isOnline } = useNetworkStatus()\r\n  \r\n  // 通知服务\r\n  const { notifyDataUpdate, notifyWarning } = useMobileNotification({\r\n    autoRequestPermission: enableNotifications,\r\n    enableDataUpdateNotification: enableNotifications\r\n  })\r\n  \r\n  // 从缓存加载数据\r\n  const loadFromCache = async () => {\r\n    try {\r\n      const cachedData = await offlineCache.get<DashboardData>(\r\n        CACHE_STORES.STATISTICS,\r\n        'mobile_dashboard_data'\r\n      )\r\n      if (cachedData) {\r\n        setDashboardData(cachedData)\r\n        setFromCache(true)\r\n        setLastUpdated(new Date().toISOString())\r\n        return true\r\n      }\r\n      return false\r\n    } catch (error) {\r\n      console.error('从缓存加载数据失败:', error)\r\n      return false\r\n    }\r\n  }\r\n  \r\n  // 从网络获取数据\r\n  const fetchFromNetwork = async () => {\r\n    if (!isOnline) {\r\n      Message.warning('网络未连接，使用缓存数据')\r\n      return false\r\n    }\r\n    \r\n    setLoading(true)\r\n    try {\r\n      const response = await fetch('/api/analytics/dashboard/', {\r\n        headers: {\r\n          'Authorization': `Bearer ${localStorage.getItem('access_token')}`\r\n        }\r\n      })\r\n      if (!response.ok) throw new Error('获取数据失败')\r\n      const result = await response.json()\r\n      \r\n      setDashboardData(result.data)\r\n      setFromCache(false)\r\n      setLastUpdated(new Date().toISOString())\r\n      \r\n      // 保存到缓存\r\n      await offlineCache.set(\r\n        CACHE_STORES.STATISTICS,\r\n        'mobile_dashboard_data',\r\n        result.data,\r\n        CACHE_EXPIRY.MEDIUM\r\n      )\r\n      \r\n      // 发送数据更新通知\r\n      if (enableNotifications) {\r\n        await notifyDataUpdate('经营大屏', '数据已更新')\r\n      }\r\n      \r\n      // 检查预警\r\n      if (result.data.follow_up_funnel?.warning_stages?.length > 0) {\r\n        await notifyWarning(\r\n          '转化率预警',\r\n          `${result.data.follow_up_funnel.warning_stages.length}个阶段转化率异常`\r\n        )\r\n      }\r\n      \r\n      return true\r\n    } catch (error) {\r\n      console.error('从网络获取数据失败:', error)\r\n      // 网络请求失败，尝试使用缓存\r\n      const hasCachedData = await loadFromCache()\r\n      if (hasCachedData) {\r\n        Message.info('网络请求失败，已加载缓存数据')\r\n      } else {\r\n        Message.error('加载数据失败')\r\n      }\r\n      return false\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n  \r\n  // 刷新数据\r\n  const refresh = async () => {\r\n    if (isOnline) {\r\n      return await fetchFromNetwork()\r\n    } else {\r\n      return await loadFromCache()\r\n    }\r\n  }\r\n  \r\n  // 初始化数据加载\r\n  useEffect(() => {\r\n    const initData = async () => {\r\n      // 先尝试从缓存加载\r\n      await loadFromCache()\r\n      // 如果在线，尝试从网络获取最新数据\r\n      if (isOnline) {\r\n        await fetchFromNetwork()\r\n      }\r\n    }\r\n    initData()\r\n  }, [isOnline])\r\n  \r\n  // 自动刷新\r\n  useEffect(() => {\r\n    if (refreshInterval > 0 && isOnline) {\r\n      refreshTimerRef.current = setInterval(() => {\r\n        refresh()\r\n      }, refreshInterval)\r\n      \r\n      return () => {\r\n        if (refreshTimerRef.current) {\r\n          clearInterval(refreshTimerRef.current)\r\n        }\r\n      }\r\n    }\r\n  }, [refreshInterval, isOnline, refresh])\r\n  \r\n  // 手动刷新\r\n  const handleRefresh = async () => {\r\n    try {\r\n      await refresh()\r\n      Message.success('数据已更新')\r\n    } catch (error) {\r\n      Message.error('刷新失败，请稍后重试')\r\n    }\r\n  }\r\n  \r\n  // 切换全屏\r\n  const toggleFullscreen = () => {\r\n    if (!document.fullscreenElement) {\r\n      document.documentElement.requestFullscreen()\r\n    } else {\r\n      document.exitFullscreen()\r\n    }\r\n  }\r\n  \r\n  // 渲染关键指标卡片\r\n  const renderKeyMetrics = () => {\r\n    if (!dashboardData?.key_metrics) return null\r\n    \r\n    const { key_metrics } = dashboardData\r\n    \r\n    return (\r\n      <div className=\"mobile-dashboard-metrics\">\r\n        <Row gutter={[8, 8]}>\r\n          <Col span={12}>\r\n            <Card className=\"metric-card\" bordered={false}>\r\n              <Statistic\r\n                title=\"门店总数\"\r\n                value={key_metrics.total_stores}\r\n                suffix=\"家\"\r\n                style={{ color: '#165DFF' }}\r\n              />\r\n            </Card>\r\n          </Col>\r\n          <Col span={12}>\r\n            <Card className=\"metric-card\" bordered={false}>\r\n              <Statistic\r\n                title=\"运营中\"\r\n                value={key_metrics.operating_stores}\r\n                suffix=\"家\"\r\n                style={{ color: '#00B42A' }}\r\n              />\r\n            </Card>\r\n          </Col>\r\n          <Col span={12}>\r\n            <Card className=\"metric-card\" bordered={false}>\r\n              <Statistic\r\n                title=\"跟进中\"\r\n                value={key_metrics.follow_up_count}\r\n                suffix=\"个\"\r\n                style={{ color: '#FF7D00' }}\r\n              />\r\n            </Card>\r\n          </Col>\r\n          <Col span={12}>\r\n            <Card className=\"metric-card\" bordered={false}>\r\n              <Statistic\r\n                title=\"筹备中\"\r\n                value={key_metrics.construction_count}\r\n                suffix=\"个\"\r\n                style={{ color: '#722ED1' }}\r\n              />\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n        \r\n        <Card className=\"highlight-card\" bordered={false} style={{ marginTop: 8 }}>\r\n          <Space>\r\n            <Badge status=\"success\" />\r\n            <Text>本月新增门店：</Text>\r\n            <Text style={{ fontSize: 18, color: '#00B42A', fontWeight: 'bold' }}>\r\n              {key_metrics.new_stores_this_month}\r\n            </Text>\r\n            <Text>家</Text>\r\n          </Space>\r\n        </Card>\r\n      </div>\r\n    )\r\n  }\r\n  \r\n  // 渲染概览标签页\r\n  const renderOverviewTab = () => {\r\n    return (\r\n      <div className=\"mobile-dashboard-overview\">\r\n        {renderKeyMetrics()}\r\n        \r\n        {dashboardData?.plan_progress && (\r\n          <Card \r\n            title=\"计划完成进度\" \r\n            bordered={false}\r\n            style={{ marginTop: 12 }}\r\n          >\r\n            <MobilePlanProgress data={dashboardData.plan_progress} />\r\n          </Card>\r\n        )}\r\n        \r\n        {dashboardData?.follow_up_funnel && (\r\n          <Card \r\n            title=\"跟进漏斗\" \r\n            bordered={false}\r\n            style={{ marginTop: 12 }}\r\n          >\r\n            <MobileFunnelChart data={dashboardData.follow_up_funnel} />\r\n          </Card>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n  \r\n  // 渲染地图标签页\r\n  const renderMapTab = () => {\r\n    if (!dashboardData?.store_map) return <Empty description=\"暂无地图数据\" />\r\n    \r\n    return (\r\n      <div className=\"mobile-dashboard-map\">\r\n        <MobileStoreMap \r\n          data={dashboardData.store_map}\r\n          filters={filters}\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n  \r\n  // 渲染筛选抽屉\r\n  const renderFilterDrawer = () => {\r\n    return (\r\n      <Drawer\r\n        width=\"80%\"\r\n        title=\"数据筛选\"\r\n        visible={showFilters}\r\n        onCancel={() => setShowFilters(false)}\r\n        footer={\r\n          <Space>\r\n            <Button onClick={() => setShowFilters(false)}>取消</Button>\r\n            <Button \r\n              type=\"primary\" \r\n              onClick={() => {\r\n                setShowFilters(false)\r\n                refresh()\r\n              }}\r\n            >\r\n              应用筛选\r\n            </Button>\r\n          </Space>\r\n        }\r\n      >\r\n        {/* 筛选表单内容 */}\r\n        <div>筛选功能待实现</div>\r\n      </Drawer>\r\n    )\r\n  }\r\n  \r\n  // 加载状态\r\n  if (loading && !dashboardData) {\r\n    return (\r\n      <div className=\"mobile-dashboard-loading\">\r\n        <Spin size={40} />\r\n        <Text style={{ marginTop: 16 }}>加载中...</Text>\r\n      </div>\r\n    )\r\n  }\r\n  \r\n  // 无数据状态\r\n  if (!dashboardData) {\r\n    return (\r\n      <div className=\"mobile-dashboard-empty\">\r\n        <Empty description=\"暂无数据\" />\r\n        <Button \r\n          type=\"primary\" \r\n          onClick={handleRefresh}\r\n          style={{ marginTop: 16 }}\r\n        >\r\n          重新加载\r\n        </Button>\r\n      </div>\r\n    )\r\n  }\r\n  \r\n  return (\r\n    <div className=\"mobile-dashboard\">\r\n      {/* 顶部工具栏 */}\r\n      <div className=\"mobile-dashboard-header\">\r\n        <Space>\r\n          <Title heading={5} style={{ margin: 0 }}>经营大屏</Title>\r\n          {fromCache && (\r\n            <Badge status=\"warning\" text=\"离线数据\" />\r\n          )}\r\n          {!isOnline && (\r\n            <Badge status=\"error\" text=\"离线模式\" />\r\n          )}\r\n        </Space>\r\n        \r\n        <Space>\r\n          <Button \r\n            icon={<IconRefresh />} \r\n            onClick={handleRefresh}\r\n            loading={loading}\r\n            size=\"small\"\r\n          />\r\n          <Button \r\n            icon={<IconFilter />} \r\n            onClick={() => setShowFilters(true)}\r\n            size=\"small\"\r\n          />\r\n          <Button \r\n            icon={<IconFullscreen />} \r\n            onClick={toggleFullscreen}\r\n            size=\"small\"\r\n          />\r\n        </Space>\r\n      </div>\r\n      \r\n      {/* 更新时间提示 */}\r\n      {lastUpdated && (\r\n        <Alert\r\n          type=\"info\"\r\n          content={`最后更新：${new Date(lastUpdated).toLocaleString('zh-CN')}`}\r\n          closable\r\n          style={{ margin: '8px 0' }}\r\n        />\r\n      )}\r\n      \r\n      {/* 标签页内容 */}\r\n      <Tabs \r\n        activeTab={activeTab} \r\n        onChange={setActiveTab}\r\n        type=\"rounded\"\r\n      >\r\n        <TabPane key=\"overview\" title={\r\n          <span>\r\n            <IconHome style={{ marginRight: 4 }} />\r\n            概览\r\n          </span>\r\n        }>\r\n          {renderOverviewTab()}\r\n        </TabPane>\r\n        \r\n        <TabPane key=\"map\" title={\r\n          <span>\r\n            <IconLocation style={{ marginRight: 4 }} />\r\n            地图\r\n          </span>\r\n        }>\r\n          {renderMapTab()}\r\n        </TabPane>\r\n      </Tabs>\r\n      \r\n      {/* 筛选抽屉 */}\r\n      {renderFilterDrawer()}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MobileDashboard\r\n",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\analytics\\MobileFunnelChart.tsx",
        "messages": [
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'total' is defined but never used.",
            "line": 66,
            "column": 41,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 66,
            "endColumn": 54
          }
        ],
        "suppressedMessages": [],
        "errorCount": 1,
        "fatalErrorCount": 0,
        "warningCount": 0,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 移动端漏斗图组件\r\n * 优化的漏斗可视化，支持触摸交互\r\n */\r\nimport React, { useState } from 'react'\r\nimport { Space, Typography, Progress, Tag, Alert, Drawer, List } from '@arco-design/web-react'\r\nimport { IconDown, IconInfoCircle } from '@arco-design/web-react/icon'\r\nimport './MobileFunnelChart.css'\r\n\r\nconst { Text, Title } = Typography\r\n\r\n/**\r\n * 漏斗阶段数据接口\r\n */\r\ninterface FunnelStage {\r\n  name: string\r\n  count: number\r\n  percentage: number\r\n}\r\n\r\n/**\r\n * 转化率数据接口\r\n */\r\ninterface ConversionRate {\r\n  from_stage: string\r\n  to_stage: string\r\n  rate: number\r\n  from_count: number\r\n  to_count: number\r\n}\r\n\r\n/**\r\n * 漏斗数据接口\r\n */\r\ninterface FunnelData {\r\n  stages: Record<string, FunnelStage>\r\n  conversion_rates: ConversionRate[]\r\n  total_count: number\r\n  warning_stages: string[]\r\n  last_updated: string\r\n}\r\n\r\n/**\r\n * 组件属性接口\r\n */\r\ninterface MobileFunnelChartProps {\r\n  data: FunnelData\r\n}\r\n\r\n/**\r\n * 移动端漏斗图组件\r\n */\r\nconst MobileFunnelChart: React.FC<MobileFunnelChartProps> = ({ data }) => {\r\n  const [selectedStage, setSelectedStage] = useState<string | null>(null)\r\n  const [showDetail, setShowDetail] = useState(false)\r\n  \r\n  // 获取阶段列表（按顺序）\r\n  const getStageList = (): [string, FunnelStage][] => {\r\n    const stageOrder = ['investigating', 'calculating', 'approving', 'signing', 'signed']\r\n    return stageOrder\r\n      .filter(key => data.stages[key])\r\n      .map(key => [key, data.stages[key]])\r\n  }\r\n  \r\n  // 获取阶段颜色\r\n  const getStageColor = (index: number, total: number): string => {\r\n    const colors = ['#165DFF', '#14C9C9', '#F7BA1E', '#F77234', '#00B42A']\r\n    return colors[index % colors.length]\r\n  }\r\n  \r\n  // 获取转化率颜色\r\n  const getConversionColor = (rate: number): string => {\r\n    if (rate >= 70) return '#00B42A'\r\n    if (rate >= 50) return '#F7BA1E'\r\n    if (rate >= 30) return '#FF7D00'\r\n    return '#F53F3F'\r\n  }\r\n  \r\n  // 处理阶段点击\r\n  const handleStageClick = (stageKey: string) => {\r\n    setSelectedStage(stageKey)\r\n    setShowDetail(true)\r\n  }\r\n  \r\n  // 渲染预警信息\r\n  const renderWarnings = () => {\r\n    if (!data.warning_stages || data.warning_stages.length === 0) return null\r\n    \r\n    return (\r\n      <Alert\r\n        type=\"warning\"\r\n        content={\r\n          <Space direction=\"vertical\" size=\"small\">\r\n            <Text strong>转化预警</Text>\r\n            {data.warning_stages.map((warning, index) => (\r\n              <Text key={index} style={{ fontSize: 12 }}>• {warning}</Text>\r\n            ))}\r\n          </Space>\r\n        }\r\n        closable\r\n        style={{ marginBottom: 12 }}\r\n      />\r\n    )\r\n  }\r\n  \r\n  // 渲染漏斗阶段\r\n  const renderFunnelStages = () => {\r\n    const stages = getStageList()\r\n    \r\n    return (\r\n      <div className=\"mobile-funnel-stages\">\r\n        {stages.map(([key, stage], index) => {\r\n          const color = getStageColor(index, stages.length)\r\n          const widthPercent = (stage.count / data.total_count) * 100\r\n          \r\n          return (\r\n            <div key={key} className=\"funnel-stage-wrapper\">\r\n              {/* 阶段块 */}\r\n              <div\r\n                className=\"funnel-stage\"\r\n                style={{\r\n                  background: color,\r\n                  width: `${Math.max(widthPercent, 20)}%`,\r\n                }}\r\n                onClick={() => handleStageClick(key)}\r\n              >\r\n                <Space direction=\"vertical\" size={0} style={{ width: '100%' }}>\r\n                  <Text style={{ color: '#fff', fontWeight: 500 }}>\r\n                    {stage.name}\r\n                  </Text>\r\n                  <Text style={{ color: '#fff', fontSize: 20, fontWeight: 'bold' }}>\r\n                    {stage.count}\r\n                  </Text>\r\n                  <Text style={{ color: '#fff', fontSize: 12 }}>\r\n                    {stage.percentage.toFixed(1)}%\r\n                  </Text>\r\n                </Space>\r\n              </div>\r\n              \r\n              {/* 转化率箭头 */}\r\n              {index < stages.length - 1 && (\r\n                <div className=\"funnel-conversion\">\r\n                  {data.conversion_rates[index] && (\r\n                    <Space size={4}>\r\n                      <IconDown style={{ fontSize: 12 }} />\r\n                      <Tag\r\n                        color={getConversionColor(data.conversion_rates[index].rate)}\r\n                        size=\"small\"\r\n                      >\r\n                        {data.conversion_rates[index].rate.toFixed(1)}%\r\n                      </Tag>\r\n                    </Space>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )\r\n        })}\r\n      </div>\r\n    )\r\n  }\r\n  \r\n  // 渲染转化率详情\r\n  const renderConversionDetails = () => {\r\n    return (\r\n      <div className=\"conversion-details\">\r\n        <Title heading={6} style={{ marginBottom: 12 }}>转化率详情</Title>\r\n        <List\r\n          dataSource={data.conversion_rates}\r\n          render={(item) => (\r\n            <List.Item key={`${item.from_stage}-${item.to_stage}`}>\r\n              <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n                <Space style={{ width: '100%', justifyContent: 'space-between' }}>\r\n                  <Text>{item.from_stage} → {item.to_stage}</Text>\r\n                  <Tag color={getConversionColor(item.rate)}>\r\n                    {item.rate.toFixed(1)}%\r\n                  </Tag>\r\n                </Space>\r\n                <Progress\r\n                  percent={item.rate}\r\n                  color={getConversionColor(item.rate)}\r\n                  showText={false}\r\n                  size=\"small\"\r\n                />\r\n                <Text type=\"secondary\" style={{ fontSize: 12 }}>\r\n                  {item.from_count} → {item.to_count}\r\n                </Text>\r\n              </Space>\r\n            </List.Item>\r\n          )}\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n  \r\n  // 渲染阶段详情抽屉\r\n  const renderStageDetail = () => {\r\n    if (!selectedStage || !data.stages[selectedStage]) return null\r\n    \r\n    const stage = data.stages[selectedStage]\r\n    \r\n    return (\r\n      <Drawer\r\n        width=\"90%\"\r\n        title=\"阶段详情\"\r\n        visible={showDetail}\r\n        onCancel={() => setShowDetail(false)}\r\n      >\r\n        <Space direction=\"vertical\" size=\"large\" style={{ width: '100%' }}>\r\n          <div>\r\n            <Text type=\"secondary\">阶段名称</Text>\r\n            <Title heading={6} style={{ margin: '4px 0' }}>{stage.name}</Title>\r\n          </div>\r\n          \r\n          <div>\r\n            <Text type=\"secondary\">数量</Text>\r\n            <Title heading={5} style={{ margin: '4px 0', color: '#165DFF' }}>\r\n              {stage.count}\r\n            </Title>\r\n          </div>\r\n          \r\n          <div>\r\n            <Text type=\"secondary\">占比</Text>\r\n            <div style={{ marginTop: 8 }}>\r\n              <Progress\r\n                percent={stage.percentage}\r\n                color=\"#165DFF\"\r\n              />\r\n            </div>\r\n          </div>\r\n          \r\n          <div>\r\n            <Alert\r\n              type=\"info\"\r\n              icon={<IconInfoCircle />}\r\n              content={`该阶段共有 ${stage.count} 个跟进单，占总数的 ${stage.percentage.toFixed(1)}%`}\r\n            />\r\n          </div>\r\n        </Space>\r\n      </Drawer>\r\n    )\r\n  }\r\n  \r\n  return (\r\n    <div className=\"mobile-funnel-chart\">\r\n      {/* 预警信息 */}\r\n      {renderWarnings()}\r\n      \r\n      {/* 总数统计 */}\r\n      <div className=\"funnel-summary\">\r\n        <Space>\r\n          <Text type=\"secondary\">总跟进数：</Text>\r\n          <Text strong style={{ fontSize: 18, color: '#165DFF' }}>\r\n            {data.total_count}\r\n          </Text>\r\n        </Space>\r\n      </div>\r\n      \r\n      {/* 漏斗阶段 */}\r\n      {renderFunnelStages()}\r\n      \r\n      {/* 转化率详情 */}\r\n      {renderConversionDetails()}\r\n      \r\n      {/* 阶段详情抽屉 */}\r\n      {renderStageDetail()}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MobileFunnelChart\r\n",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\analytics\\MobilePlanProgress.tsx",
        "messages": [
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'IconClockCircle' is defined but never used.",
            "line": 7,
            "column": 27,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 7,
            "endColumn": 42
          }
        ],
        "suppressedMessages": [],
        "errorCount": 1,
        "fatalErrorCount": 0,
        "warningCount": 0,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 移动端计划进度组件\r\n * 优化的进度可视化，支持触摸交互\r\n */\r\nimport React, { useState } from 'react'\r\nimport { Card, Space, Typography, Progress, Tag, Drawer, List } from '@arco-design/web-react'\r\nimport { IconCheckCircle, IconClockCircle } from '@arco-design/web-react/icon'\r\nimport './MobilePlanProgress.css'\r\n\r\nconst { Text, Title } = Typography\r\n\r\n/**\r\n * 分组进度数据接口\r\n */\r\ninterface GroupProgress {\r\n  name: string\r\n  target_count: number\r\n  completed_count: number\r\n  completion_rate: number\r\n}\r\n\r\n/**\r\n * 计划数据接口\r\n */\r\ninterface PlanData {\r\n  plan_id: number\r\n  plan_name: string\r\n  plan_type: string\r\n  status: string\r\n  start_date: string\r\n  end_date: string\r\n  total_target_count: number\r\n  total_completed_count: number\r\n  completion_rate: number\r\n  grouped_progress: Record<string, GroupProgress>\r\n}\r\n\r\n/**\r\n * 进度数据接口\r\n */\r\ninterface PlanProgressData {\r\n  plans: PlanData[]\r\n  overall_statistics: {\r\n    total_plans: number\r\n    total_target_count: number\r\n    total_completed_count: number\r\n    overall_completion_rate: number\r\n  }\r\n  last_updated: string\r\n}\r\n\r\n/**\r\n * 组件属性接口\r\n */\r\ninterface MobilePlanProgressProps {\r\n  data: PlanProgressData\r\n}\r\n\r\n/**\r\n * 移动端计划进度组件\r\n */\r\nconst MobilePlanProgress: React.FC<MobilePlanProgressProps> = ({ data }) => {\r\n  const [selectedPlan, setSelectedPlan] = useState<PlanData | null>(null)\r\n  const [showDetail, setShowDetail] = useState(false)\r\n  \r\n  // 获取进度颜色\r\n  const getProgressColor = (rate: number): string => {\r\n    if (rate >= 80) return '#00B42A'\r\n    if (rate >= 60) return '#14C9C9'\r\n    if (rate >= 40) return '#F7BA1E'\r\n    if (rate >= 20) return '#FF7D00'\r\n    return '#F53F3F'\r\n  }\r\n  \r\n  // 获取状态标签\r\n  const getStatusTag = (status: string) => {\r\n    const statusMap: Record<string, { text: string; color: string }> = {\r\n      published: { text: '已发布', color: 'blue' },\r\n      executing: { text: '执行中', color: 'green' },\r\n      completed: { text: '已完成', color: 'gray' },\r\n      draft: { text: '草稿', color: 'default' },\r\n    }\r\n    const config = statusMap[status] || { text: status, color: 'default' }\r\n    return <Tag color={config.color}>{config.text}</Tag>\r\n  }\r\n  \r\n  // 处理计划点击\r\n  const handlePlanClick = (plan: PlanData) => {\r\n    setSelectedPlan(plan)\r\n    setShowDetail(true)\r\n  }\r\n  \r\n  // 渲染总体统计\r\n  const renderOverallStats = () => {\r\n    const { overall_statistics } = data\r\n    \r\n    return (\r\n      <Card className=\"overall-stats-card\" bordered={false}>\r\n        <Space direction=\"vertical\" size=\"large\" style={{ width: '100%' }}>\r\n          <Space style={{ width: '100%', justifyContent: 'space-between' }}>\r\n            <div>\r\n              <Text type=\"secondary\" style={{ fontSize: 12 }}>总目标</Text>\r\n              <Title heading={5} style={{ margin: '4px 0', color: '#165DFF' }}>\r\n                {overall_statistics.total_target_count}\r\n              </Title>\r\n            </div>\r\n            <div>\r\n              <Text type=\"secondary\" style={{ fontSize: 12 }}>已完成</Text>\r\n              <Title heading={5} style={{ margin: '4px 0', color: '#00B42A' }}>\r\n                {overall_statistics.total_completed_count}\r\n              </Title>\r\n            </div>\r\n            <div>\r\n              <Text type=\"secondary\" style={{ fontSize: 12 }}>完成率</Text>\r\n              <Title heading={5} style={{ margin: '4px 0', color: getProgressColor(overall_statistics.overall_completion_rate) }}>\r\n                {overall_statistics.overall_completion_rate.toFixed(1)}%\r\n              </Title>\r\n            </div>\r\n          </Space>\r\n          \r\n          <Progress\r\n            percent={overall_statistics.overall_completion_rate}\r\n            color={getProgressColor(overall_statistics.overall_completion_rate)}\r\n            size=\"large\"\r\n          />\r\n        </Space>\r\n      </Card>\r\n    )\r\n  }\r\n  \r\n  // 渲染计划列表\r\n  const renderPlanList = () => {\r\n    return (\r\n      <div className=\"mobile-plan-list\">\r\n        {data.plans.map(plan => (\r\n          <Card\r\n            key={plan.plan_id}\r\n            className=\"plan-card\"\r\n            bordered={false}\r\n            onClick={() => handlePlanClick(plan)}\r\n          >\r\n            <Space direction=\"vertical\" size=\"medium\" style={{ width: '100%' }}>\r\n              {/* 计划标题 */}\r\n              <Space style={{ width: '100%', justifyContent: 'space-between' }}>\r\n                <Space>\r\n                  <Text strong>{plan.plan_name}</Text>\r\n                  {getStatusTag(plan.status)}\r\n                </Space>\r\n                <Text type=\"secondary\" style={{ fontSize: 12 }}>\r\n                  {new Date(plan.start_date).toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' })}\r\n                  {' - '}\r\n                  {new Date(plan.end_date).toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' })}\r\n                </Text>\r\n              </Space>\r\n              \r\n              {/* 进度条 */}\r\n              <div>\r\n                <Space style={{ width: '100%', justifyContent: 'space-between', marginBottom: 8 }}>\r\n                  <Space size={4}>\r\n                    <IconCheckCircle style={{ color: '#00B42A', fontSize: 14 }} />\r\n                    <Text style={{ fontSize: 12 }}>\r\n                      {plan.total_completed_count} / {plan.total_target_count}\r\n                    </Text>\r\n                  </Space>\r\n                  <Text strong style={{ color: getProgressColor(plan.completion_rate) }}>\r\n                    {plan.completion_rate.toFixed(1)}%\r\n                  </Text>\r\n                </Space>\r\n                <Progress\r\n                  percent={plan.completion_rate}\r\n                  color={getProgressColor(plan.completion_rate)}\r\n                  showText={false}\r\n                />\r\n              </div>\r\n              \r\n              {/* 分组进度预览 */}\r\n              <Space wrap size=\"small\">\r\n                {Object.entries(plan.grouped_progress).map(([key, group]) => (\r\n                  <Tag key={key} size=\"small\">\r\n                    {group.name}: {group.completion_rate.toFixed(0)}%\r\n                  </Tag>\r\n                ))}\r\n              </Space>\r\n            </Space>\r\n          </Card>\r\n        ))}\r\n      </div>\r\n    )\r\n  }\r\n  \r\n  // 渲染计划详情抽屉\r\n  const renderPlanDetail = () => {\r\n    if (!selectedPlan) return null\r\n    \r\n    return (\r\n      <Drawer\r\n        width=\"90%\"\r\n        title=\"计划详情\"\r\n        visible={showDetail}\r\n        onCancel={() => setShowDetail(false)}\r\n      >\r\n        <Space direction=\"vertical\" size=\"large\" style={{ width: '100%' }}>\r\n          {/* 基本信息 */}\r\n          <div>\r\n            <Text type=\"secondary\">计划名称</Text>\r\n            <Title heading={6} style={{ margin: '4px 0' }}>{selectedPlan.plan_name}</Title>\r\n          </div>\r\n          \r\n          <div>\r\n            <Text type=\"secondary\">计划状态</Text>\r\n            <div style={{ marginTop: 4 }}>\r\n              {getStatusTag(selectedPlan.status)}\r\n            </div>\r\n          </div>\r\n          \r\n          <div>\r\n            <Text type=\"secondary\">计划周期</Text>\r\n            <Text style={{ display: 'block', marginTop: 4 }}>\r\n              {new Date(selectedPlan.start_date).toLocaleDateString('zh-CN')}\r\n              {' 至 '}\r\n              {new Date(selectedPlan.end_date).toLocaleDateString('zh-CN')}\r\n            </Text>\r\n          </div>\r\n          \r\n          {/* 总体进度 */}\r\n          <div>\r\n            <Text type=\"secondary\">总体进度</Text>\r\n            <div style={{ marginTop: 8 }}>\r\n              <Space style={{ width: '100%', justifyContent: 'space-between', marginBottom: 8 }}>\r\n                <Text>\r\n                  已完成 {selectedPlan.total_completed_count} / {selectedPlan.total_target_count}\r\n                </Text>\r\n                <Text strong style={{ color: getProgressColor(selectedPlan.completion_rate) }}>\r\n                  {selectedPlan.completion_rate.toFixed(1)}%\r\n                </Text>\r\n              </Space>\r\n              <Progress\r\n                percent={selectedPlan.completion_rate}\r\n                color={getProgressColor(selectedPlan.completion_rate)}\r\n              />\r\n            </div>\r\n          </div>\r\n          \r\n          {/* 分组进度详情 */}\r\n          <div>\r\n            <Text type=\"secondary\">分组进度</Text>\r\n            <List\r\n              style={{ marginTop: 8 }}\r\n              dataSource={Object.entries(selectedPlan.grouped_progress)}\r\n              render={([key, group]) => (\r\n                <List.Item key={key}>\r\n                  <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n                    <Space style={{ width: '100%', justifyContent: 'space-between' }}>\r\n                      <Text strong>{group.name}</Text>\r\n                      <Text style={{ color: getProgressColor(group.completion_rate) }}>\r\n                        {group.completion_rate.toFixed(1)}%\r\n                      </Text>\r\n                    </Space>\r\n                    <Progress\r\n                      percent={group.completion_rate}\r\n                      color={getProgressColor(group.completion_rate)}\r\n                      showText={false}\r\n                      size=\"small\"\r\n                    />\r\n                    <Text type=\"secondary\" style={{ fontSize: 12 }}>\r\n                      目标: {group.target_count} | 完成: {group.completed_count}\r\n                    </Text>\r\n                  </Space>\r\n                </List.Item>\r\n              )}\r\n            />\r\n          </div>\r\n        </Space>\r\n      </Drawer>\r\n    )\r\n  }\r\n  \r\n  return (\r\n    <div className=\"mobile-plan-progress\">\r\n      {/* 总体统计 */}\r\n      {renderOverallStats()}\r\n      \r\n      {/* 计划列表 */}\r\n      {renderPlanList()}\r\n      \r\n      {/* 计划详情抽屉 */}\r\n      {renderPlanDetail()}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MobilePlanProgress\r\n",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\analytics\\MobileReportViewer.tsx",
        "messages": [
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'useEffect' is defined but never used.",
            "line": 4,
            "column": 27,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 4,
            "endColumn": 36
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'onDownload' is defined but never used.",
            "line": 64,
            "column": 3,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 64,
            "endColumn": 13
          }
        ],
        "suppressedMessages": [],
        "errorCount": 2,
        "fatalErrorCount": 0,
        "warningCount": 0,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 移动端报表查看器组件\r\n */\r\nimport React, { useState, useEffect } from 'react'\r\nimport {\r\n  Card,\r\n  Grid,\r\n  Typography,\r\n  Button, \r\n  Space,\r\n  Tabs,\r\n  List,\r\n  Tag,\r\n  Statistic,\r\n  Empty,\r\n  Spin,\r\n  Alert,\r\n  Drawer,\r\n  Modal,\r\n  Message\r\n} from '@arco-design/web-react'\r\nimport {\r\n  IconDownload,\r\n  IconExport,\r\n  IconRefresh,\r\n  IconEye,\r\n  IconDashboard,\r\n  IconFile,\r\n  IconMore,\r\n  IconFilter\r\n} from '@arco-design/web-react/icon'\r\nimport { useReportService } from '../../api/reportService'\r\nimport type { \r\n  ReportTask, \r\n  ReportPreviewData, \r\n  ReportConfig,\r\n  ReportFilters as ReportFiltersType,\r\n  FilterOptions \r\n} from '../../api/reportService'\r\nimport ReportFilters from './ReportFilters'\r\nimport styles from './MobileReportViewer.module.css'\r\n\r\nconst { Row, Col } = Grid\r\nconst { Title, Text } = Typography\r\nconst { TabPane } = Tabs\r\n\r\n// 组件属性\r\nexport interface MobileReportViewerProps {\r\n  tasks: ReportTask[]\r\n  filterOptions: FilterOptions\r\n  onTaskSelect?: (task: ReportTask) => void\r\n  onDownload?: (taskId: string) => void\r\n  onShare?: (task: ReportTask) => void\r\n  onRefresh?: () => void\r\n}\r\n\r\n/**\r\n * 移动端报表查看器组件\r\n */\r\nconst MobileReportViewer: React.FC<MobileReportViewerProps> = ({\r\n  tasks,\r\n  filterOptions,\r\n  onTaskSelect,\r\n  onDownload,\r\n  onShare,\r\n  onRefresh\r\n}) => {\r\n  const [selectedTask, setSelectedTask] = useState<ReportTask | null>(null)\r\n  const [previewData, setPreviewData] = useState<ReportPreviewData | null>(null)\r\n  const [filtersVisible, setFiltersVisible] = useState(false)\r\n  const [filters, setFilters] = useState<ReportFiltersType>({})\r\n  const [actionSheetVisible, setActionSheetVisible] = useState(false)\r\n  const [activeTab, setActiveTab] = useState('tasks')\r\n\r\n  const { loading, error, getReportPreview, downloadReport } = useReportService()\r\n\r\n  /**\r\n   * 选择报表任务\r\n   */\r\n  const handleTaskSelect = async (task: ReportTask) => {\r\n    setSelectedTask(task)\r\n    onTaskSelect?.(task)\r\n    \r\n    if (task.status === 'completed') {\r\n      // 加载预览数据\r\n      const config: ReportConfig = {\r\n        reportType: task.reportType,\r\n        filters: {},\r\n        format: 'excel',\r\n        includeCharts: true,\r\n        includeSummary: true\r\n      }\r\n      \r\n      const preview = await getReportPreview(config)\r\n      if (preview) {\r\n        setPreviewData(preview)\r\n      }\r\n    }\r\n    \r\n    setActiveTab('preview')\r\n  }\r\n\r\n  /**\r\n   * 下载报表\r\n   */\r\n  const handleDownload = async (taskId: string) => {\r\n    try {\r\n      await downloadReport(taskId)\r\n      Message.success('下载开始')\r\n    } catch (error) {\r\n      Message.error('下载失败')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 分享报表\r\n   */\r\n  const handleShare = (task: ReportTask) => {\r\n    onShare?.(task)\r\n    setActionSheetVisible(false)\r\n  }\r\n\r\n  /**\r\n   * 显示操作菜单\r\n   */\r\n  const showActionSheet = (task: ReportTask) => {\r\n    setSelectedTask(task)\r\n    setActionSheetVisible(true)\r\n  }\r\n\r\n  /**\r\n   * 获取任务状态颜色\r\n   */\r\n  const getTaskStatusColor = (status: ReportTask['status']) => {\r\n    const colorMap = {\r\n      pending: 'orange',\r\n      processing: 'blue',\r\n      completed: 'green',\r\n      failed: 'red'\r\n    }\r\n    return colorMap[status] || 'default'\r\n  }\r\n\r\n  /**\r\n   * 获取任务状态文本\r\n   */\r\n  const getTaskStatusText = (status: ReportTask['status']) => {\r\n    const statusMap = {\r\n      pending: '等待中',\r\n      processing: '生成中',\r\n      completed: '已完成',\r\n      failed: '失败'\r\n    }\r\n    return statusMap[status] || '未知'\r\n  }\r\n\r\n  /**\r\n   * 格式化文件大小\r\n   */\r\n  const formatFileSize = (bytes?: number) => {\r\n    if (!bytes) return '-'\r\n    const sizes = ['B', 'KB', 'MB', 'GB']\r\n    const i = Math.floor(Math.log(bytes) / Math.log(1024))\r\n    return `${(bytes / Math.pow(1024, i)).toFixed(1)} ${sizes[i]}`\r\n  }\r\n\r\n  /**\r\n   * 渲染任务列表\r\n   */\r\n  const renderTaskList = () => (\r\n    <div className={styles.taskList}>\r\n      {tasks.length === 0 ? (\r\n        <Empty\r\n          description=\"暂无报表任务\"\r\n          className={styles.emptyState}\r\n        />\r\n      ) : (\r\n        <List\r\n          dataSource={tasks}\r\n          renderItem={(task) => (\r\n            <List.Item\r\n              key={task.taskId}\r\n              className={styles.taskItem}\r\n              onClick={() => handleTaskSelect(task)}\r\n              actions={[\r\n                <Button\r\n                  type=\"text\"\r\n                  icon={<IconMore />}\r\n                  onClick={(e) => {\r\n                    e.stopPropagation()\r\n                    showActionSheet(task)\r\n                  }}\r\n                  className={styles.moreButton}\r\n                />\r\n              ]}\r\n            >\r\n              <List.Item.Meta\r\n                title={\r\n                  <div className={styles.taskTitle}>\r\n                    <Text className={styles.taskName}>\r\n                      {task.fileName || `${task.reportType}报表`}\r\n                    </Text>\r\n                    <Tag \r\n                      color={getTaskStatusColor(task.status)} \r\n                      size=\"small\"\r\n                      className={styles.statusTag}\r\n                    >\r\n                      {getTaskStatusText(task.status)}\r\n                    </Tag>\r\n                  </div>\r\n                }\r\n                description={\r\n                  <div className={styles.taskMeta}>\r\n                    <Text type=\"secondary\" className={styles.metaText}>\r\n                      {new Date(task.createdAt).toLocaleDateString('zh-CN')}\r\n                    </Text>\r\n                    {task.fileSize && (\r\n                      <Text type=\"secondary\" className={styles.metaText}>\r\n                        {formatFileSize(task.fileSize)}\r\n                      </Text>\r\n                    )}\r\n                    {task.status === 'processing' && (\r\n                      <div className={styles.progressBar}>\r\n                        <div \r\n                          className={styles.progressFill}\r\n                          style={{ width: `${task.progress}%` }}\r\n                        />\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                }\r\n              />\r\n            </List.Item>\r\n          )}\r\n        />\r\n      )}\r\n    </div>\r\n  )\r\n\r\n  /**\r\n   * 渲染预览内容\r\n   */\r\n  const renderPreview = () => {\r\n    if (!selectedTask) {\r\n      return (\r\n        <Empty\r\n          description=\"请选择一个报表任务\"\r\n          className={styles.emptyState}\r\n        />\r\n      )\r\n    }\r\n\r\n    if (selectedTask.status !== 'completed') {\r\n      return (\r\n        <div className={styles.taskStatus}>\r\n          <div className={styles.statusIcon}>\r\n            {selectedTask.status === 'processing' ? (\r\n              <IconRefresh spin />\r\n            ) : (\r\n              <IconFile />\r\n            )}\r\n          </div>\r\n          <Title heading={5}>\r\n            {getTaskStatusText(selectedTask.status)}\r\n          </Title>\r\n          <Text type=\"secondary\">\r\n            {selectedTask.status === 'processing' \r\n              ? `进度: ${selectedTask.progress}%`\r\n              : '报表尚未完成生成'\r\n            }\r\n          </Text>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    if (!previewData) {\r\n      return (\r\n        <div className={styles.loadingState}>\r\n          <Spin size={24} />\r\n          <Text type=\"secondary\">加载预览数据中...</Text>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div className={styles.previewContent}>\r\n        {/* 汇总统计 */}\r\n        <Card className={styles.summaryCard}>\r\n          <Row gutter={8}>\r\n            <Col span={8}>\r\n              <Statistic\r\n                title=\"记录数\"\r\n                value={previewData.summary.totalRecords}\r\n                suffix=\"条\"\r\n                className={styles.mobileStat}\r\n              />\r\n            </Col>\r\n            <Col span={8}>\r\n              <div className={styles.statItem}>\r\n                <Text type=\"secondary\" className={styles.statTitle}>\r\n                  数据范围\r\n                </Text>\r\n                <Text className={styles.statValue}>\r\n                  {previewData.summary.dateRange}\r\n                </Text>\r\n              </div>\r\n            </Col>\r\n            <Col span={8}>\r\n              <div className={styles.statItem}>\r\n                <Text type=\"secondary\" className={styles.statTitle}>\r\n                  生成时间\r\n                </Text>\r\n                <Text className={styles.statValue}>\r\n                  {new Date(previewData.summary.generatedAt).toLocaleDateString('zh-CN')}\r\n                </Text>\r\n              </div>\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n\r\n        {/* 图表预览 */}\r\n        {previewData.charts && previewData.charts.length > 0 && (\r\n          <Card title=\"图表分析\" className={styles.chartsCard}>\r\n            <div className={styles.chartsList}>\r\n              {previewData.charts.map((chart, index) => (\r\n                <div key={index} className={styles.chartItem}>\r\n                  <Text className={styles.chartTitle}>{chart.title}</Text>\r\n                  <div className={styles.chartPlaceholder}>\r\n                    <IconDashboard />\r\n                    <Text type=\"secondary\">图表预览</Text>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </Card>\r\n        )}\r\n\r\n        {/* 数据表格 */}\r\n        {previewData.tables && previewData.tables.length > 0 && (\r\n          <Card title=\"数据详情\" className={styles.tablesCard}>\r\n            <div className={styles.tablesList}>\r\n              {previewData.tables.map((table, index) => (\r\n                <div key={index} className={styles.tableItem}>\r\n                  <div className={styles.tableHeader}>\r\n                    <Text className={styles.tableTitle}>{table.title}</Text>\r\n                    <Text type=\"secondary\" className={styles.tableCount}>\r\n                      共 {table.totalRows} 条\r\n                    </Text>\r\n                  </div>\r\n                  <div className={styles.tablePreview}>\r\n                    <div className={styles.tableHeaders}>\r\n                      {table.headers.slice(0, 3).map((header, idx) => (\r\n                        <Text key={idx} className={styles.headerCell}>\r\n                          {header}\r\n                        </Text>\r\n                      ))}\r\n                      {table.headers.length > 3 && (\r\n                        <Text className={styles.headerCell}>...</Text>\r\n                      )}\r\n                    </div>\r\n                    <div className={styles.tableRows}>\r\n                      {table.rows.slice(0, 3).map((row, rowIdx) => (\r\n                        <div key={rowIdx} className={styles.tableRow}>\r\n                          {row.slice(0, 3).map((cell, cellIdx) => (\r\n                            <Text key={cellIdx} className={styles.tableCell}>\r\n                              {cell}\r\n                            </Text>\r\n                          ))}\r\n                          {row.length > 3 && (\r\n                            <Text className={styles.tableCell}>...</Text>\r\n                          )}\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </Card>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className={styles.mobileReportViewer}>\r\n      {/* 错误提示 */}\r\n      {error && (\r\n        <Alert\r\n          type=\"error\"\r\n          message=\"操作失败\"\r\n          description={error.message}\r\n          closable\r\n          className={styles.errorAlert}\r\n        />\r\n      )}\r\n\r\n      {/* 头部工具栏 */}\r\n      <div className={styles.toolbar}>\r\n        <Space>\r\n          <Button\r\n            type=\"text\"\r\n            icon={<IconFilter />}\r\n            onClick={() => setFiltersVisible(true)}\r\n            className={styles.toolbarButton}\r\n          >\r\n            筛选\r\n          </Button>\r\n          <Button\r\n            type=\"text\"\r\n            icon={<IconRefresh />}\r\n            onClick={onRefresh}\r\n            loading={loading}\r\n            className={styles.toolbarButton}\r\n          >\r\n            刷新\r\n          </Button>\r\n        </Space>\r\n      </div>\r\n\r\n      {/* 标签页内容 */}\r\n      <Tabs\r\n        activeTab={activeTab}\r\n        onChange={setActiveTab}\r\n        className={styles.mobileTabs}\r\n      >\r\n        <TabPane key=\"tasks\" title=\"报表列表\" icon={<IconFile />}>\r\n          {renderTaskList()}\r\n        </TabPane>\r\n        \r\n        <TabPane key=\"preview\" title=\"预览\" icon={<IconEye />}>\r\n          {renderPreview()}\r\n        </TabPane>\r\n      </Tabs>\r\n\r\n      {/* 筛选抽屉 */}\r\n      <Drawer\r\n        title=\"数据筛选\"\r\n        visible={filtersVisible}\r\n        onCancel={() => setFiltersVisible(false)}\r\n        placement=\"bottom\"\r\n        height=\"70%\"\r\n        className={styles.filtersDrawer}\r\n      >\r\n        <ReportFilters\r\n          filters={filters}\r\n          options={filterOptions}\r\n          onFiltersChange={setFilters}\r\n          onReset={() => setFilters({})}\r\n          collapsed={false}\r\n          showAdvanced={false}\r\n        />\r\n      </Drawer>\r\n\r\n      {/* 操作菜单 */}\r\n      <Modal\r\n        visible={actionSheetVisible}\r\n        onCancel={() => setActionSheetVisible(false)}\r\n        footer={null}\r\n        title=\"操作\"\r\n        style={{ maxWidth: '90vw' }}\r\n      >\r\n        <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n          {selectedTask?.status === 'completed' && (\r\n            <Button\r\n              type=\"text\"\r\n              icon={<IconDownload />}\r\n              long\r\n              onClick={() => {\r\n                if (selectedTask) {\r\n                  handleDownload(selectedTask.taskId)\r\n                }\r\n                setActionSheetVisible(false)\r\n              }}\r\n            >\r\n              下载报表\r\n            </Button>\r\n          )}\r\n          {selectedTask?.status === 'completed' && (\r\n            <Button\r\n              type=\"text\"\r\n              icon={<IconExport />}\r\n              long\r\n              onClick={() => {\r\n                if (selectedTask) {\r\n                  handleShare(selectedTask)\r\n                }\r\n                setActionSheetVisible(false)\r\n              }}\r\n            >\r\n              分享报表\r\n            </Button>\r\n          )}\r\n          <Button\r\n            type=\"text\"\r\n            icon={<IconEye />}\r\n            long\r\n            onClick={() => {\r\n              if (selectedTask) {\r\n                handleTaskSelect(selectedTask)\r\n              }\r\n              setActionSheetVisible(false)\r\n            }}\r\n          >\r\n            查看预览\r\n          </Button>\r\n        </Space>\r\n      </Modal>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MobileReportViewer",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\analytics\\MobileStoreMap.tsx",
        "messages": [
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'useEffect' is defined but never used.",
            "line": 5,
            "column": 27,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 5,
            "endColumn": 36
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'filters' is defined but never used.",
            "line": 62,
            "column": 64,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 62,
            "endColumn": 71
          }
        ],
        "suppressedMessages": [],
        "errorCount": 2,
        "fatalErrorCount": 0,
        "warningCount": 0,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 移动端门店地图组件\r\n * 优化的地图可视化，支持触摸交互\r\n */\r\nimport React, { useState, useEffect } from 'react'\r\nimport { Card, Tag, Space, Typography, Empty, List, Drawer } from '@arco-design/web-react'\r\nimport { IconLocation, IconCheckCircle, IconClockCircle } from '@arco-design/web-react/icon'\r\nimport './MobileStoreMap.css'\r\n\r\nconst { Text, Title } = Typography\r\n\r\n/**\r\n * 门店位置数据接口\r\n */\r\ninterface StoreLocation {\r\n  id: number\r\n  name: string\r\n  code: string\r\n  province: string\r\n  city: string\r\n  district: string\r\n  address: string\r\n  status: string\r\n  store_type: string\r\n  operation_mode: string\r\n  opening_date?: string\r\n  created_at: string\r\n}\r\n\r\n/**\r\n * 地图数据接口\r\n */\r\ninterface StoreMapData {\r\n  stores: StoreLocation[]\r\n  region_statistics: any[]\r\n  status_statistics: Record<string, number>\r\n  total_count: number\r\n  last_updated: string\r\n}\r\n\r\n/**\r\n * 组件属性接口\r\n */\r\ninterface MobileStoreMapProps {\r\n  data: StoreMapData\r\n  filters?: any\r\n}\r\n\r\n/**\r\n * 状态配置\r\n */\r\nconst STATUS_CONFIG: Record<string, { label: string; color: string; icon: any }> = {\r\n  opened: { label: '已开业', color: 'green', icon: <IconCheckCircle /> },\r\n  preparing: { label: '筹备中', color: 'orange', icon: <IconClockCircle /> },\r\n  following: { label: '跟进中', color: 'blue', icon: <IconClockCircle /> },\r\n  planned: { label: '计划中', color: 'gray', icon: <IconClockCircle /> },\r\n}\r\n\r\n/**\r\n * 移动端门店地图组件\r\n */\r\nconst MobileStoreMap: React.FC<MobileStoreMapProps> = ({ data, filters }) => {\r\n  const [selectedStore, setSelectedStore] = useState<StoreLocation | null>(null)\r\n  const [groupBy, setGroupBy] = useState<'province' | 'status'>('province')\r\n  const [showDetail, setShowDetail] = useState(false)\r\n  \r\n  // 按省份分组\r\n  const groupByProvince = () => {\r\n    const grouped: Record<string, StoreLocation[]> = {}\r\n    data.stores.forEach(store => {\r\n      if (!grouped[store.province]) {\r\n        grouped[store.province] = []\r\n      }\r\n      grouped[store.province].push(store)\r\n    })\r\n    return grouped\r\n  }\r\n  \r\n  // 按状态分组\r\n  const groupByStatus = () => {\r\n    const grouped: Record<string, StoreLocation[]> = {}\r\n    data.stores.forEach(store => {\r\n      if (!grouped[store.status]) {\r\n        grouped[store.status] = []\r\n      }\r\n      grouped[store.status].push(store)\r\n    })\r\n    return grouped\r\n  }\r\n  \r\n  // 获取分组数据\r\n  const getGroupedData = () => {\r\n    return groupBy === 'province' ? groupByProvince() : groupByStatus()\r\n  }\r\n  \r\n  // 处理门店点击\r\n  const handleStoreClick = (store: StoreLocation) => {\r\n    setSelectedStore(store)\r\n    setShowDetail(true)\r\n  }\r\n  \r\n  // 渲染状态统计\r\n  const renderStatusStats = () => {\r\n    return (\r\n      <Card className=\"status-stats-card\" bordered={false}>\r\n        <Space wrap>\r\n          {Object.entries(data.status_statistics).map(([status, count]) => {\r\n            const config = STATUS_CONFIG[status] || { label: status, color: 'default', icon: null }\r\n            return (\r\n              <Tag key={status} color={config.color} icon={config.icon}>\r\n                {config.label}: {count}\r\n              </Tag>\r\n            )\r\n          })}\r\n        </Space>\r\n      </Card>\r\n    )\r\n  }\r\n  \r\n  // 渲染门店列表\r\n  const renderStoreList = () => {\r\n    const groupedData = getGroupedData()\r\n    \r\n    if (Object.keys(groupedData).length === 0) {\r\n      return <Empty description=\"暂无门店数据\" />\r\n    }\r\n    \r\n    return (\r\n      <div className=\"mobile-store-list\">\r\n        {Object.entries(groupedData).map(([groupKey, stores]) => (\r\n          <Card \r\n            key={groupKey}\r\n            className=\"store-group-card\"\r\n            title={\r\n              <Space>\r\n                <Text strong>{groupKey}</Text>\r\n                <Tag>{stores.length}家</Tag>\r\n              </Space>\r\n            }\r\n            bordered={false}\r\n          >\r\n            <List\r\n              dataSource={stores}\r\n              render={(store) => (\r\n                <List.Item\r\n                  key={store.id}\r\n                  onClick={() => handleStoreClick(store)}\r\n                  className=\"store-list-item\"\r\n                >\r\n                  <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n                    <Space>\r\n                      <IconLocation style={{ color: '#165DFF' }} />\r\n                      <Text strong>{store.name}</Text>\r\n                      <Tag color={STATUS_CONFIG[store.status]?.color || 'default'} size=\"small\">\r\n                        {STATUS_CONFIG[store.status]?.label || store.status}\r\n                      </Tag>\r\n                    </Space>\r\n                    <Text type=\"secondary\" style={{ fontSize: 12 }}>\r\n                      {store.city} {store.district} · {store.store_type}\r\n                    </Text>\r\n                  </Space>\r\n                </List.Item>\r\n              )}\r\n            />\r\n          </Card>\r\n        ))}\r\n      </div>\r\n    )\r\n  }\r\n  \r\n  // 渲染门店详情抽屉\r\n  const renderStoreDetail = () => {\r\n    if (!selectedStore) return null\r\n    \r\n    return (\r\n      <Drawer\r\n        width=\"90%\"\r\n        title=\"门店详情\"\r\n        visible={showDetail}\r\n        onCancel={() => setShowDetail(false)}\r\n      >\r\n        <Space direction=\"vertical\" size=\"large\" style={{ width: '100%' }}>\r\n          <div>\r\n            <Text type=\"secondary\">门店名称</Text>\r\n            <Title heading={6} style={{ margin: '4px 0' }}>{selectedStore.name}</Title>\r\n          </div>\r\n          \r\n          <div>\r\n            <Text type=\"secondary\">门店编码</Text>\r\n            <Text style={{ display: 'block', marginTop: 4 }}>{selectedStore.code}</Text>\r\n          </div>\r\n          \r\n          <div>\r\n            <Text type=\"secondary\">门店状态</Text>\r\n            <div style={{ marginTop: 4 }}>\r\n              <Tag color={STATUS_CONFIG[selectedStore.status]?.color || 'default'}>\r\n                {STATUS_CONFIG[selectedStore.status]?.label || selectedStore.status}\r\n              </Tag>\r\n            </div>\r\n          </div>\r\n          \r\n          <div>\r\n            <Text type=\"secondary\">门店地址</Text>\r\n            <Text style={{ display: 'block', marginTop: 4 }}>\r\n              {selectedStore.province} {selectedStore.city} {selectedStore.district}\r\n            </Text>\r\n            <Text style={{ display: 'block', marginTop: 4 }}>\r\n              {selectedStore.address}\r\n            </Text>\r\n          </div>\r\n          \r\n          <div>\r\n            <Text type=\"secondary\">门店类型</Text>\r\n            <Text style={{ display: 'block', marginTop: 4 }}>{selectedStore.store_type}</Text>\r\n          </div>\r\n          \r\n          <div>\r\n            <Text type=\"secondary\">经营模式</Text>\r\n            <Text style={{ display: 'block', marginTop: 4 }}>{selectedStore.operation_mode}</Text>\r\n          </div>\r\n          \r\n          {selectedStore.opening_date && (\r\n            <div>\r\n              <Text type=\"secondary\">开业日期</Text>\r\n              <Text style={{ display: 'block', marginTop: 4 }}>\r\n                {new Date(selectedStore.opening_date).toLocaleDateString('zh-CN')}\r\n              </Text>\r\n            </div>\r\n          )}\r\n        </Space>\r\n      </Drawer>\r\n    )\r\n  }\r\n  \r\n  return (\r\n    <div className=\"mobile-store-map\">\r\n      {/* 状态统计 */}\r\n      {renderStatusStats()}\r\n      \r\n      {/* 分组切换 */}\r\n      <Card bordered={false} style={{ marginTop: 12 }}>\r\n        <Space>\r\n          <Text>分组方式：</Text>\r\n          <Tag \r\n            checkable \r\n            checked={groupBy === 'province'}\r\n            onClick={() => setGroupBy('province')}\r\n          >\r\n            按省份\r\n          </Tag>\r\n          <Tag \r\n            checkable \r\n            checked={groupBy === 'status'}\r\n            onClick={() => setGroupBy('status')}\r\n          >\r\n            按状态\r\n          </Tag>\r\n        </Space>\r\n      </Card>\r\n      \r\n      {/* 门店列表 */}\r\n      {renderStoreList()}\r\n      \r\n      {/* 门店详情 */}\r\n      {renderStoreDetail()}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MobileStoreMap\r\n",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\analytics\\ReportFilters.tsx",
        "messages": [
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'Checkbox' is defined but never used.",
            "line": 14,
            "column": 3,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 14,
            "endColumn": 11
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'InputNumber' is defined but never used.",
            "line": 15,
            "column": 3,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 15,
            "endColumn": 14
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'Divider' is defined but never used.",
            "line": 17,
            "column": 3,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 17,
            "endColumn": 10
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'Tooltip' is defined but never used.",
            "line": 19,
            "column": 3,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 19,
            "endColumn": 10
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'IconClose' is defined but never used.",
            "line": 26,
            "column": 3,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 26,
            "endColumn": 12
          }
        ],
        "suppressedMessages": [],
        "errorCount": 5,
        "fatalErrorCount": 0,
        "warningCount": 0,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 报表数据筛选组件 - 多维度筛选\r\n */\r\nimport React, { useState, useEffect } from 'react'\r\nimport {\r\n  Card,\r\n  Form,\r\n  Grid,\r\n  Select,\r\n  DatePicker,\r\n  Button,\r\n  Space,\r\n  Collapse,\r\n  Checkbox,\r\n  InputNumber,\r\n  Typography,\r\n  Divider,\r\n  Tag,\r\n  Tooltip\r\n} from '@arco-design/web-react'\r\nimport {\r\n  IconFilter,\r\n  IconRefresh,\r\n  IconDown,\r\n  IconUp,\r\n  IconClose\r\n} from '@arco-design/web-react/icon'\r\nimport type { ReportFilters as ReportFiltersType } from '../../api/reportService'\r\nimport styles from './ReportFilters.module.css'\r\n\r\nconst { Row, Col } = Grid\r\nconst { RangePicker } = DatePicker\r\nconst { Text } = Typography\r\nconst { Option } = Select\r\n\r\n// 筛选选项接口\r\nexport interface FilterOptions {\r\n  regions: Array<{ id: number; name: string }>\r\n  storeTypes: Array<{ code: string; name: string }>\r\n  statuses: Array<{ code: string; name: string }>\r\n  contributionTypes: Array<{ code: string; name: string }>\r\n  businessRegions: Array<{ id: number; name: string }>\r\n}\r\n\r\n// 组件属性\r\nexport interface ReportFiltersProps {\r\n  filters: ReportFiltersType\r\n  options: FilterOptions\r\n  loading?: boolean\r\n  collapsed?: boolean\r\n  showAdvanced?: boolean\r\n  onFiltersChange: (filters: ReportFiltersType) => void\r\n  onReset: () => void\r\n  onCollapse?: (collapsed: boolean) => void\r\n}\r\n\r\n// 预设时间范围\r\nconst TIME_PRESETS = [\r\n  {\r\n    label: '今天',\r\n    value: () => {\r\n      const today = new Date()\r\n      return [today, today]\r\n    }\r\n  },\r\n  {\r\n    label: '昨天',\r\n    value: () => {\r\n      const yesterday = new Date()\r\n      yesterday.setDate(yesterday.getDate() - 1)\r\n      return [yesterday, yesterday]\r\n    }\r\n  },\r\n  {\r\n    label: '最近7天',\r\n    value: () => {\r\n      const end = new Date()\r\n      const start = new Date()\r\n      start.setDate(start.getDate() - 6)\r\n      return [start, end]\r\n    }\r\n  },\r\n  {\r\n    label: '最近30天',\r\n    value: () => {\r\n      const end = new Date()\r\n      const start = new Date()\r\n      start.setDate(start.getDate() - 29)\r\n      return [start, end]\r\n    }\r\n  },\r\n  {\r\n    label: '本月',\r\n    value: () => {\r\n      const now = new Date()\r\n      const start = new Date(now.getFullYear(), now.getMonth(), 1)\r\n      const end = new Date(now.getFullYear(), now.getMonth() + 1, 0)\r\n      return [start, end]\r\n    }\r\n  },\r\n  {\r\n    label: '上月',\r\n    value: () => {\r\n      const now = new Date()\r\n      const start = new Date(now.getFullYear(), now.getMonth() - 1, 1)\r\n      const end = new Date(now.getFullYear(), now.getMonth(), 0)\r\n      return [start, end]\r\n    }\r\n  },\r\n  {\r\n    label: '本季度',\r\n    value: () => {\r\n      const now = new Date()\r\n      const quarter = Math.floor(now.getMonth() / 3)\r\n      const start = new Date(now.getFullYear(), quarter * 3, 1)\r\n      const end = new Date(now.getFullYear(), quarter * 3 + 3, 0)\r\n      return [start, end]\r\n    }\r\n  },\r\n  {\r\n    label: '本年',\r\n    value: () => {\r\n      const now = new Date()\r\n      const start = new Date(now.getFullYear(), 0, 1)\r\n      const end = new Date(now.getFullYear(), 11, 31)\r\n      return [start, end]\r\n    }\r\n  }\r\n]\r\n\r\n/**\r\n * 报表筛选组件\r\n */\r\nconst ReportFilters: React.FC<ReportFiltersProps> = ({\r\n  filters,\r\n  options,\r\n  loading = false,\r\n  collapsed = false,\r\n  showAdvanced = true,\r\n  onFiltersChange,\r\n  onReset,\r\n  onCollapse\r\n}) => {\r\n  const [form] = Form.useForm()\r\n  const [isCollapsed, setIsCollapsed] = useState(collapsed)\r\n  const [activeFiltersCount, setActiveFiltersCount] = useState(0)\r\n\r\n  // 同步表单值\r\n  useEffect(() => {\r\n    form.setFieldsValue({\r\n      dateRange: filters.dateRange ? [\r\n        new Date(filters.dateRange.startDate),\r\n        new Date(filters.dateRange.endDate)\r\n      ] : undefined,\r\n      regions: filters.regions,\r\n      storeTypes: filters.storeTypes,\r\n      statuses: filters.statuses,\r\n      contributionTypes: filters.contributionTypes,\r\n      businessRegions: filters.businessRegions\r\n    })\r\n  }, [filters, form])\r\n\r\n  // 计算活跃筛选条件数量\r\n  useEffect(() => {\r\n    let count = 0\r\n    if (filters.dateRange) count++\r\n    if (filters.regions?.length) count++\r\n    if (filters.storeTypes?.length) count++\r\n    if (filters.statuses?.length) count++\r\n    if (filters.contributionTypes?.length) count++\r\n    if (filters.businessRegions?.length) count++\r\n    setActiveFiltersCount(count)\r\n  }, [filters])\r\n\r\n  /**\r\n   * 处理筛选条件变化\r\n   */\r\n  const handleFiltersChange = (_changedFields: any, allFields: any) => {\r\n    const newFilters: ReportFiltersType = {}\r\n\r\n    // 处理日期范围\r\n    if (allFields.dateRange && allFields.dateRange.length === 2) {\r\n      newFilters.dateRange = {\r\n        startDate: allFields.dateRange[0].toISOString().split('T')[0],\r\n        endDate: allFields.dateRange[1].toISOString().split('T')[0]\r\n      }\r\n    }\r\n\r\n    // 处理其他筛选条件\r\n    if (allFields.regions?.length) {\r\n      newFilters.regions = allFields.regions\r\n    }\r\n    if (allFields.storeTypes?.length) {\r\n      newFilters.storeTypes = allFields.storeTypes\r\n    }\r\n    if (allFields.statuses?.length) {\r\n      newFilters.statuses = allFields.statuses\r\n    }\r\n    if (allFields.contributionTypes?.length) {\r\n      newFilters.contributionTypes = allFields.contributionTypes\r\n    }\r\n    if (allFields.businessRegions?.length) {\r\n      newFilters.businessRegions = allFields.businessRegions\r\n    }\r\n\r\n    onFiltersChange(newFilters)\r\n  }\r\n\r\n  /**\r\n   * 重置筛选条件\r\n   */\r\n  const handleReset = () => {\r\n    form.resetFields()\r\n    onReset()\r\n  }\r\n\r\n  /**\r\n   * 切换折叠状态\r\n   */\r\n  const handleToggleCollapse = () => {\r\n    const newCollapsed = !isCollapsed\r\n    setIsCollapsed(newCollapsed)\r\n    onCollapse?.(newCollapsed)\r\n  }\r\n\r\n  /**\r\n   * 快速选择时间范围\r\n   */\r\n  const handleTimePresetClick = (preset: typeof TIME_PRESETS[0]) => {\r\n    const [start, end] = preset.value()\r\n    form.setFieldValue('dateRange', [start, end])\r\n    \r\n    const newFilters = {\r\n      ...filters,\r\n      dateRange: {\r\n        startDate: start.toISOString().split('T')[0],\r\n        endDate: end.toISOString().split('T')[0]\r\n      }\r\n    }\r\n    onFiltersChange(newFilters)\r\n  }\r\n\r\n  /**\r\n   * 移除单个筛选条件\r\n   */\r\n  const handleRemoveFilter = (filterKey: keyof ReportFiltersType, value?: any) => {\r\n    const newFilters = { ...filters }\r\n    \r\n    if (filterKey === 'dateRange') {\r\n      delete newFilters.dateRange\r\n      form.setFieldValue('dateRange', undefined)\r\n    } else if (value !== undefined) {\r\n      // 移除数组中的特定值\r\n      const currentValues = newFilters[filterKey] as any[]\r\n      if (currentValues) {\r\n        const newValues = currentValues.filter(v => v !== value)\r\n        if (newValues.length === 0) {\r\n          delete newFilters[filterKey]\r\n        } else {\r\n          (newFilters as any)[filterKey] = newValues\r\n        }\r\n        form.setFieldValue(filterKey, newValues.length > 0 ? newValues : undefined)\r\n      }\r\n    } else {\r\n      // 移除整个筛选条件\r\n      delete newFilters[filterKey]\r\n      form.setFieldValue(filterKey, undefined)\r\n    }\r\n    \r\n    onFiltersChange(newFilters)\r\n  }\r\n\r\n  /**\r\n   * 渲染活跃筛选标签\r\n   */\r\n  const renderActiveFilters = () => {\r\n    const tags: React.ReactNode[] = []\r\n\r\n    // 日期范围标签\r\n    if (filters.dateRange) {\r\n      tags.push(\r\n        <Tag\r\n          key=\"dateRange\"\r\n          closable\r\n          onClose={() => handleRemoveFilter('dateRange')}\r\n          className={styles.filterTag}\r\n        >\r\n          时间: {filters.dateRange.startDate} ~ {filters.dateRange.endDate}\r\n        </Tag>\r\n      )\r\n    }\r\n\r\n    // 区域标签\r\n    filters.regions?.forEach(regionId => {\r\n      const region = options.regions.find(r => r.id === regionId)\r\n      if (region) {\r\n        tags.push(\r\n          <Tag\r\n            key={`region-${regionId}`}\r\n            closable\r\n            onClose={() => handleRemoveFilter('regions', regionId)}\r\n            className={styles.filterTag}\r\n          >\r\n            区域: {region.name}\r\n          </Tag>\r\n        )\r\n      }\r\n    })\r\n\r\n    // 门店类型标签\r\n    filters.storeTypes?.forEach(typeCode => {\r\n      const storeType = options.storeTypes.find(t => t.code === typeCode)\r\n      if (storeType) {\r\n        tags.push(\r\n          <Tag\r\n            key={`storeType-${typeCode}`}\r\n            closable\r\n            onClose={() => handleRemoveFilter('storeTypes', typeCode)}\r\n            className={styles.filterTag}\r\n          >\r\n            类型: {storeType.name}\r\n          </Tag>\r\n        )\r\n      }\r\n    })\r\n\r\n    // 状态标签\r\n    filters.statuses?.forEach(statusCode => {\r\n      const status = options.statuses.find(s => s.code === statusCode)\r\n      if (status) {\r\n        tags.push(\r\n          <Tag\r\n            key={`status-${statusCode}`}\r\n            closable\r\n            onClose={() => handleRemoveFilter('statuses', statusCode)}\r\n            className={styles.filterTag}\r\n          >\r\n            状态: {status.name}\r\n          </Tag>\r\n        )\r\n      }\r\n    })\r\n\r\n    return tags.length > 0 ? (\r\n      <div className={styles.activeFilters}>\r\n        <Text className={styles.activeFiltersLabel}>当前筛选:</Text>\r\n        <Space wrap>{tags}</Space>\r\n        <Button\r\n          type=\"text\"\r\n          size=\"small\"\r\n          onClick={handleReset}\r\n          className={styles.clearAllButton}\r\n        >\r\n          清空全部\r\n        </Button>\r\n      </div>\r\n    ) : null\r\n  }\r\n\r\n  /**\r\n   * 渲染时间预设按钮\r\n   */\r\n  const renderTimePresets = () => (\r\n    <div className={styles.timePresets}>\r\n      <Text className={styles.presetsLabel}>快速选择:</Text>\r\n      <Space wrap>\r\n        {TIME_PRESETS.map(preset => (\r\n          <Button\r\n            key={preset.label}\r\n            size=\"small\"\r\n            type=\"text\"\r\n            onClick={() => handleTimePresetClick(preset)}\r\n            className={styles.presetButton}\r\n          >\r\n            {preset.label}\r\n          </Button>\r\n        ))}\r\n      </Space>\r\n    </div>\r\n  )\r\n\r\n  return (\r\n    <Card className={styles.filtersCard}>\r\n      {/* 筛选器头部 */}\r\n      <div className={styles.filtersHeader}>\r\n        <div className={styles.headerLeft}>\r\n          <Space>\r\n            <IconFilter />\r\n            <Text className={styles.title}>数据筛选</Text>\r\n            {activeFiltersCount > 0 && (\r\n              <Tag color=\"blue\" size=\"small\">\r\n                {activeFiltersCount} 个筛选条件\r\n              </Tag>\r\n            )}\r\n          </Space>\r\n        </div>\r\n        \r\n        <div className={styles.headerRight}>\r\n          <Space>\r\n            <Button\r\n              type=\"text\"\r\n              size=\"small\"\r\n              icon={<IconRefresh />}\r\n              onClick={handleReset}\r\n              disabled={loading}\r\n            >\r\n              重置\r\n            </Button>\r\n            <Button\r\n              type=\"text\"\r\n              size=\"small\"\r\n              icon={isCollapsed ? <IconDown /> : <IconUp />}\r\n              onClick={handleToggleCollapse}\r\n            >\r\n              {isCollapsed ? '展开' : '收起'}\r\n            </Button>\r\n          </Space>\r\n        </div>\r\n      </div>\r\n\r\n      {/* 活跃筛选标签 */}\r\n      {!isCollapsed && renderActiveFilters()}\r\n\r\n      {/* 筛选表单 */}\r\n      {!isCollapsed && (\r\n        <div className={styles.filtersContent}>\r\n          <Form\r\n            form={form}\r\n            layout=\"vertical\"\r\n            onValuesChange={handleFiltersChange}\r\n            disabled={loading}\r\n          >\r\n            {/* 基础筛选 */}\r\n            <div className={styles.basicFilters}>\r\n              <Row gutter={16}>\r\n                <Col span={8}>\r\n                  <Form.Item label=\"时间范围\" field=\"dateRange\">\r\n                    <RangePicker\r\n                      style={{ width: '100%' }}\r\n                      placeholder={['开始日期', '结束日期']}\r\n                      allowClear\r\n                    />\r\n                  </Form.Item>\r\n                  {renderTimePresets()}\r\n                </Col>\r\n                \r\n                <Col span={8}>\r\n                  <Form.Item label=\"业务区域\" field=\"regions\">\r\n                    <Select\r\n                      placeholder=\"请选择区域\"\r\n                      mode=\"multiple\"\r\n                      allowClear\r\n                      maxTagCount={2}\r\n                    >\r\n                      {options.regions.map(region => (\r\n                        <Option key={region.id} value={region.id}>\r\n                          {region.name}\r\n                        </Option>\r\n                      ))}\r\n                    </Select>\r\n                  </Form.Item>\r\n                </Col>\r\n                \r\n                <Col span={8}>\r\n                  <Form.Item label=\"门店类型\" field=\"storeTypes\">\r\n                    <Select\r\n                      placeholder=\"请选择类型\"\r\n                      mode=\"multiple\"\r\n                      allowClear\r\n                      maxTagCount={2}\r\n                    >\r\n                      {options.storeTypes.map(type => (\r\n                        <Option key={type.code} value={type.code}>\r\n                          {type.name}\r\n                        </Option>\r\n                      ))}\r\n                    </Select>\r\n                  </Form.Item>\r\n                </Col>\r\n              </Row>\r\n            </div>\r\n\r\n            {/* 高级筛选 */}\r\n            {showAdvanced && (\r\n              <Collapse className={styles.advancedFilters}>\r\n                <Collapse.Item key=\"advanced\" header=\"高级筛选\">\r\n                  <Row gutter={16}>\r\n                    <Col span={8}>\r\n                      <Form.Item label=\"状态\" field=\"statuses\">\r\n                        <Select\r\n                          placeholder=\"请选择状态\"\r\n                          mode=\"multiple\"\r\n                          allowClear\r\n                          maxTagCount={2}\r\n                        >\r\n                          {options.statuses.map(status => (\r\n                            <Option key={status.code} value={status.code}>\r\n                              {status.name}\r\n                            </Option>\r\n                          ))}\r\n                        </Select>\r\n                      </Form.Item>\r\n                    </Col>\r\n                    \r\n                    <Col span={8}>\r\n                      <Form.Item label=\"贡献率类型\" field=\"contributionTypes\">\r\n                        <Select\r\n                          placeholder=\"请选择贡献率类型\"\r\n                          mode=\"multiple\"\r\n                          allowClear\r\n                          maxTagCount={2}\r\n                        >\r\n                          {options.contributionTypes.map(type => (\r\n                            <Option key={type.code} value={type.code}>\r\n                              {type.name}\r\n                            </Option>\r\n                          ))}\r\n                        </Select>\r\n                      </Form.Item>\r\n                    </Col>\r\n                    \r\n                    <Col span={8}>\r\n                      <Form.Item label=\"经营区域\" field=\"businessRegions\">\r\n                        <Select\r\n                          placeholder=\"请选择经营区域\"\r\n                          mode=\"multiple\"\r\n                          allowClear\r\n                          maxTagCount={2}\r\n                        >\r\n                          {options.businessRegions.map(region => (\r\n                            <Option key={region.id} value={region.id}>\r\n                              {region.name}\r\n                            </Option>\r\n                          ))}\r\n                        </Select>\r\n                      </Form.Item>\r\n                    </Col>\r\n                  </Row>\r\n                </Collapse.Item>\r\n              </Collapse>\r\n            )}\r\n          </Form>\r\n        </div>\r\n      )}\r\n    </Card>\r\n  )\r\n}\r\n\r\nexport default ReportFilters",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\analytics\\ReportGenerator.tsx",
        "messages": [
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'Spin' is defined but never used.",
            "line": 23,
            "column": 3,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 23,
            "endColumn": 7
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'IconExclamation' is defined but never used.",
            "line": 35,
            "column": 3,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 35,
            "endColumn": 18
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'ReportFormat' is defined but never used.",
            "line": 42,
            "column": 3,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 42,
            "endColumn": 15
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'Title' is assigned a value but never used.",
            "line": 52,
            "column": 9,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 52,
            "endColumn": 14
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'getReportPreview' is assigned a value but never used.",
            "line": 122,
            "column": 5,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 122,
            "endColumn": 21
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'shareReport' is assigned a value but never used.",
            "line": 124,
            "column": 5,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 124,
            "endColumn": 16
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'error' is defined but never used.",
            "line": 137,
            "column": 26,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 137,
            "endColumn": 31
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'config' is assigned a value but never used.",
            "line": 216,
            "column": 13,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 216,
            "endColumn": 33
          }
        ],
        "suppressedMessages": [],
        "errorCount": 8,
        "fatalErrorCount": 0,
        "warningCount": 0,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 报表生成器组件\r\n */\r\nimport React, { useState, useEffect } from 'react'\r\nimport {\r\n  Card,\r\n  Form,\r\n  Grid,\r\n  Select,\r\n  Button,\r\n  Space,\r\n  Typography,\r\n  Radio,\r\n  Checkbox,\r\n  Divider,\r\n  Alert,\r\n  Modal,\r\n  Progress,\r\n  List,\r\n  Tag,\r\n  Tooltip,\r\n  Empty,\r\n  Spin\r\n} from '@arco-design/web-react'\r\nimport {\r\n  IconDownload,\r\n  IconEye,\r\n  IconExport,\r\n  IconDelete,\r\n  IconRefresh,\r\n  IconFile,\r\n  IconClockCircle, // 修复: IconClock 不存在于 Arco Design，使用 IconClockCircle 替代 (2025-11-04)\r\n  IconCheck,\r\n  IconClose,\r\n  IconExclamation\r\n} from '@arco-design/web-react/icon'\r\nimport { useReportService } from '../../api/reportService'\r\nimport type { \r\n  ReportConfig, \r\n  ReportTask, \r\n  ReportType, \r\n  ReportFormat,\r\n  ReportFilters,\r\n  FilterOptions \r\n} from '../../api/reportService'\r\nimport ReportFilters from './ReportFilters'\r\nimport ReportPreview from './ReportPreview'\r\nimport ReportShare from './ReportShare'\r\nimport styles from './ReportGenerator.module.css'\r\n\r\nconst { Row, Col } = Grid\r\nconst { Title, Text } = Typography\r\nconst { Option } = Select\r\n\r\n// 报表类型配置\r\nconst REPORT_TYPES: Array<{\r\n  value: ReportType\r\n  label: string\r\n  description: string\r\n  estimatedTime: number\r\n}> = [\r\n  {\r\n    value: 'plan',\r\n    label: '开店计划报表',\r\n    description: '包含计划执行情况、区域分布、完成率等数据',\r\n    estimatedTime: 30\r\n  },\r\n  {\r\n    value: 'followUp',\r\n    label: '拓店跟进报表',\r\n    description: '包含跟进记录、转化漏斗、盈利测算等数据',\r\n    estimatedTime: 45\r\n  },\r\n  {\r\n    value: 'preparation',\r\n    label: '筹备进度报表',\r\n    description: '包含工程进度、验收情况、交付状态等数据',\r\n    estimatedTime: 60\r\n  },\r\n  {\r\n    value: 'assets',\r\n    label: '门店资产报表',\r\n    description: '包含资产清单、价值统计、维护记录等数据',\r\n    estimatedTime: 40\r\n  },\r\n  {\r\n    value: 'comprehensive',\r\n    label: '综合经营报表',\r\n    description: '包含全面的经营数据分析和统计',\r\n    estimatedTime: 120\r\n  }\r\n]\r\n\r\n// 组件属性\r\nexport interface ReportGeneratorProps {\r\n  filterOptions: FilterOptions\r\n  onReportGenerated?: (task: ReportTask) => void\r\n}\r\n\r\n/**\r\n * 报表生成器组件\r\n */\r\nconst ReportGenerator: React.FC<ReportGeneratorProps> = ({\r\n  filterOptions,\r\n  onReportGenerated\r\n}) => {\r\n  const [form] = Form.useForm()\r\n  const [filters, setFilters] = useState<ReportFilters>({})\r\n  const [previewVisible, setPreviewVisible] = useState(false)\r\n  const [shareVisible, setShareVisible] = useState(false)\r\n  const [selectedTask, setSelectedTask] = useState<ReportTask | null>(null)\r\n  const [taskListVisible, setTaskListVisible] = useState(false)\r\n  const [pollingTasks, setPollingTasks] = useState<Set<string>>(new Set())\r\n\r\n  // 使用报表服务\r\n  const {\r\n    loading,\r\n    error,\r\n    tasks,\r\n    generateReport,\r\n    getReportStatus,\r\n    getReportPreview,\r\n    downloadReport,\r\n    shareReport,\r\n    getUserReportTasks,\r\n    deleteReportTask\r\n  } = useReportService({\r\n    onTaskCreated: (task) => {\r\n      onReportGenerated?.(task)\r\n      // 开始轮询任务状态\r\n      startPollingTask(task.taskId)\r\n    },\r\n    onTaskCompleted: (task) => {\r\n      // 停止轮询\r\n      stopPollingTask(task.taskId)\r\n    },\r\n    onTaskFailed: (task, error) => {\r\n      // 停止轮询\r\n      stopPollingTask(task.taskId)\r\n    }\r\n  })\r\n\r\n  // 初始化加载任务列表\r\n  useEffect(() => {\r\n    getUserReportTasks()\r\n  }, [getUserReportTasks])\r\n\r\n  // 轮询任务状态\r\n  useEffect(() => {\r\n    const intervals: Record<string, NodeJS.Timeout> = {}\r\n\r\n    pollingTasks.forEach(taskId => {\r\n      intervals[taskId] = setInterval(async () => {\r\n        const task = await getReportStatus(taskId)\r\n        if (task && (task.status === 'completed' || task.status === 'failed')) {\r\n          stopPollingTask(taskId)\r\n        }\r\n      }, 2000) // 每2秒轮询一次\r\n    })\r\n\r\n    return () => {\r\n      Object.values(intervals).forEach(clearInterval)\r\n    }\r\n  }, [pollingTasks, getReportStatus])\r\n\r\n  /**\r\n   * 开始轮询任务状态\r\n   */\r\n  const startPollingTask = (taskId: string) => {\r\n    setPollingTasks(prev => new Set([...prev, taskId]))\r\n  }\r\n\r\n  /**\r\n   * 停止轮询任务状态\r\n   */\r\n  const stopPollingTask = (taskId: string) => {\r\n    setPollingTasks(prev => {\r\n      const newSet = new Set(prev)\r\n      newSet.delete(taskId)\r\n      return newSet\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 生成报表\r\n   */\r\n  const handleGenerateReport = async () => {\r\n    try {\r\n      const values = await form.validate()\r\n      \r\n      const config: ReportConfig = {\r\n        reportType: values.reportType,\r\n        filters,\r\n        format: values.format || 'excel',\r\n        includeCharts: values.includeCharts !== false,\r\n        includeSummary: values.includeSummary !== false,\r\n        customFields: values.customFields\r\n      }\r\n\r\n      await generateReport(config)\r\n      \r\n      // 显示任务列表\r\n      setTaskListVisible(true)\r\n    } catch (error) {\r\n      console.error('生成报表失败:', error)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 预览报表\r\n   */\r\n  const handlePreviewReport = async () => {\r\n    try {\r\n      const values = await form.validate()\r\n      \r\n      const config: ReportConfig = {\r\n        reportType: values.reportType,\r\n        filters,\r\n        format: values.format || 'excel',\r\n        includeCharts: values.includeCharts !== false,\r\n        includeSummary: values.includeSummary !== false,\r\n        customFields: values.customFields\r\n      }\r\n\r\n      setPreviewVisible(true)\r\n    } catch (error) {\r\n      console.error('预览报表失败:', error)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 下载报表\r\n   */\r\n  const handleDownloadReport = async (taskId: string) => {\r\n    try {\r\n      await downloadReport(taskId)\r\n    } catch (error) {\r\n      console.error('下载报表失败:', error)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 分享报表\r\n   */\r\n  const handleShareReport = (task: ReportTask) => {\r\n    setSelectedTask(task)\r\n    setShareVisible(true)\r\n  }\r\n\r\n  /**\r\n   * 删除报表任务\r\n   */\r\n  const handleDeleteTask = async (taskId: string) => {\r\n    Modal.confirm({\r\n      title: '确认删除',\r\n      content: '确定要删除这个报表任务吗？此操作不可撤销。',\r\n      onOk: async () => {\r\n        await deleteReportTask(taskId)\r\n        stopPollingTask(taskId)\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 刷新任务列表\r\n   */\r\n  const handleRefreshTasks = () => {\r\n    getUserReportTasks()\r\n  }\r\n\r\n  /**\r\n   * 获取任务状态图标\r\n   */\r\n  const getTaskStatusIcon = (status: ReportTask['status']) => {\r\n    switch (status) {\r\n      case 'pending':\r\n        // 修复: 使用 IconClockCircle 替代不存在的 IconClock (2025-11-04)\r\n        return <IconClockCircle style={{ color: '#faad14' }} />\r\n      case 'processing':\r\n        return <IconRefresh spin style={{ color: '#1890ff' }} />\r\n      case 'completed':\r\n        return <IconCheck style={{ color: '#52c41a' }} />\r\n      case 'failed':\r\n        return <IconClose style={{ color: '#f5222d' }} />\r\n      default:\r\n        return <IconFile />\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取任务状态文本\r\n   */\r\n  const getTaskStatusText = (status: ReportTask['status']) => {\r\n    const statusMap = {\r\n      pending: '等待中',\r\n      processing: '生成中',\r\n      completed: '已完成',\r\n      failed: '失败'\r\n    }\r\n    return statusMap[status] || '未知'\r\n  }\r\n\r\n  /**\r\n   * 获取任务状态颜色\r\n   */\r\n  const getTaskStatusColor = (status: ReportTask['status']) => {\r\n    const colorMap = {\r\n      pending: 'orange',\r\n      processing: 'blue',\r\n      completed: 'green',\r\n      failed: 'red'\r\n    }\r\n    return colorMap[status] || 'default'\r\n  }\r\n\r\n  /**\r\n   * 格式化文件大小\r\n   */\r\n  const formatFileSize = (bytes?: number) => {\r\n    if (!bytes) return '-'\r\n    const sizes = ['B', 'KB', 'MB', 'GB']\r\n    const i = Math.floor(Math.log(bytes) / Math.log(1024))\r\n    return `${(bytes / Math.pow(1024, i)).toFixed(1)} ${sizes[i]}`\r\n  }\r\n\r\n  /**\r\n   * 渲染报表配置表单\r\n   */\r\n  const renderConfigForm = () => (\r\n    <Card title=\"报表配置\" className={styles.configCard}>\r\n      <Form\r\n        form={form}\r\n        layout=\"vertical\"\r\n        initialValues={{\r\n          format: 'excel',\r\n          includeCharts: true,\r\n          includeSummary: true\r\n        }}\r\n      >\r\n        <Row gutter={16}>\r\n          <Col span={12}>\r\n            <Form.Item\r\n              label=\"报表类型\"\r\n              field=\"reportType\"\r\n              rules={[{ required: true, message: '请选择报表类型' }]}\r\n            >\r\n              <Select placeholder=\"请选择报表类型\">\r\n                {REPORT_TYPES.map(type => (\r\n                  <Option key={type.value} value={type.value}>\r\n                    <div>\r\n                      <div>{type.label}</div>\r\n                      <Text type=\"secondary\" style={{ fontSize: 12 }}>\r\n                        {type.description}\r\n                      </Text>\r\n                    </div>\r\n                  </Option>\r\n                ))}\r\n              </Select>\r\n            </Form.Item>\r\n          </Col>\r\n          \r\n          <Col span={12}>\r\n            <Form.Item label=\"导出格式\" field=\"format\">\r\n              <Radio.Group>\r\n                <Radio value=\"excel\">Excel (.xlsx)</Radio>\r\n                <Radio value=\"pdf\">PDF (.pdf)</Radio>\r\n              </Radio.Group>\r\n            </Form.Item>\r\n          </Col>\r\n        </Row>\r\n\r\n        <Row gutter={16}>\r\n          <Col span={12}>\r\n            <Form.Item label=\"报表选项\">\r\n              <Space direction=\"vertical\">\r\n                <Form.Item field=\"includeCharts\" noStyle>\r\n                  <Checkbox defaultChecked>包含图表</Checkbox>\r\n                </Form.Item>\r\n                <Form.Item field=\"includeSummary\" noStyle>\r\n                  <Checkbox defaultChecked>包含汇总统计</Checkbox>\r\n                </Form.Item>\r\n              </Space>\r\n            </Form.Item>\r\n          </Col>\r\n        </Row>\r\n\r\n        <Divider />\r\n\r\n        <div className={styles.actionButtons}>\r\n          <Space>\r\n            <Button\r\n              type=\"primary\"\r\n              icon={<IconDownload />}\r\n              onClick={handleGenerateReport}\r\n              loading={loading}\r\n            >\r\n              生成报表\r\n            </Button>\r\n            <Button\r\n              icon={<IconEye />}\r\n              onClick={handlePreviewReport}\r\n              loading={loading}\r\n            >\r\n              预览报表\r\n            </Button>\r\n            <Button\r\n              icon={<IconRefresh />}\r\n              onClick={() => setTaskListVisible(true)}\r\n            >\r\n              查看任务\r\n            </Button>\r\n          </Space>\r\n        </div>\r\n      </Form>\r\n    </Card>\r\n  )\r\n\r\n  /**\r\n   * 渲染任务列表\r\n   */\r\n  const renderTaskList = () => (\r\n    <Card \r\n      title=\"报表任务\" \r\n      className={styles.taskListCard}\r\n      extra={\r\n        <Button\r\n          type=\"text\"\r\n          icon={<IconRefresh />}\r\n          onClick={handleRefreshTasks}\r\n          loading={loading}\r\n        >\r\n          刷新\r\n        </Button>\r\n      }\r\n    >\r\n      {tasks.length === 0 ? (\r\n        <Empty description=\"暂无报表任务\" />\r\n      ) : (\r\n        <List\r\n          className={styles.taskList}\r\n          dataSource={tasks}\r\n          renderItem={(task) => (\r\n            <List.Item\r\n              key={task.taskId}\r\n              className={styles.taskItem}\r\n              actions={[\r\n                task.status === 'completed' && (\r\n                  <Tooltip title=\"下载报表\">\r\n                    <Button\r\n                      type=\"text\"\r\n                      icon={<IconDownload />}\r\n                      onClick={() => handleDownloadReport(task.taskId)}\r\n                    />\r\n                  </Tooltip>\r\n                ),\r\n                task.status === 'completed' && (\r\n                  <Tooltip title=\"分享报表\">\r\n                    <Button\r\n                      type=\"text\"\r\n                      icon={<IconExport />}\r\n                      onClick={() => handleShareReport(task)}\r\n                    />\r\n                  </Tooltip>\r\n                ),\r\n                <Tooltip title=\"删除任务\">\r\n                  <Button\r\n                    type=\"text\"\r\n                    icon={<IconDelete />}\r\n                    onClick={() => handleDeleteTask(task.taskId)}\r\n                    status=\"danger\"\r\n                  />\r\n                </Tooltip>\r\n              ].filter(Boolean)}\r\n            >\r\n              <List.Item.Meta\r\n                avatar={getTaskStatusIcon(task.status)}\r\n                title={\r\n                  <Space>\r\n                    <Text>{REPORT_TYPES.find(t => t.value === task.reportType)?.label}</Text>\r\n                    <Tag color={getTaskStatusColor(task.status)} size=\"small\">\r\n                      {getTaskStatusText(task.status)}\r\n                    </Tag>\r\n                  </Space>\r\n                }\r\n                description={\r\n                  <div className={styles.taskMeta}>\r\n                    <Text type=\"secondary\">\r\n                      创建时间: {new Date(task.createdAt).toLocaleString('zh-CN')}\r\n                    </Text>\r\n                    {task.fileName && (\r\n                      <Text type=\"secondary\">\r\n                        文件: {task.fileName} ({formatFileSize(task.fileSize)})\r\n                      </Text>\r\n                    )}\r\n                    {task.status === 'processing' && (\r\n                      <Progress\r\n                        percent={task.progress}\r\n                        size=\"small\"\r\n                        className={styles.taskProgress}\r\n                      />\r\n                    )}\r\n                    {task.status === 'failed' && task.errorMessage && (\r\n                      <Text type=\"danger\">\r\n                        错误: {task.errorMessage}\r\n                      </Text>\r\n                    )}\r\n                  </div>\r\n                }\r\n              />\r\n            </List.Item>\r\n          )}\r\n        />\r\n      )}\r\n    </Card>\r\n  )\r\n\r\n  return (\r\n    <div className={styles.reportGenerator}>\r\n      {/* 错误提示 */}\r\n      {error && (\r\n        <Alert\r\n          type=\"error\"\r\n          message=\"操作失败\"\r\n          description={error.message}\r\n          closable\r\n          className={styles.errorAlert}\r\n        />\r\n      )}\r\n\r\n      {/* 数据筛选 */}\r\n      <ReportFilters\r\n        filters={filters}\r\n        options={filterOptions}\r\n        onFiltersChange={setFilters}\r\n        onReset={() => setFilters({})}\r\n        loading={loading}\r\n      />\r\n\r\n      {/* 报表配置 */}\r\n      {renderConfigForm()}\r\n\r\n      {/* 任务列表 */}\r\n      {taskListVisible && renderTaskList()}\r\n\r\n      {/* 报表预览模态框 */}\r\n      <Modal\r\n        title=\"报表预览\"\r\n        visible={previewVisible}\r\n        onCancel={() => setPreviewVisible(false)}\r\n        width=\"90%\"\r\n        style={{ maxWidth: 1200 }}\r\n        footer={null}\r\n      >\r\n        <ReportPreview\r\n          config={{\r\n            reportType: form.getFieldValue('reportType'),\r\n            filters,\r\n            format: form.getFieldValue('format') || 'excel',\r\n            includeCharts: form.getFieldValue('includeCharts') !== false,\r\n            includeSummary: form.getFieldValue('includeSummary') !== false\r\n          }}\r\n          onClose={() => setPreviewVisible(false)}\r\n        />\r\n      </Modal>\r\n\r\n      {/* 报表分享模态框 */}\r\n      <Modal\r\n        title=\"分享报表\"\r\n        visible={shareVisible}\r\n        onCancel={() => setShareVisible(false)}\r\n        footer={null}\r\n      >\r\n        {selectedTask && (\r\n          <ReportShare\r\n            task={selectedTask}\r\n            onClose={() => setShareVisible(false)}\r\n          />\r\n        )}\r\n      </Modal>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ReportGenerator",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\analytics\\ReportPreview.tsx",
        "messages": [
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'onClose' is defined but never used.",
            "line": 49,
            "column": 3,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 49,
            "endColumn": 10
          },
          {
            "ruleId": "react-hooks/exhaustive-deps",
            "severity": 1,
            "message": "React Hook useEffect has a missing dependency: 'loadPreviewData'. Either include it or remove the dependency array.",
            "line": 61,
            "column": 6,
            "nodeType": "ArrayExpression",
            "endLine": 61,
            "endColumn": 14,
            "suggestions": [
              {
                "desc": "Update the dependencies array to be: [config, loadPreviewData]",
                "fix": {
                  "range": [
                    1258,
                    1266
                  ],
                  "text": "[config, loadPreviewData]"
                }
              }
            ]
          },
          {
            "ruleId": "react-hooks/rules-of-hooks",
            "severity": 2,
            "message": "React Hook \"React.useRef\" is called in function \"renderChart\" that is neither a React function component nor a custom React Hook function. React component names must start with an uppercase letter. React Hook names must start with the word \"use\".",
            "line": 84,
            "column": 22,
            "nodeType": "MemberExpression",
            "endLine": 84,
            "endColumn": 34
          },
          {
            "ruleId": "react-hooks/rules-of-hooks",
            "severity": 2,
            "message": "React Hook \"React.useEffect\" is called in function \"renderChart\" that is neither a React function component nor a custom React Hook function. React component names must start with an uppercase letter. React Hook names must start with the word \"use\".",
            "line": 86,
            "column": 5,
            "nodeType": "MemberExpression",
            "endLine": 86,
            "endColumn": 20
          }
        ],
        "suppressedMessages": [],
        "errorCount": 3,
        "fatalErrorCount": 0,
        "warningCount": 1,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 报表预览组件\r\n */\r\nimport React, { useState, useEffect } from 'react'\r\nimport {\r\n  Card,\r\n  Grid,\r\n  Typography,\r\n  Spin,\r\n  Alert,\r\n  Button,\r\n  Space,\r\n  Tabs,\r\n  Table,\r\n  Statistic,\r\n  Empty,\r\n  Divider\r\n} from '@arco-design/web-react'\r\nimport {\r\n  IconDownload,\r\n  IconExport,\r\n  IconRefresh,\r\n  IconEye,\r\n  IconDashboard,\r\n  IconFile\r\n} from '@arco-design/web-react/icon'\r\nimport * as echarts from 'echarts'\r\nimport { useReportService } from '../../api/reportService'\r\nimport type { ReportConfig, ReportPreviewData } from '../../api/reportService'\r\nimport styles from './ReportPreview.module.css'\r\n\r\nconst { Row, Col } = Grid\r\nconst { Title, Text } = Typography\r\nconst { TabPane } = Tabs\r\n\r\n// 组件属性\r\nexport interface ReportPreviewProps {\r\n  config: ReportConfig\r\n  onClose?: () => void\r\n  onDownload?: () => void\r\n  onShare?: () => void\r\n}\r\n\r\n/**\r\n * 报表预览组件\r\n */\r\nconst ReportPreview: React.FC<ReportPreviewProps> = ({\r\n  config,\r\n  onClose,\r\n  onDownload,\r\n  onShare\r\n}) => {\r\n  const [previewData, setPreviewData] = useState<ReportPreviewData | null>(null)\r\n  const [activeTab, setActiveTab] = useState('summary')\r\n\r\n  const { loading, error, getReportPreview } = useReportService()\r\n\r\n  // 加载预览数据\r\n  useEffect(() => {\r\n    loadPreviewData()\r\n  }, [config])\r\n\r\n  /**\r\n   * 加载预览数据\r\n   */\r\n  const loadPreviewData = async () => {\r\n    const data = await getReportPreview(config)\r\n    if (data) {\r\n      setPreviewData(data)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 刷新预览数据\r\n   */\r\n  const handleRefresh = () => {\r\n    loadPreviewData()\r\n  }\r\n\r\n  /**\r\n   * 渲染图表\r\n   */\r\n  const renderChart = (chartConfig: any) => {\r\n    const chartRef = React.useRef<HTMLDivElement>(null)\r\n\r\n    React.useEffect(() => {\r\n      if (!chartRef.current || !chartConfig.data) return\r\n\r\n      const chart = echarts.init(chartRef.current)\r\n      \r\n      let option: any = {}\r\n\r\n      switch (chartConfig.type) {\r\n        case 'bar':\r\n          option = {\r\n            title: {\r\n              text: chartConfig.title,\r\n              left: 'center',\r\n              textStyle: {\r\n                fontSize: 14,\r\n                fontWeight: 'normal'\r\n              }\r\n            },\r\n            tooltip: {\r\n              trigger: 'axis',\r\n              axisPointer: {\r\n                type: 'shadow'\r\n              }\r\n            },\r\n            legend: {\r\n              top: 30,\r\n              data: chartConfig.data.series?.map((s: any) => s.name) || []\r\n            },\r\n            grid: {\r\n              left: '3%',\r\n              right: '4%',\r\n              bottom: '3%',\r\n              top: '15%',\r\n              containLabel: true\r\n            },\r\n            xAxis: {\r\n              type: 'category',\r\n              data: chartConfig.data.categories || []\r\n            },\r\n            yAxis: {\r\n              type: 'value'\r\n            },\r\n            series: chartConfig.data.series?.map((s: any) => ({\r\n              ...s,\r\n              type: 'bar',\r\n              barWidth: '60%'\r\n            })) || []\r\n          }\r\n          break\r\n\r\n        case 'pie':\r\n          option = {\r\n            title: {\r\n              text: chartConfig.title,\r\n              left: 'center',\r\n              textStyle: {\r\n                fontSize: 14,\r\n                fontWeight: 'normal'\r\n              }\r\n            },\r\n            tooltip: {\r\n              trigger: 'item',\r\n              formatter: '{a} <br/>{b}: {c} ({d}%)'\r\n            },\r\n            legend: {\r\n              top: 30,\r\n              data: chartConfig.data.map((item: any) => item.name)\r\n            },\r\n            series: [\r\n              {\r\n                name: chartConfig.title,\r\n                type: 'pie',\r\n                radius: ['40%', '70%'],\r\n                center: ['50%', '60%'],\r\n                avoidLabelOverlap: false,\r\n                label: {\r\n                  show: false,\r\n                  position: 'center'\r\n                },\r\n                emphasis: {\r\n                  label: {\r\n                    show: true,\r\n                    fontSize: '18',\r\n                    fontWeight: 'bold'\r\n                  }\r\n                },\r\n                labelLine: {\r\n                  show: false\r\n                },\r\n                data: chartConfig.data\r\n              }\r\n            ]\r\n          }\r\n          break\r\n\r\n        case 'line':\r\n          option = {\r\n            title: {\r\n              text: chartConfig.title,\r\n              left: 'center',\r\n              textStyle: {\r\n                fontSize: 14,\r\n                fontWeight: 'normal'\r\n              }\r\n            },\r\n            tooltip: {\r\n              trigger: 'axis'\r\n            },\r\n            legend: {\r\n              top: 30,\r\n              data: chartConfig.data.series?.map((s: any) => s.name) || []\r\n            },\r\n            grid: {\r\n              left: '3%',\r\n              right: '4%',\r\n              bottom: '3%',\r\n              top: '15%',\r\n              containLabel: true\r\n            },\r\n            xAxis: {\r\n              type: 'category',\r\n              boundaryGap: false,\r\n              data: chartConfig.data.categories || []\r\n            },\r\n            yAxis: {\r\n              type: 'value'\r\n            },\r\n            series: chartConfig.data.series?.map((s: any) => ({\r\n              ...s,\r\n              type: 'line',\r\n              smooth: true\r\n            })) || []\r\n          }\r\n          break\r\n\r\n        case 'funnel':\r\n          option = {\r\n            title: {\r\n              text: chartConfig.title,\r\n              left: 'center',\r\n              textStyle: {\r\n                fontSize: 14,\r\n                fontWeight: 'normal'\r\n              }\r\n            },\r\n            tooltip: {\r\n              trigger: 'item',\r\n              formatter: '{a} <br/>{b}: {c}'\r\n            },\r\n            series: [\r\n              {\r\n                name: chartConfig.title,\r\n                type: 'funnel',\r\n                left: '10%',\r\n                top: '15%',\r\n                width: '80%',\r\n                height: '70%',\r\n                minSize: '0%',\r\n                maxSize: '100%',\r\n                sort: 'descending',\r\n                gap: 2,\r\n                label: {\r\n                  show: true,\r\n                  position: 'inside'\r\n                },\r\n                labelLine: {\r\n                  length: 10,\r\n                  lineStyle: {\r\n                    width: 1,\r\n                    type: 'solid'\r\n                  }\r\n                },\r\n                itemStyle: {\r\n                  borderColor: '#fff',\r\n                  borderWidth: 1\r\n                },\r\n                emphasis: {\r\n                  label: {\r\n                    fontSize: 20\r\n                  }\r\n                },\r\n                data: chartConfig.data\r\n              }\r\n            ]\r\n          }\r\n          break\r\n      }\r\n\r\n      chart.setOption(option)\r\n\r\n      // 响应式调整\r\n      const handleResize = () => {\r\n        chart.resize()\r\n      }\r\n      window.addEventListener('resize', handleResize)\r\n\r\n      return () => {\r\n        window.removeEventListener('resize', handleResize)\r\n        chart.dispose()\r\n      }\r\n    }, [chartConfig])\r\n\r\n    return (\r\n      <div\r\n        ref={chartRef}\r\n        className={styles.chartContainer}\r\n        style={{ width: '100%', height: '300px' }}\r\n      />\r\n    )\r\n  }\r\n\r\n  /**\r\n   * 渲染汇总信息\r\n   */\r\n  const renderSummary = () => {\r\n    if (!previewData) return null\r\n\r\n    return (\r\n      <div className={styles.summarySection}>\r\n        <Row gutter={16} className={styles.summaryStats}>\r\n          <Col span={8}>\r\n            <Card className={styles.statCard}>\r\n              <Statistic\r\n                title=\"数据记录数\"\r\n                value={previewData.summary.totalRecords}\r\n                suffix=\"条\"\r\n                countUp\r\n              />\r\n            </Card>\r\n          </Col>\r\n          <Col span={8}>\r\n            <Card className={styles.statCard}>\r\n              <Statistic\r\n                title=\"数据范围\"\r\n                value={previewData.summary.dateRange}\r\n                valueStyle={{ fontSize: 16 }}\r\n              />\r\n            </Card>\r\n          </Col>\r\n          <Col span={8}>\r\n            <Card className={styles.statCard}>\r\n              <Statistic\r\n                title=\"生成时间\"\r\n                value={previewData.summary.generatedAt}\r\n                valueStyle={{ fontSize: 16 }}\r\n              />\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n\r\n        <Divider />\r\n\r\n        <div className={styles.reportInfo}>\r\n          <Title heading={4}>报表信息</Title>\r\n          <Space direction=\"vertical\" size=\"small\">\r\n            <Text>\r\n              <strong>报表类型:</strong> {previewData.title}\r\n            </Text>\r\n            <Text>\r\n              <strong>导出格式:</strong> {config.format.toUpperCase()}\r\n            </Text>\r\n            <Text>\r\n              <strong>包含图表:</strong> {config.includeCharts ? '是' : '否'}\r\n            </Text>\r\n            <Text>\r\n              <strong>包含汇总:</strong> {config.includeSummary ? '是' : '否'}\r\n            </Text>\r\n          </Space>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  /**\r\n   * 渲染图表标签页\r\n   */\r\n  const renderCharts = () => {\r\n    if (!previewData?.charts || previewData.charts.length === 0) {\r\n      return (\r\n        <Empty\r\n          description=\"暂无图表数据\"\r\n          image={<IconDashboard style={{ fontSize: 48, color: '#ccc' }} />}\r\n        />\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div className={styles.chartsSection}>\r\n        <Row gutter={16}>\r\n          {previewData.charts.map((chart, index) => (\r\n            <Col span={12} key={index}>\r\n              <Card className={styles.chartCard}>\r\n                {renderChart(chart)}\r\n              </Card>\r\n            </Col>\r\n          ))}\r\n        </Row>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  /**\r\n   * 渲染数据表格标签页\r\n   */\r\n  const renderTables = () => {\r\n    if (!previewData?.tables || previewData.tables.length === 0) {\r\n      return (\r\n        <Empty\r\n          description=\"暂无表格数据\"\r\n          image={<IconFile style={{ fontSize: 48, color: '#ccc' }} />}\r\n        />\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div className={styles.tablesSection}>\r\n        {previewData.tables.map((table, index) => (\r\n          <Card key={index} title={table.title} className={styles.tableCard}>\r\n            <Table\r\n              columns={table.headers.map((header, idx) => ({\r\n                title: header,\r\n                dataIndex: idx.toString(),\r\n                key: idx.toString(),\r\n                width: 150\r\n              }))}\r\n              data={table.rows.map((row, rowIdx) => {\r\n                const rowData: Record<string, any> = { key: rowIdx }\r\n                row.forEach((cell, cellIdx) => {\r\n                  rowData[cellIdx.toString()] = cell\r\n                })\r\n                return rowData\r\n              })}\r\n              pagination={{\r\n                pageSize: 10,\r\n                showTotal: (total) => `共 ${table.totalRows} 条记录，当前显示 ${Math.min(total, 10)} 条`\r\n              }}\r\n              scroll={{ x: table.headers.length * 150 }}\r\n              size=\"small\"\r\n            />\r\n          </Card>\r\n        ))}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <Alert\r\n        type=\"error\"\r\n        title=\"预览失败\"\r\n        description={error.message}\r\n        showIcon\r\n        action={\r\n          <Button size=\"small\" onClick={handleRefresh}>\r\n            重试\r\n          </Button>\r\n        }\r\n      />\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className={styles.reportPreview}>\r\n      {/* 预览头部 */}\r\n      <div className={styles.previewHeader}>\r\n        <div className={styles.headerLeft}>\r\n          <Title heading={4} style={{ margin: 0 }}>\r\n            {previewData?.title || '报表预览'}\r\n          </Title>\r\n        </div>\r\n        \r\n        <div className={styles.headerRight}>\r\n          <Space>\r\n            <Button\r\n              icon={<IconRefresh />}\r\n              onClick={handleRefresh}\r\n              loading={loading}\r\n            >\r\n              刷新\r\n            </Button>\r\n            {onDownload && (\r\n              <Button\r\n                type=\"primary\"\r\n                icon={<IconDownload />}\r\n                onClick={onDownload}\r\n              >\r\n                下载报表\r\n              </Button>\r\n            )}\r\n            {onShare && (\r\n              <Button\r\n                icon={<IconExport />}\r\n                onClick={onShare}\r\n              >\r\n                分享报表\r\n              </Button>\r\n            )}\r\n          </Space>\r\n        </div>\r\n      </div>\r\n\r\n      {/* 预览内容 */}\r\n      <div className={styles.previewContent}>\r\n        <Spin loading={loading}>\r\n          {previewData ? (\r\n            <Tabs\r\n              activeTab={activeTab}\r\n              onChange={setActiveTab}\r\n              className={styles.previewTabs}\r\n            >\r\n              <TabPane key=\"summary\" title=\"汇总信息\" icon={<IconEye />}>\r\n                {renderSummary()}\r\n              </TabPane>\r\n              \r\n              {config.includeCharts && (\r\n                <TabPane key=\"charts\" title=\"图表分析\" icon={<IconDashboard />}>\r\n                  {renderCharts()}\r\n                </TabPane>\r\n              )}\r\n              \r\n              <TabPane key=\"tables\" title=\"数据详情\" icon={<IconFile />}>\r\n                {renderTables()}\r\n              </TabPane>\r\n            </Tabs>\r\n          ) : (\r\n            <Empty description=\"暂无预览数据\" />\r\n          )}\r\n        </Spin>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ReportPreview",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\analytics\\ReportShare.tsx",
        "messages": [
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'Tooltip' is defined but never used.",
            "line": 19,
            "column": 3,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 19,
            "endColumn": 10
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'TextArea' is assigned a value but never used.",
            "line": 41,
            "column": 9,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 41,
            "endColumn": 17
          }
        ],
        "suppressedMessages": [],
        "errorCount": 2,
        "fatalErrorCount": 0,
        "warningCount": 0,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "/**\r\n * 报表分享组件\r\n */\r\nimport React, { useState } from 'react'\r\nimport {\r\n  Form,\r\n  Grid,\r\n  Input,\r\n  Select,\r\n  DatePicker,\r\n  Switch,\r\n  Button,\r\n  Space,\r\n  Typography,\r\n  Alert,\r\n  Card,\r\n  Divider,\r\n  Tag,\r\n  Tooltip,\r\n  Message,\r\n  Modal\r\n} from '@arco-design/web-react'\r\nimport {\r\n  IconExport,\r\n  IconCopy,\r\n  IconEmail,\r\n  IconLink,\r\n  IconLock,\r\n  IconUnlock,\r\n  IconCalendar,\r\n  IconUser,\r\n  IconCheck\r\n} from '@arco-design/web-react/icon'\r\nimport { useReportService } from '../../api/reportService'\r\nimport type { ReportTask, ReportShareConfig, ReportShareInfo } from '../../api/reportService'\r\nimport styles from './ReportShare.module.css'\r\n\r\nconst { Row, Col } = Grid\r\nconst { Title, Text } = Typography\r\nconst { Option } = Select\r\nconst { TextArea } = Input\r\n\r\n// 组件属性\r\nexport interface ReportShareProps {\r\n  task: ReportTask\r\n  onClose?: () => void\r\n  onShared?: (shareInfo: ReportShareInfo) => void\r\n}\r\n\r\n/**\r\n * 报表分享组件\r\n */\r\nconst ReportShare: React.FC<ReportShareProps> = ({\r\n  task,\r\n  onClose,\r\n  onShared\r\n}) => {\r\n  const [form] = Form.useForm()\r\n  const [shareInfo, setShareInfo] = useState<ReportShareInfo | null>(null)\r\n  const [shareType, setShareType] = useState<'link' | 'email'>('link')\r\n  const [hasPassword, setHasPassword] = useState(false)\r\n  const [copySuccess, setCopySuccess] = useState(false)\r\n\r\n  const { loading, error, shareReport } = useReportService()\r\n\r\n  /**\r\n   * 处理分享\r\n   */\r\n  const handleShare = async () => {\r\n    try {\r\n      const values = await form.validate()\r\n      \r\n      const config: ReportShareConfig = {\r\n        taskId: task.taskId,\r\n        shareType,\r\n        allowDownload: values.allowDownload !== false,\r\n        expiresAt: values.expiresAt?.toISOString(),\r\n        password: hasPassword ? values.password : undefined,\r\n        recipients: shareType === 'email' ? values.recipients : undefined\r\n      }\r\n\r\n      const result = await shareReport(config)\r\n      if (result) {\r\n        setShareInfo(result)\r\n        onShared?.(result)\r\n        \r\n        if (shareType === 'email') {\r\n          Message.success('邮件分享链接已发送')\r\n        } else {\r\n          Message.success('分享链接已生成')\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('分享失败:', error)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 复制分享链接\r\n   */\r\n  const handleCopyLink = async () => {\r\n    if (!shareInfo?.shareUrl) return\r\n\r\n    try {\r\n      await navigator.clipboard.writeText(shareInfo.shareUrl)\r\n      setCopySuccess(true)\r\n      Message.success('链接已复制到剪贴板')\r\n      \r\n      setTimeout(() => {\r\n        setCopySuccess(false)\r\n      }, 2000)\r\n    } catch (error) {\r\n      Message.error('复制失败，请手动复制')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 重新生成分享链接\r\n   */\r\n  const handleRegenerateLink = () => {\r\n    Modal.confirm({\r\n      title: '重新生成分享链接',\r\n      content: '重新生成后，原有的分享链接将失效。确定要继续吗？',\r\n      onOk: () => {\r\n        setShareInfo(null)\r\n        handleShare()\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 渲染分享配置表单\r\n   */\r\n  const renderShareForm = () => (\r\n    <Form\r\n      form={form}\r\n      layout=\"vertical\"\r\n      initialValues={{\r\n        shareType: 'link',\r\n        allowDownload: true,\r\n        expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 默认7天后过期\r\n      }}\r\n    >\r\n      {/* 分享方式 */}\r\n      <Form.Item label=\"分享方式\" field=\"shareType\">\r\n        <Select\r\n          value={shareType}\r\n          onChange={setShareType}\r\n          className={styles.shareTypeSelect}\r\n        >\r\n          <Option value=\"link\">\r\n            <Space>\r\n              <IconLink />\r\n              <span>生成分享链接</span>\r\n            </Space>\r\n          </Option>\r\n          <Option value=\"email\">\r\n            <Space>\r\n              <IconEmail />\r\n              <span>邮件发送</span>\r\n            </Space>\r\n          </Option>\r\n        </Select>\r\n      </Form.Item>\r\n\r\n      {/* 邮件收件人 */}\r\n      {shareType === 'email' && (\r\n        <Form.Item\r\n          label=\"收件人邮箱\"\r\n          field=\"recipients\"\r\n          rules={[\r\n            { required: true, message: '请输入收件人邮箱' },\r\n            {\r\n              validator: (value, callback) => {\r\n                if (!value || value.length === 0) {\r\n                  callback('请至少输入一个邮箱地址')\r\n                  return\r\n                }\r\n                \r\n                const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\r\n                const invalidEmails = value.filter((email: string) => !emailRegex.test(email))\r\n                \r\n                if (invalidEmails.length > 0) {\r\n                  callback(`邮箱格式不正确: ${invalidEmails.join(', ')}`)\r\n                  return\r\n                }\r\n                \r\n                callback()\r\n              }\r\n            }\r\n          ]}\r\n        >\r\n          <Select\r\n            mode=\"tags\"\r\n            placeholder=\"请输入邮箱地址，按回车添加多个\"\r\n            allowCreate\r\n            tokenSeparators={[',', ';', ' ']}\r\n          />\r\n        </Form.Item>\r\n      )}\r\n\r\n      {/* 过期时间 */}\r\n      <Form.Item label=\"过期时间\" field=\"expiresAt\">\r\n        <DatePicker\r\n          showTime\r\n          placeholder=\"请选择过期时间\"\r\n          disabledDate={(date) => date.isBefore(new Date(), 'day')}\r\n          style={{ width: '100%' }}\r\n        />\r\n      </Form.Item>\r\n\r\n      {/* 访问权限 */}\r\n      <Form.Item label=\"访问权限\">\r\n        <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n          <div className={styles.permissionItem}>\r\n            <Switch\r\n              checked={hasPassword}\r\n              onChange={setHasPassword}\r\n            />\r\n            <Space>\r\n              {hasPassword ? <IconLock /> : <IconUnlock />}\r\n              <Text>设置访问密码</Text>\r\n            </Space>\r\n          </div>\r\n          \r\n          {hasPassword && (\r\n            <Form.Item\r\n              field=\"password\"\r\n              rules={[\r\n                { required: true, message: '请输入访问密码' },\r\n                { minLength: 4, message: '密码至少4位' }\r\n              ]}\r\n              style={{ margin: 0 }}\r\n            >\r\n              <Input.Password\r\n                placeholder=\"请输入访问密码\"\r\n                className={styles.passwordInput}\r\n              />\r\n            </Form.Item>\r\n          )}\r\n          \r\n          <div className={styles.permissionItem}>\r\n            <Form.Item field=\"allowDownload\" noStyle>\r\n              <Switch defaultChecked />\r\n            </Form.Item>\r\n            <Space>\r\n              <IconExport />\r\n              <Text>允许下载报表文件</Text>\r\n            </Space>\r\n          </div>\r\n        </Space>\r\n      </Form.Item>\r\n    </Form>\r\n  )\r\n\r\n  /**\r\n   * 渲染分享结果\r\n   */\r\n  const renderShareResult = () => {\r\n    if (!shareInfo) return null\r\n\r\n    return (\r\n      <Card className={styles.shareResultCard}>\r\n        <div className={styles.shareResultHeader}>\r\n          <Space>\r\n            <IconCheck style={{ color: '#52c41a' }} />\r\n            <Title heading={5} style={{ margin: 0 }}>\r\n              分享链接已生成\r\n            </Title>\r\n          </Space>\r\n        </div>\r\n\r\n        <div className={styles.shareResultContent}>\r\n          <div className={styles.shareUrl}>\r\n            <Input\r\n              value={shareInfo.shareUrl}\r\n              readOnly\r\n              addonAfter={\r\n                <Button\r\n                  type=\"text\"\r\n                  icon={copySuccess ? <IconCheck /> : <IconCopy />}\r\n                  onClick={handleCopyLink}\r\n                  className={copySuccess ? styles.copySuccess : ''}\r\n                >\r\n                  {copySuccess ? '已复制' : '复制'}\r\n                </Button>\r\n              }\r\n            />\r\n          </div>\r\n\r\n          <div className={styles.shareInfo}>\r\n            <Row gutter={16}>\r\n              <Col span={12}>\r\n                <div className={styles.infoItem}>\r\n                  <IconCalendar />\r\n                  <div>\r\n                    <Text type=\"secondary\">过期时间</Text>\r\n                    <div>\r\n                      {new Date(shareInfo.expiresAt).toLocaleString('zh-CN')}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </Col>\r\n              <Col span={12}>\r\n                <div className={styles.infoItem}>\r\n                  <IconUser />\r\n                  <div>\r\n                    <Text type=\"secondary\">访问次数</Text>\r\n                    <div>{shareInfo.accessCount} 次</div>\r\n                  </div>\r\n                </div>\r\n              </Col>\r\n            </Row>\r\n          </div>\r\n\r\n          <div className={styles.shareActions}>\r\n            <Space>\r\n              <Button onClick={handleRegenerateLink}>\r\n                重新生成\r\n              </Button>\r\n              <Button type=\"primary\" onClick={onClose}>\r\n                完成\r\n              </Button>\r\n            </Space>\r\n          </div>\r\n        </div>\r\n      </Card>\r\n    )\r\n  }\r\n\r\n  /**\r\n   * 渲染报表信息\r\n   */\r\n  const renderReportInfo = () => (\r\n    <Card className={styles.reportInfoCard}>\r\n      <div className={styles.reportInfoHeader}>\r\n        <Title heading={5}>报表信息</Title>\r\n      </div>\r\n      \r\n      <div className={styles.reportInfoContent}>\r\n        <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n          <div className={styles.reportInfoItem}>\r\n            <Text type=\"secondary\">报表名称:</Text>\r\n            <Text>{task.fileName || '未知报表'}</Text>\r\n          </div>\r\n          \r\n          <div className={styles.reportInfoItem}>\r\n            <Text type=\"secondary\">文件大小:</Text>\r\n            <Text>{task.fileSize ? `${(task.fileSize / 1024 / 1024).toFixed(2)} MB` : '-'}</Text>\r\n          </div>\r\n          \r\n          <div className={styles.reportInfoItem}>\r\n            <Text type=\"secondary\">生成时间:</Text>\r\n            <Text>{new Date(task.createdAt).toLocaleString('zh-CN')}</Text>\r\n          </div>\r\n          \r\n          <div className={styles.reportInfoItem}>\r\n            <Text type=\"secondary\">状态:</Text>\r\n            <Tag color={task.status === 'completed' ? 'green' : 'orange'}>\r\n              {task.status === 'completed' ? '已完成' : '处理中'}\r\n            </Tag>\r\n          </div>\r\n        </Space>\r\n      </div>\r\n    </Card>\r\n  )\r\n\r\n  return (\r\n    <div className={styles.reportShare}>\r\n      {/* 错误提示 */}\r\n      {error && (\r\n        <Alert\r\n          type=\"error\"\r\n          message=\"分享失败\"\r\n          description={error.message}\r\n          closable\r\n          className={styles.errorAlert}\r\n        />\r\n      )}\r\n\r\n      {/* 报表信息 */}\r\n      {renderReportInfo()}\r\n\r\n      <Divider />\r\n\r\n      {/* 分享配置或结果 */}\r\n      {shareInfo ? renderShareResult() : (\r\n        <div className={styles.shareConfig}>\r\n          <Title heading={5}>分享设置</Title>\r\n          {renderShareForm()}\r\n          \r\n          <div className={styles.shareActions}>\r\n            <Space>\r\n              <Button onClick={onClose}>\r\n                取消\r\n              </Button>\r\n              <Button\r\n                type=\"primary\"\r\n                icon={<IconExport />}\r\n                onClick={handleShare}\r\n                loading={loading}\r\n              >\r\n                {shareType === 'email' ? '发送邮件' : '生成链接'}\r\n              </Button>\r\n            </Space>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* 分享说明 */}\r\n      <Alert\r\n        type=\"info\"\r\n        message=\"分享说明\"\r\n        description={\r\n          <ul className={styles.shareNotice}>\r\n            <li>分享链接默认7天内有效，过期后自动失效</li>\r\n            <li>设置访问密码可以提高分享安全性</li>\r\n            <li>可以随时重新生成分享链接，原链接将失效</li>\r\n            <li>分享的报表文件与原始数据保持一致</li>\r\n          </ul>\r\n        }\r\n        showIcon\r\n        className={styles.shareNoticeAlert}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ReportShare",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      },
      {
        "filePath": "D:\\aaa\\code\\kiro\\mendian\\frontend\\src\\components\\analytics\\SystemMonitoring.tsx",
        "messages": [
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'useEffect' is defined but never used.",
            "line": 1,
            "column": 27,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 1,
            "endColumn": 36
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'Statistic' is defined but never used.",
            "line": 10,
            "column": 3,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 10,
            "endColumn": 12
          },
          {
            "ruleId": "@typescript-eslint/no-unused-vars",
            "severity": 2,
            "message": "'setSystemStatus' is assigned a value but never used.",
            "line": 31,
            "column": 24,
            "nodeType": "Identifier",
            "messageId": "unusedVar",
            "endLine": 31,
            "endColumn": 39
          }
        ],
        "suppressedMessages": [],
        "errorCount": 3,
        "fatalErrorCount": 0,
        "warningCount": 0,
        "fixableErrorCount": 0,
        "fixableWarningCount": 0,
        "source": "import React, { useState, useEffect } from 'react';\r\nimport {\r\n  Card,\r\n  Grid,\r\n  Typography,\r\n  Button,\r\n  Badge,\r\n  Space,\r\n  Progress,\r\n  Statistic,\r\n} from '@arco-design/web-react';\r\nimport {\r\n  IconRefresh,\r\n  IconCheckCircle,\r\n  IconCloseCircle,\r\n  IconExclamationCircle,\r\n} from '@arco-design/web-react/icon';\r\n\r\nconst { Row, Col } = Grid;\r\nconst { Title, Text } = Typography;\r\n\r\ninterface SystemStatus {\r\n  service: string;\r\n  status: 'running' | 'stopped' | 'error';\r\n  uptime: string;\r\n  cpu: number;\r\n  memory: number;\r\n}\r\n\r\nconst SystemMonitoring: React.FC = () => {\r\n  const [systemStatus, setSystemStatus] = useState<SystemStatus[]>([\r\n    { service: '数据库服务', status: 'running', uptime: '15天', cpu: 45, memory: 60 },\r\n    { service: 'API服务', status: 'running', uptime: '15天', cpu: 30, memory: 40 },\r\n    { service: '缓存服务', status: 'running', uptime: '15天', cpu: 10, memory: 20 },\r\n    { service: '消息队列', status: 'running', uptime: '15天', cpu: 15, memory: 25 },\r\n  ]);\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'running':\r\n        return <IconCheckCircle style={{ color: '#00b42a' }} />;\r\n      case 'stopped':\r\n        return <IconCloseCircle style={{ color: '#f53f3f' }} />;\r\n      case 'error':\r\n        return <IconExclamationCircle style={{ color: '#ff7d00' }} />;\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const statusMap = {\r\n      running: { status: 'success' as const, text: '运行中' },\r\n      stopped: { status: 'error' as const, text: '已停止' },\r\n      error: { status: 'warning' as const, text: '异常' },\r\n    };\r\n    return statusMap[status as keyof typeof statusMap] || { status: 'default' as const, text: '未知' };\r\n  };\r\n\r\n  const handleRefresh = () => {\r\n    // 刷新系统状态\r\n    console.log('刷新系统状态');\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <Card\r\n        title=\"系统监控\"\r\n        extra={\r\n          <Button type=\"primary\" icon={<IconRefresh />} onClick={handleRefresh}>\r\n            刷新\r\n          </Button>\r\n        }\r\n      >\r\n        <Row gutter={16}>\r\n          {systemStatus.map((item, index) => (\r\n            <Col span={12} key={index} style={{ marginBottom: 16 }}>\r\n              <Card>\r\n                <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n                  <Space>\r\n                    {getStatusIcon(item.status)}\r\n                    <Title heading={6}>{item.service}</Title>\r\n                    <Badge {...getStatusBadge(item.status)} />\r\n                  </Space>\r\n                  <Text type=\"secondary\">运行时间: {item.uptime}</Text>\r\n                  <div>\r\n                    <Text>CPU使用率</Text>\r\n                    <Progress percent={item.cpu} />\r\n                  </div>\r\n                  <div>\r\n                    <Text>内存使用率</Text>\r\n                    <Progress percent={item.memory} />\r\n                  </div>\r\n                </Space>\r\n              </Card>\r\n            </Col>\r\n          ))}\r\n        </Row>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SystemMonitoring;\r\n",
        "usedDeprecatedRules": [
          {
            "ruleId": "no-extra-semi",
            "replacedBy": []
          },
          {
            "ruleId": "no-mixed-spaces-and-tabs",
            "replacedBy": []
          }
        ]
      }
    ]
  },
  "typescript": {
    "status": "completed",
    "errors": 262,
    "output": "src/api/systemMonitoring.ts(1,27): error TS2307: Cannot find module './client' or its corresponding type declarations.\r\nsrc/App.tsx(1,17): error TS6133: 'useState' is declared but its value is never read.\r\nsrc/App.tsx(1,27): error TS6133: 'useEffect' is declared but its value is never read.\r\nsrc/App.tsx(2,1): error TS6192: All imports in import declaration are unused.\r\nsrc/App.tsx(3,1): error TS6192: All imports in import declaration are unused.\r\nsrc/App.tsx(4,1): error TS6192: All imports in import declaration are unused.\r\nsrc/components/__tests__/MainNavigation.test.tsx(6,18): error TS6133: 'screen' is declared but its value is never read.\r\nsrc/components/analytics/__tests__/ReportGenerator.test.tsx(5,1): error TS6133: 'React' is declared but its value is never read.\r\nsrc/components/analytics/__tests__/ReportGenerator.test.tsx(9,15): error TS2614: Module '\"../../../api/reportService\"' has no exported member 'FilterOptions'. Did you mean to use 'import FilterOptions from \"../../../api/reportService\"' instead?\r\nsrc/components/analytics/__tests__/ReportGenerator.test.tsx(29,13): error TS6198: All destructured elements are unused.\r\nsrc/components/analytics/__tests__/ReportGenerator.test.tsx(35,13): error TS6198: All destructured elements are unused.\r\nsrc/components/analytics/__tests__/ReportGenerator.test.tsx(41,13): error TS6198: All destructured elements are unused.\r\nsrc/components/analytics/__tests__/ReportShare.test.tsx(5,1): error TS6133: 'React' is declared but its value is never read.\r\nsrc/components/analytics/__tests__/StoreMapVisualization.test.tsx(4,1): error TS6133: 'React' is declared but its value is never read.\r\nsrc/components/analytics/__tests__/StoreMapVisualization.test.tsx(11,1): error TS2304: Cannot find name 'vi'.\r\nsrc/components/analytics/__tests__/StoreMapVisualization.test.tsx(17,14): error TS2304: Cannot find name 'vi'.\r\nsrc/components/analytics/__tests__/StoreMapVisualization.test.tsx(22,1): error TS2304: Cannot find name 'vi'.\r\nsrc/components/analytics/__tests__/StoreMapVisualization.test.tsx(27,23): error TS2304: Cannot find name 'vi'.\r\nsrc/components/analytics/__tests__/StoreMapVisualization.test.tsx(30,14): error TS2304: Cannot find name 'vi'.\r\nsrc/components/analytics/DataFilters.tsx(301,10): error TS2741: Property 'name' is missing in type '{ children: Element; header: Element; key: string; showExpandIcon: false; }' but required in type 'CollapseItemProps'.\r\nsrc/components/analytics/FollowUpFunnelChart.tsx(128,7): error TS2322: Type '{ name: string; type: \"funnel\"; left: string; top: string; width: string; height: string; min: number; max: number; minSize: string; maxSize: string; sort: \"descending\"; gap: number; label: { show: boolean; ... 4 more ...; fontWeight: number; }; labelLine: { ...; }; itemStyle: { ...; }; emphasis: { ...; }; data: { ....' is not assignable to type 'SeriesOption | SeriesOption[] | undefined'.\r\n  Type '{ name: string; type: \"funnel\"; left: string; top: string; width: string; height: string; min: number; max: number; minSize: string; maxSize: string; sort: \"descending\"; gap: number; label: { show: boolean; ... 4 more ...; fontWeight: number; }; labelLine: { ...; }; itemStyle: { ...; }; emphasis: { ...; }; data: { ....' is not assignable to type 'MapSeriesOption$1 | TreeSeriesOption$1 | LineSeriesOption$1 | BarSeriesOption | ScatterSeriesOption$1 | ... 18 more ... | SeriesOption[]'.\r\n    Type '{ name: string; type: \"funnel\"; left: string; top: string; width: string; height: string; min: number; max: number; minSize: string; maxSize: string; sort: \"descending\"; gap: number; label: { show: boolean; ... 4 more ...; fontWeight: number; }; labelLine: { ...; }; itemStyle: { ...; }; emphasis: { ...; }; data: { ....' is not assignable to type 'SeriesOption'.\r\n      Types of property 'label' are incompatible.\r\n        Type '{ show: boolean; position: string; formatter: (params: any) => string; fontSize: number; color: string; fontWeight: number; }' is not assignable to type 'FunnelLabelOption'.\r\n          Type '{ show: boolean; position: string; formatter: (params: any) => string; fontSize: number; color: string; fontWeight: number; }' is not assignable to type '{ position?: \"center\" | (string | number)[] | BuiltinTextPosition | \"outer\" | \"inner\" | \"rightTop\" | \"rightBottom\" | \"leftTop\" | \"leftBottom\" | undefined; }'.\r\n            Types of property 'position' are incompatible.\r\n              Type 'string' is not assignable to type '\"center\" | (string | number)[] | BuiltinTextPosition | \"outer\" | \"inner\" | \"rightTop\" | \"rightBottom\" | \"leftTop\" | \"leftBottom\" | undefined'.\r\nsrc/components/analytics/FollowUpFunnelChart.tsx(216,22): error TS2304: Cannot find name 'IconWarning'.\r\nsrc/components/analytics/index.ts(8,10): error TS1448: 'DataFiltersComponent' resolves to a type-only declaration and must be re-exported using a type-only re-export when 'isolatedModules' is enabled.\r\nsrc/components/analytics/MobileFunnelChart.tsx(66,41): error TS6133: 'total' is declared bu",
    "errorSummary": [
      "src/api/systemMonitoring.ts(1,27): error TS2307: Cannot find module './client' or its corresponding type declarations.\r",
      "src/App.tsx(1,17): error TS6133: 'useState' is declared but its value is never read.\r",
      "src/App.tsx(1,27): error TS6133: 'useEffect' is declared but its value is never read.\r",
      "src/App.tsx(2,1): error TS6192: All imports in import declaration are unused.\r",
      "src/App.tsx(3,1): error TS6192: All imports in import declaration are unused.\r",
      "src/App.tsx(4,1): error TS6192: All imports in import declaration are unused.\r",
      "src/components/__tests__/MainNavigation.test.tsx(6,18): error TS6133: 'screen' is declared but its value is never read.\r",
      "src/components/analytics/__tests__/ReportGenerator.test.tsx(5,1): error TS6133: 'React' is declared but its value is never read.\r",
      "src/components/analytics/__tests__/ReportGenerator.test.tsx(9,15): error TS2614: Module '\"../../../api/reportService\"' has no exported member 'FilterOptions'. Did you mean to use 'import FilterOptions from \"../../../api/reportService\"' instead?\r",
      "src/components/analytics/__tests__/ReportGenerator.test.tsx(29,13): error TS6198: All destructured elements are unused.\r",
      "src/components/analytics/__tests__/ReportGenerator.test.tsx(35,13): error TS6198: All destructured elements are unused.\r",
      "src/components/analytics/__tests__/ReportGenerator.test.tsx(41,13): error TS6198: All destructured elements are unused.\r",
      "src/components/analytics/__tests__/ReportShare.test.tsx(5,1): error TS6133: 'React' is declared but its value is never read.\r",
      "src/components/analytics/__tests__/StoreMapVisualization.test.tsx(4,1): error TS6133: 'React' is declared but its value is never read.\r",
      "src/components/analytics/__tests__/StoreMapVisualization.test.tsx(11,1): error TS2304: Cannot find name 'vi'.\r",
      "src/components/analytics/__tests__/StoreMapVisualization.test.tsx(17,14): error TS2304: Cannot find name 'vi'.\r",
      "src/components/analytics/__tests__/StoreMapVisualization.test.tsx(22,1): error TS2304: Cannot find name 'vi'.\r",
      "src/components/analytics/__tests__/StoreMapVisualization.test.tsx(27,23): error TS2304: Cannot find name 'vi'.\r",
      "src/components/analytics/__tests__/StoreMapVisualization.test.tsx(30,14): error TS2304: Cannot find name 'vi'.\r",
      "src/components/analytics/DataFilters.tsx(301,10): error TS2741: Property 'name' is missing in type '{ children: Element; header: Element; key: string; showExpandIcon: false; }' but required in type 'CollapseItemProps'.\r"
    ]
  },
  "unusedExports": {
    "status": "completed",
    "issues": 259,
    "details": [
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'useState' is defined but never used.",
        "line": 1,
        "column": 17,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 1,
        "endColumn": 25
      },
      {
        "ruleId": "@typescript-eslint/no-unused-vars",
        "severity": 2,
        "message": "'useState' is defined but never used.",
        "line": 1,
        "column": 17,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 1,
        "endColumn": 25
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'useEffect' is defined but never used.",
        "line": 1,
        "column": 27,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 1,
        "endColumn": 36
      },
      {
        "ruleId": "@typescript-eslint/no-unused-vars",
        "severity": 2,
        "message": "'useEffect' is defined but never used.",
        "line": 1,
        "column": 27,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 1,
        "endColumn": 36
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'useLocation' is defined but never used.",
        "line": 2,
        "column": 10,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 2,
        "endColumn": 21
      },
      {
        "ruleId": "@typescript-eslint/no-unused-vars",
        "severity": 2,
        "message": "'useLocation' is defined but never used.",
        "line": 2,
        "column": 10,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 2,
        "endColumn": 21
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'useNavigate' is defined but never used.",
        "line": 2,
        "column": 23,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 2,
        "endColumn": 34
      },
      {
        "ruleId": "@typescript-eslint/no-unused-vars",
        "severity": 2,
        "message": "'useNavigate' is defined but never used.",
        "line": 2,
        "column": 23,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 2,
        "endColumn": 34
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'Layout' is defined but never used.",
        "line": 3,
        "column": 10,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 3,
        "endColumn": 16
      },
      {
        "ruleId": "@typescript-eslint/no-unused-vars",
        "severity": 2,
        "message": "'Layout' is defined but never used.",
        "line": 3,
        "column": 10,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 3,
        "endColumn": 16
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'Dropdown' is defined but never used.",
        "line": 3,
        "column": 18,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 3,
        "endColumn": 26
      },
      {
        "ruleId": "@typescript-eslint/no-unused-vars",
        "severity": 2,
        "message": "'Dropdown' is defined but never used.",
        "line": 3,
        "column": 18,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 3,
        "endColumn": 26
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'Menu' is defined but never used.",
        "line": 3,
        "column": 28,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 3,
        "endColumn": 32
      },
      {
        "ruleId": "@typescript-eslint/no-unused-vars",
        "severity": 2,
        "message": "'Menu' is defined but never used.",
        "line": 3,
        "column": 28,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 3,
        "endColumn": 32
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'Avatar' is defined but never used.",
        "line": 3,
        "column": 34,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 3,
        "endColumn": 40
      },
      {
        "ruleId": "@typescript-eslint/no-unused-vars",
        "severity": 2,
        "message": "'Avatar' is defined but never used.",
        "line": 3,
        "column": 34,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 3,
        "endColumn": 40
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'Space' is defined but never used.",
        "line": 3,
        "column": 42,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 3,
        "endColumn": 47
      },
      {
        "ruleId": "@typescript-eslint/no-unused-vars",
        "severity": 2,
        "message": "'Space' is defined but never used.",
        "line": 3,
        "column": 42,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 3,
        "endColumn": 47
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'Badge' is defined but never used.",
        "line": 3,
        "column": 49,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 3,
        "endColumn": 54
      },
      {
        "ruleId": "@typescript-eslint/no-unused-vars",
        "severity": 2,
        "message": "'Badge' is defined but never used.",
        "line": 3,
        "column": 49,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 3,
        "endColumn": 54
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'IconUser' is defined but never used.",
        "line": 4,
        "column": 10,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 4,
        "endColumn": 18
      },
      {
        "ruleId": "@typescript-eslint/no-unused-vars",
        "severity": 2,
        "message": "'IconUser' is defined but never used.",
        "line": 4,
        "column": 10,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 4,
        "endColumn": 18
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'IconPoweroff' is defined but never used.",
        "line": 4,
        "column": 20,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 4,
        "endColumn": 32
      },
      {
        "ruleId": "@typescript-eslint/no-unused-vars",
        "severity": 2,
        "message": "'IconPoweroff' is defined but never used.",
        "line": 4,
        "column": 20,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 4,
        "endColumn": 32
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'IconSettings' is defined but never used.",
        "line": 4,
        "column": 34,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 4,
        "endColumn": 46
      },
      {
        "ruleId": "@typescript-eslint/no-unused-vars",
        "severity": 2,
        "message": "'IconSettings' is defined but never used.",
        "line": 4,
        "column": 34,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 4,
        "endColumn": 46
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'IconNotification' is defined but never used.",
        "line": 4,
        "column": 48,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 4,
        "endColumn": 64
      },
      {
        "ruleId": "@typescript-eslint/no-unused-vars",
        "severity": 2,
        "message": "'IconNotification' is defined but never used.",
        "line": 4,
        "column": 48,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 4,
        "endColumn": 64
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'data' is defined but never used.",
        "line": 312,
        "column": 16,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 312,
        "endColumn": 25
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'error' is defined but never used.",
        "line": 313,
        "column": 14,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 313,
        "endColumn": 24
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'data' is defined but never used.",
        "line": 158,
        "column": 16,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 158,
        "endColumn": 25
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'error' is defined but never used.",
        "line": 159,
        "column": 14,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 159,
        "endColumn": 24
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'progress' is defined but never used.",
        "line": 24,
        "column": 19,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 24,
        "endColumn": 43
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'data' is defined but never used.",
        "line": 110,
        "column": 16,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 110,
        "endColumn": 25
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'error' is defined but never used.",
        "line": 111,
        "column": 14,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 111,
        "endColumn": 24
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'progress' is defined but never used.",
        "line": 112,
        "column": 17,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 112,
        "endColumn": 41
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'data' is defined but never used.",
        "line": 104,
        "column": 16,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 104,
        "endColumn": 25
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'error' is defined but never used.",
        "line": 105,
        "column": 14,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 105,
        "endColumn": 24
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'task' is defined but never used.",
        "line": 480,
        "column": 20,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 480,
        "endColumn": 36
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'task' is defined but never used.",
        "line": 481,
        "column": 22,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 481,
        "endColumn": 38
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'task' is defined but never used.",
        "line": 482,
        "column": 19,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 482,
        "endColumn": 35
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'error' is defined but never used.",
        "line": 482,
        "column": 37,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 482,
        "endColumn": 50
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'data' is defined but never used.",
        "line": 167,
        "column": 16,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 167,
        "endColumn": 25
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'error' is defined but never used.",
        "line": 168,
        "column": 14,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 168,
        "endColumn": 24
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'percent' is defined but never used.",
        "line": 20,
        "column": 17,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 20,
        "endColumn": 32
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'percent' is defined but never used.",
        "line": 151,
        "column": 17,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 151,
        "endColumn": 32
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'file' is defined but never used.",
        "line": 262,
        "column": 16,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 262,
        "endColumn": 26
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'config' is defined but never used.",
        "line": 262,
        "column": 28,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 262,
        "endColumn": 49
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'args' is defined but never used.",
        "line": 80,
        "column": 40,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 80,
        "endColumn": 44
      },
      {
        "ruleId": "no-unused-vars",
        "severity": 2,
        "message": "'args' is defined but never used.",
        "line": 83,
        "column": 8,
        "nodeType": "Identifier",
        "messageId": "unusedVar",
        "endLine": 83,
        "endColumn": 12
      }
    ]
  }
}