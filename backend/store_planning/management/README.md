# 开店计划管理模块 - Management Commands

本目录包含开店计划管理模块的Django管理命令，用于初始化和维护基础数据。

## 可用命令

### 1. init_base_data - 初始化基础数据

用于初始化开店计划管理模块的基础数据，包括经营区域和门店类型。

#### 基本用法

```bash
# 初始化所有基础数据（经营区域和门店类型）
python manage.py init_base_data

# 仅初始化经营区域数据
python manage.py init_base_data --regions-only

# 仅初始化门店类型数据
python manage.py init_base_data --store-types-only

# 强制重新创建数据（如果没有外键约束）
python manage.py init_base_data --force
```

#### 功能特性

- **安全性**：使用 `get_or_create` 避免重复创建数据
- **更新机制**：自动更新现有数据以确保一致性
- **外键保护**：在有关联数据时优雅处理删除失败
- **灵活选项**：支持分别初始化不同类型的数据

#### 默认数据

**经营区域**：
- 华东区 (HD) - 包括上海、江苏、浙江、安徽、福建、江西、山东等省市
- 华南区 (HN) - 包括广东、广西、海南等省区
- 华北区 (HB) - 包括北京、天津、河北、山西、内蒙古等省市区
- 华中区 (HZ) - 包括河南、湖北、湖南等省份
- 西南区 (XN) - 包括重庆、四川、贵州、云南、西藏等省市区
- 西北区 (XB) - 包括陕西、甘肃、青海、宁夏、新疆等省区
- 东北区 (DB) - 包括辽宁、吉林、黑龙江等省份

**门店类型**：
- 直营店 (ZY) - 公司直接经营管理的门店
- 加盟店 (JM) - 加盟商经营的门店
- 旗舰店 (QJ) - 品牌形象店，通常位于核心商圈
- 社区店 (SQ) - 位于居民社区的便民门店
- 商场店 (SC) - 位于购物中心或商场内的门店
- 外卖店 (WM) - 主要提供外卖服务的门店
- 概念店 (GN) - 试验新概念、新产品的门店

### 2. verify_base_data - 验证基础数据

用于验证基础数据的完整性和正确性。

#### 基本用法

```bash
# 验证所有基础数据
python manage.py verify_base_data
```

#### 功能特性

- **完整性检查**：验证所有必需的基础数据是否存在
- **状态检查**：显示每个数据项的启用状态
- **清晰输出**：使用颜色和符号清晰显示验证结果

## 使用场景

### 系统初始化

在新部署系统时，运行以下命令初始化基础数据：

```bash
python manage.py init_base_data
python manage.py verify_base_data
```

### 数据维护

定期运行验证命令确保数据完整性：

```bash
python manage.py verify_base_data
```

如果发现数据不一致，可以运行初始化命令修复：

```bash
python manage.py init_base_data
```

### 开发环境重置

在开发环境中，如果需要重置基础数据（注意：只有在没有关联数据时才能成功）：

```bash
python manage.py init_base_data --force
```

## 注意事项

1. **外键约束**：如果基础数据已被其他数据引用（如RegionalPlan），则无法使用 `--force` 选项删除
2. **数据一致性**：命令会自动更新现有数据以确保与预定义数据的一致性
3. **事务安全**：所有操作都在数据库事务中执行，确保数据一致性
4. **权限要求**：需要数据库写入权限才能执行这些命令

## 扩展说明

如需添加新的经营区域或门店类型，请修改相应命令文件中的数据定义：

- 经营区域：修改 `init_base_data.py` 中的 `regions_data` 列表
- 门店类型：修改 `init_base_data.py` 中的 `store_types_data` 列表
- 验证逻辑：同时更新 `verify_base_data.py` 中的预期数据列表